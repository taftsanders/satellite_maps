{
  "total": 2121,
  "subtotal": 2121,
  "page": 1,
  "per_page": 2000000,
  "search": null,
  "sort": {
    "by": null,
    "order": null
  },
  "results": [{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2018-01-27 15:52:04 UTC","id":2262,"auditable_id":1,"auditable_name":"Base_Org","auditable_type":"Organization","action":"update","audited_changes":{"description":[null,""]}},{"user_id":3,"user_type":null,"user_name":"admin","version":70,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2018-01-27 13:11:18 UTC","id":2261,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"managed":[true,false]}},{"user_id":3,"user_type":null,"user_name":"admin","version":69,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2018-01-27 13:11:10 UTC","id":2260,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"managed":[false,true]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":33,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-26 10:04:34 UTC","id":2259,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":53,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-26 10:04:28 UTC","id":2258,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":57,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2018-01-25 15:33:36 UTC","id":2257,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":56,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2018-01-25 15:33:11 UTC","id":2256,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":21,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.114","associated_name":null,"created_at":"2018-01-25 15:09:25 UTC","id":2255,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.127","associated_name":null,"created_at":"2018-01-24 15:14:02 UTC","id":2254,"auditable_id":100,"auditable_name":"drone69.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone69.usersys.redhat.com","root_pass":"$5$Q2r4J+Pz$vZ4EUikAKRnqyNRLcrhBC7ieTR8fqx.VOolNi7H6N9B","architecture_id":1,"operatingsystem_id":12,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$Q2r4J+Pz$vZ4EUikAKRnqyNRLcrhBC7ieTR8fqx.VOolNi7H6N9B","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":89,"host_id":100,"uuid":"3bb6e64c-2e61-4aef-9a30-ffc13090f744","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":104,"host_id":100,"uuid":"3bb6e64c-2e61-4aef-9a30-ffc13090f744","last_checkin":"2018-01-24T11:25:35.406Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-10-11T20:31:25.724Z","user_id":3}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":32,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-23 16:29:58 UTC","id":2253,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":52,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-23 15:17:07 UTC","id":2252,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":18,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.64","associated_name":null,"created_at":"2018-01-18 14:48:44 UTC","id":2251,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone66.usersys.redhat.com","root_pass":"$5$kWOdXm3v$BL9uMwlJ1GXt530EHSIiGlnx9gBd3u4PgExsEGb9a67","architecture_id":1,"operatingsystem_id":7,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$kWOdXm3v$BL9uMwlJ1GXt530EHSIiGlnx9gBd3u4PgExsEGb9a67","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":14,"host_id":20,"uuid":"cb504ac8-2984-4fb3-9cb9-1c1ba0612f0b","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":18,"host_id":20,"uuid":"cb504ac8-2984-4fb3-9cb9-1c1ba0612f0b","last_checkin":"2018-01-18T14:48:30.542Z","service_level":null,"release_version":"6.6","autoheal":true,"registered_at":"2016-11-27T15:49:25.084Z","user_id":null}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-17 10:26:15 UTC","id":2250,"auditable_id":112,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-13 20:58:59 UTC","id":2249,"auditable_id":113,"auditable_name":"audittest.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.166","associated_name":null,"created_at":"2018-01-13 20:58:59 UTC","id":2248,"auditable_id":113,"auditable_name":"audittest.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-13 20:24:58 UTC","id":2247,"auditable_id":113,"auditable_name":"audittest.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-13 20:24:57 UTC","id":2246,"auditable_id":113,"auditable_name":"audittest.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.166","associated_name":null,"created_at":"2018-01-13 20:24:55 UTC","id":2245,"auditable_id":113,"auditable_name":"audittest.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$bPKklhmb$8bezdJkl9NquN4n6uGKW./","$5$jzlotTwa$Fq3Ww2pabTeXgriHtYOzZ11La8Ws3Ry07Qk7dCl1yp4"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.166","associated_name":null,"created_at":"2018-01-13 20:24:55 UTC","id":2244,"auditable_id":113,"auditable_name":"audittest.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"audittest.usersys.redhat.com","root_pass":"$5$jzlotTwa$Fq3Ww2pabTeXgriHtYOzZ11La8Ws3Ry07Qk7dCl1yp4","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$bPKklhmb$8bezdJkl9NquN4n6uGKW./","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.166","associated_name":null,"created_at":"2018-01-13 20:24:55 UTC","id":2243,"auditable_id":124,"auditable_name":"audittest.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"audittest.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:11:49 UTC","id":2242,"auditable_id":373,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:11:49 UTC","id":2241,"auditable_id":374,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:11:49 UTC","id":2240,"auditable_id":372,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:11:49 UTC","id":2239,"auditable_id":375,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":144,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:11:48 UTC","id":2238,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:11:47 UTC","id":2237,"auditable_id":375,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":143,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:11:47 UTC","id":2236,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:11:46 UTC","id":2235,"auditable_id":374,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:11:46 UTC","id":2234,"auditable_id":373,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:11:46 UTC","id":2233,"auditable_id":372,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":31,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:10:38 UTC","id":2232,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":51,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:10:37 UTC","id":2231,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:10:32 UTC","id":2230,"auditable_id":112,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":68,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:10:29 UTC","id":2229,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":57,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:10:27 UTC","id":2228,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":42,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:09:02 UTC","id":2227,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":41,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2018-01-10 16:08:30 UTC","id":2226,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2018-01-09 00:38:08 UTC","id":2225,"auditable_id":28,"auditable_name":"force_post_sync_actions","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":3,"user_type":null,"user_name":"admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2018-01-09 00:26:29 UTC","id":2224,"auditable_id":28,"auditable_name":"force_post_sync_actions","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":56,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2018-01-03 14:21:36 UTC","id":2223,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":30,"associated_type":"Host","remote_address":"10.13.153.228","associated_name":"joker.usersys.redhat.com","created_at":"2018-01-03 14:21:26 UTC","id":2222,"auditable_id":7,"auditable_name":"7","auditable_type":"HostClass","action":"destroy","audited_changes":{"puppetclass_id":6,"host_id":30}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":30,"associated_type":"Host","remote_address":"10.13.153.228","associated_name":"joker.usersys.redhat.com","created_at":"2018-01-03 14:21:26 UTC","id":2221,"auditable_id":6,"auditable_name":"6","auditable_type":"HostClass","action":"destroy","audited_changes":{"puppetclass_id":3,"host_id":30}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":30,"associated_type":"Host","remote_address":"10.13.153.228","associated_name":"joker.usersys.redhat.com","created_at":"2018-01-03 14:21:26 UTC","id":2220,"auditable_id":5,"auditable_name":"5","auditable_type":"HostClass","action":"destroy","audited_changes":{"puppetclass_id":5,"host_id":30}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":55,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2018-01-03 14:05:44 UTC","id":2219,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":54,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2018-01-03 01:49:42 UTC","id":2218,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"comment":[null,""]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":30,"associated_type":"Host","remote_address":"10.13.153.228","associated_name":"joker.usersys.redhat.com","created_at":"2018-01-03 01:49:42 UTC","id":2217,"auditable_id":7,"auditable_name":"7","auditable_type":"HostClass","action":"create","audited_changes":{"puppetclass_id":6,"host_id":30}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":30,"associated_type":"Host","remote_address":"10.13.153.228","associated_name":"joker.usersys.redhat.com","created_at":"2018-01-03 01:49:42 UTC","id":2216,"auditable_id":6,"auditable_name":"6","auditable_type":"HostClass","action":"create","audited_changes":{"puppetclass_id":3,"host_id":30}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":30,"associated_type":"Host","remote_address":"10.13.153.228","associated_name":"joker.usersys.redhat.com","created_at":"2018-01-03 01:49:42 UTC","id":2215,"auditable_id":5,"auditable_name":"5","auditable_type":"HostClass","action":"create","audited_changes":{"puppetclass_id":5,"host_id":30}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-28 13:08:33 UTC","id":2214,"auditable_id":27,"auditable_name":"camworkstation.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-28 13:08:25 UTC","id":2213,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-12-28 13:08:13 UTC","id":2212,"auditable_id":109,"auditable_name":"diconnected.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"diconnected.usersys.redhat.com","root_pass":"$5$blWwK7eA$Qyi.Jwsgf9YyQZf2RastmLprWK7q6ctP7kj.f4vK58A","architecture_id":1,"operatingsystem_id":13,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$blWwK7eA$Qyi.Jwsgf9YyQZf2RastmLprWK7q6ctP7kj.f4vK58A","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":98,"host_id":109,"uuid":"175e5c55-2223-4c73-967e-80cb703495b0","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":113,"host_id":109,"uuid":"175e5c55-2223-4c73-967e-80cb703495b0","last_checkin":"2017-12-12T10:41:31.306Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-12-05T14:45:30.162Z","user_id":3}}},{"user_id":3,"user_type":null,"user_name":"admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-12-28 13:08:03 UTC","id":2211,"auditable_id":45,"auditable_name":"disconnected.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"disconnected.usersys.redhat.com","root_pass":"$5$HBoHDloe$KeJu.3UHedcDrhXvoapxYEZZqWgVH8XF9uI3.7MEfu3","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$HBoHDloe$KeJu.3UHedcDrhXvoapxYEZZqWgVH8XF9uI3.7MEfu3","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":37,"host_id":45,"uuid":"538f2b32-8393-4fcd-a8bb-c05afe7039ab","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":41,"host_id":45,"uuid":"538f2b32-8393-4fcd-a8bb-c05afe7039ab","last_checkin":"2017-01-26T12:00:45.839Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-01-15T14:51:10.809Z","user_id":null}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-28 13:07:11 UTC","id":2210,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":17,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-28 13:07:03 UTC","id":2209,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-28 13:06:32 UTC","id":2208,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-12-28 13:04:57 UTC","id":2207,"auditable_id":25,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"hotbox1.usersys.redhat.com","root_pass":"$5$uvRjYwYr$n7v0sxGfQX9U.x8js0JAzDRlVawaCAjPvliMzlmNxS6","architecture_id":1,"operatingsystem_id":2,"environment_id":1,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":null,"owner_type":null,"enabled":true,"puppet_ca_proxy_id":1,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":1,"certname":"hotbox1.usersys.redhat.com","image_id":null,"organization_id":1,"location_id":null,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$uvRjYwYr$n7v0sxGfQX9U.x8js0JAzDRlVawaCAjPvliMzlmNxS6","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-28 13:04:51 UTC","id":2206,"auditable_id":70,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":67,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-28 13:04:20 UTC","id":2205,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":66,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-28 13:04:02 UTC","id":2204,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":65,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-28 13:03:50 UTC","id":2203,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-12-28 13:03:25 UTC","id":2202,"auditable_id":84,"auditable_name":"testfacts.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"testfacts.usersys.redhat.com","root_pass":"$5$GGiSiFEi$17eNuDqMhZknCxJGfk76l29Agz/x7tHzDD/42Ml0HY9","architecture_id":null,"operatingsystem_id":11,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$GGiSiFEi$17eNuDqMhZknCxJGfk76l29Agz/x7tHzDD/42Ml0HY9","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":73,"host_id":84,"uuid":"cf999b78-32a9-4a7d-9ed1-da3b8b11249c","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":86,"host_id":84,"uuid":"cf999b78-32a9-4a7d-9ed1-da3b8b11249c","last_checkin":"2017-08-18T03:09:01.038Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-08-16T15:12:06.841Z","user_id":null}}},{"user_id":3,"user_type":null,"user_name":"admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-12-28 13:03:08 UTC","id":2201,"auditable_id":86,"auditable_name":"teststuff.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"teststuff.usersys.redhat.com","root_pass":"$5$bSyHANVR$FdFl7Uw8BMI4HSs/cWY9rsDza3zI9ZSv/wx71OxrkZ6","architecture_id":1,"operatingsystem_id":13,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$bSyHANVR$FdFl7Uw8BMI4HSs/cWY9rsDza3zI9ZSv/wx71OxrkZ6","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":75,"host_id":86,"uuid":"639d5aba-fb7a-4261-921e-fa3a24561864","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":88,"host_id":86,"uuid":"639d5aba-fb7a-4261-921e-fa3a24561864","last_checkin":"2017-09-01T10:08:43.173Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-08-25T14:51:55.233Z","user_id":null}}},{"user_id":3,"user_type":null,"user_name":"admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-12-28 13:02:55 UTC","id":2200,"auditable_id":51,"auditable_name":"testthis.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"testthis.usersys.redhat.com","root_pass":"$5$XFXFPgPq$cx9Pv4S2/OKsAkT0KQKKjsmB1wJVQO34yflJr2KP9j.","architecture_id":1,"operatingsystem_id":2,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$XFXFPgPq$cx9Pv4S2/OKsAkT0KQKKjsmB1wJVQO34yflJr2KP9j.","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":42,"host_id":51,"uuid":"e8431488-7c4a-4945-af1a-8fa0f83aacc7","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":52,"host_id":51,"uuid":"e8431488-7c4a-4945-af1a-8fa0f83aacc7","last_checkin":"2017-03-22T19:12:29.809Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-03-13T23:02:26.089Z","user_id":null}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":53,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-28 11:47:33 UTC","id":2199,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-28 11:17:24 UTC","id":2198,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-28 02:17:51 UTC","id":2197,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 23:23:27 UTC","id":2196,"auditable_id":82,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":50,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 21:04:39 UTC","id":2195,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":30,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 21:04:27 UTC","id":2194,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":29,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 20:24:26 UTC","id":2193,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":49,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 20:24:26 UTC","id":2192,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 20:23:08 UTC","id":2191,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 20:23:08 UTC","id":2190,"auditable_id":82,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 20:23:08 UTC","id":2189,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 20:23:06 UTC","id":2188,"auditable_id":109,"auditable_name":"diconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 20:23:06 UTC","id":2187,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":52,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 20:23:05 UTC","id":2186,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":64,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 20:23:05 UTC","id":2185,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 20:23:03 UTC","id":2184,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 20:23:03 UTC","id":2183,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-27 20:23:01 UTC","id":2182,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-22 22:08:56 UTC","id":2181,"auditable_id":369,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-22 22:08:56 UTC","id":2180,"auditable_id":370,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-22 22:08:55 UTC","id":2179,"auditable_id":368,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-22 22:08:55 UTC","id":2178,"auditable_id":371,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":142,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-22 22:08:54 UTC","id":2177,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-22 22:08:53 UTC","id":2176,"auditable_id":371,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":141,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-22 22:08:53 UTC","id":2175,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-22 22:08:52 UTC","id":2174,"auditable_id":370,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-22 22:08:52 UTC","id":2173,"auditable_id":369,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-22 22:08:52 UTC","id":2172,"auditable_id":368,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":40,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-22 22:06:00 UTC","id":2171,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":39,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-22 22:05:24 UTC","id":2170,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":51,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-21 09:38:02 UTC","id":2169,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":28,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-21 09:38:00 UTC","id":2168,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":48,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-21 09:37:52 UTC","id":2167,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":63,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-21 09:36:44 UTC","id":2166,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":47,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-20 14:11:05 UTC","id":2165,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":27,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-20 14:10:26 UTC","id":2164,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":3,"user_type":null,"user_name":"admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-12-14 14:50:10 UTC","id":2163,"auditable_id":1,"auditable_name":"usersys.redhat.com","auditable_type":"Domain","action":"update","audited_changes":{"dns_id":[1,null]}},{"user_id":3,"user_type":null,"user_name":"admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-12-14 14:50:02 UTC","id":2162,"auditable_id":1,"auditable_name":"usersys.redhat.com","auditable_type":"Domain","action":"update","audited_changes":{"dns_id":[null,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-13 18:58:10 UTC","id":2161,"auditable_id":100,"auditable_name":"drone69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-13 18:57:26 UTC","id":2160,"auditable_id":100,"auditable_name":"drone69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-13 00:43:55 UTC","id":2159,"auditable_id":112,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-13 00:43:51 UTC","id":2158,"auditable_id":112,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-12 21:21:32 UTC","id":2157,"auditable_id":112,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-12 21:21:31 UTC","id":2156,"auditable_id":112,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,13]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.58","associated_name":null,"created_at":"2017-12-12 21:21:28 UTC","id":2155,"auditable_id":112,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$8BaZw+k1$3auRwnFZxXavqeLNbylDF/","$5$AdDsWCNK$KBd1vGL2WsRJLn17kXBxtzXw4aFJijEg/QKFPhjXV31"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.58","associated_name":null,"created_at":"2017-12-12 21:21:28 UTC","id":2154,"auditable_id":112,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone74.usersys.redhat.com","root_pass":"$5$AdDsWCNK$KBd1vGL2WsRJLn17kXBxtzXw4aFJijEg/QKFPhjXV31","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$8BaZw+k1$3auRwnFZxXavqeLNbylDF/","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.58","associated_name":null,"created_at":"2017-12-12 21:21:28 UTC","id":2153,"auditable_id":123,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"drone74.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-12-12 20:29:45 UTC","id":2152,"auditable_id":111,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone74.usersys.redhat.com","root_pass":"$5$LHnGThcy$RKkmcqU61RQWq/nrbZ.wmHfjMBG/rYbRsGRJ77MAmY9","architecture_id":1,"operatingsystem_id":13,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$LHnGThcy$RKkmcqU61RQWq/nrbZ.wmHfjMBG/rYbRsGRJ77MAmY9","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":100,"host_id":111,"uuid":"c9828577-af4c-40e3-b345-7518a2b27e9e","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":115,"host_id":111,"uuid":"c9828577-af4c-40e3-b345-7518a2b27e9e","last_checkin":"2017-12-12T20:29:02.429Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-12-12T20:29:02.656Z","user_id":3}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-12 20:29:07 UTC","id":2151,"auditable_id":111,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-12 20:29:06 UTC","id":2150,"auditable_id":111,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,13]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-12-12 20:29:02 UTC","id":2149,"auditable_id":111,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$/Z0KsNxk$amhbtpAl..B9yeVHI8qu61","$5$LHnGThcy$RKkmcqU61RQWq/nrbZ.wmHfjMBG/rYbRsGRJ77MAmY9"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-12-12 20:29:02 UTC","id":2148,"auditable_id":111,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone74.usersys.redhat.com","root_pass":"$5$LHnGThcy$RKkmcqU61RQWq/nrbZ.wmHfjMBG/rYbRsGRJ77MAmY9","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$/Z0KsNxk$amhbtpAl..B9yeVHI8qu61","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.58","associated_name":null,"created_at":"2017-12-12 20:28:09 UTC","id":2146,"auditable_id":107,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone74.usersys.redhat.com","root_pass":"$5$PReqZe3W$HXqIYVEJtzzCTiP/430A.IuBNZ.1zxT95/hjxeIip7/","architecture_id":1,"operatingsystem_id":13,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$PReqZe3W$HXqIYVEJtzzCTiP/430A.IuBNZ.1zxT95/hjxeIip7/","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":96,"host_id":107,"uuid":"8130f25d-8ade-48b3-849a-b91e9266a70d","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":111,"host_id":107,"uuid":"8130f25d-8ade-48b3-849a-b91e9266a70d","last_checkin":"2017-12-12T19:13:00.125Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-10-24T22:20:04.617Z","user_id":3}}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":62,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-12-12 14:48:25 UTC","id":2145,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":50,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-12-12 14:47:11 UTC","id":2144,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":49,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-12 14:19:18 UTC","id":2143,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":61,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-12 14:19:17 UTC","id":2142,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":48,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-11 18:31:40 UTC","id":2141,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":60,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-11 18:30:28 UTC","id":2140,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-11 16:57:07 UTC","id":2139,"auditable_id":365,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-11 16:57:07 UTC","id":2138,"auditable_id":366,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-11 16:57:07 UTC","id":2137,"auditable_id":364,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-11 16:57:06 UTC","id":2136,"auditable_id":367,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":140,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-11 16:57:05 UTC","id":2135,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-11 16:57:04 UTC","id":2134,"auditable_id":367,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":139,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-11 16:57:04 UTC","id":2133,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-11 16:57:03 UTC","id":2132,"auditable_id":366,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-11 16:57:03 UTC","id":2131,"auditable_id":365,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-11 16:57:03 UTC","id":2130,"auditable_id":364,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":38,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-11 16:53:42 UTC","id":2129,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":37,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-11 16:53:08 UTC","id":2128,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-08 23:35:52 UTC","id":2127,"auditable_id":110,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-08 23:35:51 UTC","id":2126,"auditable_id":110,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.138","associated_name":null,"created_at":"2017-12-08 23:35:47 UTC","id":2125,"auditable_id":110,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$8z6Fazz4$xRDSaX6YjkXkYyJcGBVTu0","$5$Ww1lGCr4$oT2loi2foXrrGfTa9D.wAUrsoedaM/JKEpos/Nh1sHC"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.138","associated_name":null,"created_at":"2017-12-08 23:35:47 UTC","id":2124,"auditable_id":110,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone72.usersys.redhat.com","root_pass":"$5$Ww1lGCr4$oT2loi2foXrrGfTa9D.wAUrsoedaM/JKEpos/Nh1sHC","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$8z6Fazz4$xRDSaX6YjkXkYyJcGBVTu0","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.138","associated_name":null,"created_at":"2017-12-08 23:35:47 UTC","id":2123,"auditable_id":121,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"drone72.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":35,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.138","associated_name":null,"created_at":"2017-12-08 23:35:29 UTC","id":2122,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone72.usersys.redhat.com","root_pass":"$5$WTat7m/q$zIMQJJ1E4M25c.CfsUJjIA/PfwV43tfR6n4nQJ/c4e.","architecture_id":1,"operatingsystem_id":2,"environment_id":2,"ptable_id":null,"medium_id":null,"build":false,"comment":"","disk":null,"installed_at":null,"model_id":1,"hostgroup_id":1,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":1,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":1,"certname":"drone72.usersys.redhat.com","image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":1,"grub_pass":"$5$WTat7m/q$zIMQJJ1E4M25c.CfsUJjIA/PfwV43tfR6n4nQJ/c4e.","content_view_id":2,"lifecycle_environment_id":1,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":6,"host_id":10,"uuid":"7d85a287-d03d-4ffb-af37-1928e405269a","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":47,"host_id":10,"uuid":"7d85a287-d03d-4ffb-af37-1928e405269a","last_checkin":"2017-12-08T23:34:59.749Z","service_level":"Premium","release_version":"7.2","autoheal":true,"registered_at":"2017-02-22T22:42:35.762Z","user_id":null}}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":18,"associated_type":"LookupKey","remote_address":"10.13.153.228","associated_name":"foreman_scap_client::port","created_at":"2017-12-08 20:44:12 UTC","id":2121,"auditable_id":4,"auditable_name":"fqdn=drone73.usersys.redhat.com","auditable_type":"LookupValue","action":"create","audited_changes":{"match":"fqdn=drone73.usersys.redhat.com","value":"9090","lookup_key_id":18,"use_puppet_default":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":17,"associated_type":"LookupKey","remote_address":"10.13.153.228","associated_name":"foreman_scap_client::server","created_at":"2017-12-08 20:44:12 UTC","id":2120,"auditable_id":3,"auditable_name":"fqdn=drone73.usersys.redhat.com","auditable_type":"LookupValue","action":"create","audited_changes":{"match":"fqdn=drone73.usersys.redhat.com","value":"batman.usersys.redhat.com","lookup_key_id":17,"use_puppet_default":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-12-08 20:44:12 UTC","id":2119,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"hostgroup_id":[null,1],"openscap_proxy_id":[null,1],"content_source_id":[null,1],"content_view_id":[null,2],"lifecycle_environment_id":[null,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":99,"associated_type":"Host","remote_address":"10.13.153.228","associated_name":"drone73.usersys.redhat.com","created_at":"2017-12-08 20:44:12 UTC","id":2118,"auditable_id":4,"auditable_name":"4","auditable_type":"HostClass","action":"destroy","audited_changes":{"puppetclass_id":4,"host_id":99}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":99,"associated_type":"Host","remote_address":"10.13.153.228","associated_name":"drone73.usersys.redhat.com","created_at":"2017-12-08 20:44:12 UTC","id":2117,"auditable_id":3,"auditable_name":"3","auditable_type":"HostClass","action":"destroy","audited_changes":{"puppetclass_id":3,"host_id":99}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":99,"associated_type":"Host","remote_address":"10.13.153.228","associated_name":"drone73.usersys.redhat.com","created_at":"2017-12-08 20:44:12 UTC","id":2116,"auditable_id":2,"auditable_name":"2","auditable_type":"HostClass","action":"destroy","audited_changes":{"puppetclass_id":6,"host_id":99}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":99,"associated_type":"Host","remote_address":"10.13.153.228","associated_name":"drone73.usersys.redhat.com","created_at":"2017-12-08 20:44:12 UTC","id":2115,"auditable_id":1,"auditable_name":"1","auditable_type":"HostClass","action":"destroy","audited_changes":{"puppetclass_id":5,"host_id":99}},{"user_id":3,"user_type":null,"user_name":"admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-12-08 20:41:54 UTC","id":2114,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"environment_id":[1,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-12-08 20:41:05 UTC","id":2113,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"comment":[null,""]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":99,"associated_type":"Host","remote_address":"10.13.153.228","associated_name":"drone73.usersys.redhat.com","created_at":"2017-12-08 20:41:05 UTC","id":2112,"auditable_id":4,"auditable_name":"4","auditable_type":"HostClass","action":"create","audited_changes":{"puppetclass_id":4,"host_id":99}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":99,"associated_type":"Host","remote_address":"10.13.153.228","associated_name":"drone73.usersys.redhat.com","created_at":"2017-12-08 20:41:05 UTC","id":2111,"auditable_id":3,"auditable_name":"3","auditable_type":"HostClass","action":"create","audited_changes":{"puppetclass_id":3,"host_id":99}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":99,"associated_type":"Host","remote_address":"10.13.153.228","associated_name":"drone73.usersys.redhat.com","created_at":"2017-12-08 20:41:05 UTC","id":2110,"auditable_id":2,"auditable_name":"2","auditable_type":"HostClass","action":"create","audited_changes":{"puppetclass_id":6,"host_id":99}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":99,"associated_type":"Host","remote_address":"10.13.153.228","associated_name":"drone73.usersys.redhat.com","created_at":"2017-12-08 20:41:05 UTC","id":2109,"auditable_id":1,"auditable_name":"1","auditable_type":"HostClass","action":"create","audited_changes":{"puppetclass_id":5,"host_id":99}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-12-08 20:39:10 UTC","id":2108,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"environment_id":[null,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-12-08 20:39:10 UTC","id":2107,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"certname":[null,"drone73.usersys.redhat.com"],"puppet_proxy_id":[null,1],"puppet_ca_proxy_id":[null,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":26,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-08 15:55:03 UTC","id":2106,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":46,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-08 15:55:01 UTC","id":2105,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-05 19:01:17 UTC","id":2104,"auditable_id":106,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-05 19:01:00 UTC","id":2103,"auditable_id":106,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-05 16:10:41 UTC","id":2102,"auditable_id":109,"auditable_name":"diconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-05 16:10:40 UTC","id":2101,"auditable_id":109,"auditable_name":"diconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-05 14:45:46 UTC","id":2100,"auditable_id":109,"auditable_name":"diconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-05 14:45:36 UTC","id":2099,"auditable_id":109,"auditable_name":"diconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-05 14:45:34 UTC","id":2098,"auditable_id":109,"auditable_name":"diconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,13]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.211","associated_name":null,"created_at":"2017-12-05 14:45:29 UTC","id":2097,"auditable_id":109,"auditable_name":"diconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$RTNBUyEb$8QR432INBj.KT3P9pPhw9.","$5$blWwK7eA$Qyi.Jwsgf9YyQZf2RastmLprWK7q6ctP7kj.f4vK58A"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.211","associated_name":null,"created_at":"2017-12-05 14:45:29 UTC","id":2096,"auditable_id":109,"auditable_name":"diconnected.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"diconnected.usersys.redhat.com","root_pass":"$5$blWwK7eA$Qyi.Jwsgf9YyQZf2RastmLprWK7q6ctP7kj.f4vK58A","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$RTNBUyEb$8QR432INBj.KT3P9pPhw9.","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-05 03:02:40 UTC","id":2094,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-05 01:55:20 UTC","id":2093,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-05 01:15:18 UTC","id":2092,"auditable_id":107,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":47,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-05 00:35:24 UTC","id":2091,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":45,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 22:15:13 UTC","id":2090,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 21:15:16 UTC","id":2089,"auditable_id":107,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":25,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 20:56:54 UTC","id":2088,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":46,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 20:35:15 UTC","id":2087,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 20:04:06 UTC","id":2086,"auditable_id":82,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 19:55:10 UTC","id":2085,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 19:02:28 UTC","id":2084,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 19:02:18 UTC","id":2083,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 19:02:13 UTC","id":2082,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 19:01:47 UTC","id":2081,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 18:18:21 UTC","id":2080,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":44,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 18:15:13 UTC","id":2079,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 18:04:49 UTC","id":2078,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 17:49:55 UTC","id":2077,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 17:49:54 UTC","id":2076,"auditable_id":82,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 17:49:47 UTC","id":2075,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":24,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 17:49:45 UTC","id":2074,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 17:49:45 UTC","id":2073,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":43,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 17:49:42 UTC","id":2072,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":23,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-12-04 14:56:59 UTC","id":2071,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-22 14:33:31 UTC","id":2070,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-22 14:33:25 UTC","id":2069,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-22 14:21:44 UTC","id":2068,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":42,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-22 10:46:46 UTC","id":2067,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-22 09:08:20 UTC","id":2066,"auditable_id":82,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-22 06:56:50 UTC","id":2065,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-22 02:05:59 UTC","id":2064,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":45,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-22 01:20:06 UTC","id":2063,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":44,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-22 01:20:01 UTC","id":2062,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-22 00:05:05 UTC","id":2061,"auditable_id":107,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-22 00:05:01 UTC","id":2060,"auditable_id":107,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-21 17:30:39 UTC","id":2059,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-21 17:30:39 UTC","id":2058,"auditable_id":82,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-21 17:30:37 UTC","id":2057,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-21 17:30:37 UTC","id":2056,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":41,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-21 17:30:35 UTC","id":2055,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-14 05:00:10 UTC","id":2054,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-07 14:08:49 UTC","id":2053,"auditable_id":361,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-07 14:08:49 UTC","id":2052,"auditable_id":362,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-07 14:08:49 UTC","id":2051,"auditable_id":360,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-07 14:08:49 UTC","id":2050,"auditable_id":363,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":138,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-07 14:08:48 UTC","id":2049,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-07 14:08:46 UTC","id":2048,"auditable_id":363,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":137,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-07 14:08:46 UTC","id":2047,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-07 14:08:45 UTC","id":2046,"auditable_id":362,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-07 14:08:45 UTC","id":2045,"auditable_id":361,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-07 14:08:45 UTC","id":2044,"auditable_id":360,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":36,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-07 14:05:57 UTC","id":2043,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":35,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-07 14:05:22 UTC","id":2042,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.147","associated_name":null,"created_at":"2017-11-06 15:55:21 UTC","id":2041,"auditable_id":82,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":null,"user_type":null,"user_name":null,"version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-06 14:54:14 UTC","id":2040,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.54","associated_name":null,"created_at":"2017-11-06 14:54:13 UTC","id":2039,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":null,"user_type":null,"user_name":null,"version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-06 14:10:50 UTC","id":2038,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.158","associated_name":null,"created_at":"2017-11-06 14:10:48 UTC","id":2037,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-11-02 17:22:31 UTC","id":2036,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-31 18:10:29 UTC","id":2035,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-31 14:33:21 UTC","id":2034,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-31 14:33:17 UTC","id":2033,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-31 13:46:34 UTC","id":2032,"auditable_id":82,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-31 13:46:14 UTC","id":2031,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":40,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-31 10:46:16 UTC","id":2030,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-31 06:56:42 UTC","id":2029,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 21:17:20 UTC","id":2028,"auditable_id":107,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 21:17:16 UTC","id":2027,"auditable_id":107,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 18:25:44 UTC","id":2026,"auditable_id":100,"auditable_name":"drone69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 18:25:40 UTC","id":2025,"auditable_id":100,"auditable_name":"drone69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 18:11:23 UTC","id":2024,"auditable_id":45,"auditable_name":"disconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 18:11:22 UTC","id":2023,"auditable_id":27,"auditable_name":"camworkstation.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":39,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 18:11:22 UTC","id":2022,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 18:09:54 UTC","id":2021,"auditable_id":82,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 18:09:54 UTC","id":2020,"auditable_id":86,"auditable_name":"teststuff.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 18:09:54 UTC","id":2019,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 18:09:54 UTC","id":2018,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 18:09:52 UTC","id":2017,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 18:09:52 UTC","id":2016,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 18:09:50 UTC","id":2015,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 18:09:47 UTC","id":2014,"auditable_id":51,"auditable_name":"testthis.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-30 18:09:45 UTC","id":2013,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-27 09:40:24 UTC","id":2012,"auditable_id":108,"auditable_name":"mercury.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-26 20:21:26 UTC","id":2011,"auditable_id":108,"auditable_name":"mercury.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-26 19:49:07 UTC","id":2010,"auditable_id":108,"auditable_name":"mercury.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-26 17:32:22 UTC","id":2009,"auditable_id":108,"auditable_name":"mercury.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-26 17:32:00 UTC","id":2008,"auditable_id":108,"auditable_name":"mercury.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-26 17:31:59 UTC","id":2007,"auditable_id":108,"auditable_name":"mercury.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,13]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.75","associated_name":null,"created_at":"2017-10-26 17:31:53 UTC","id":2006,"auditable_id":108,"auditable_name":"mercury.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$9OH6N4AU$Gh1.1ETE5yncrDP49ocsZ/","$5$V+p33dpP$cXLbpPmAjUdmKF5QcCZ/65J/u.krWkVR3tx4X78j/0B"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.75","associated_name":null,"created_at":"2017-10-26 17:31:53 UTC","id":2005,"auditable_id":108,"auditable_name":"mercury.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"mercury.usersys.redhat.com","root_pass":"$5$V+p33dpP$cXLbpPmAjUdmKF5QcCZ/65J/u.krWkVR3tx4X78j/0B","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$9OH6N4AU$Gh1.1ETE5yncrDP49ocsZ/","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.75","associated_name":null,"created_at":"2017-10-26 17:31:53 UTC","id":2004,"auditable_id":119,"auditable_name":"mercury.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"mercury.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-10-26 17:13:21 UTC","id":2003,"auditable_id":8,"auditable_name":"yous guys","auditable_type":"User","action":"destroy","audited_changes":{"login":"student","firstname":"yous","lastname":"guys","mail":"student@localhost.url","admin":true,"auth_source_id":1,"locale":null,"avatar_hash":null,"default_organization_id":null,"default_location_id":null,"lower_login":"student","mail_enabled":false,"timezone":""}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-26 10:33:19 UTC","id":2002,"auditable_id":100,"auditable_name":"drone69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":34,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-10-25 17:50:28 UTC","id":2001,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"certname":[null,"drone72.usersys.redhat.com"],"puppet_proxy_id":[null,1],"puppet_ca_proxy_id":[null,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":33,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-10-25 17:24:12 UTC","id":2000,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"hostgroup_id":[null,1],"comment":[null,""],"content_source_id":[null,1],"content_view_id":[null,2],"lifecycle_environment_id":[null,1],"environment_id":[null,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 22:22:27 UTC","id":1999,"auditable_id":107,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 22:20:20 UTC","id":1998,"auditable_id":107,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 22:20:10 UTC","id":1997,"auditable_id":107,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 22:20:08 UTC","id":1996,"auditable_id":107,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,13]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.58","associated_name":null,"created_at":"2017-10-24 22:20:04 UTC","id":1995,"auditable_id":107,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$K7NlRRiq$Wuc16xHtiBDuox6W1AZ/T0","$5$PReqZe3W$HXqIYVEJtzzCTiP/430A.IuBNZ.1zxT95/hjxeIip7/"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.58","associated_name":null,"created_at":"2017-10-24 22:20:04 UTC","id":1994,"auditable_id":107,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone74.usersys.redhat.com","root_pass":"$5$PReqZe3W$HXqIYVEJtzzCTiP/430A.IuBNZ.1zxT95/hjxeIip7/","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$K7NlRRiq$Wuc16xHtiBDuox6W1AZ/T0","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.58","associated_name":null,"created_at":"2017-10-24 22:09:20 UTC","id":1992,"auditable_id":101,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone74.usersys.redhat.com","root_pass":"$5$BCIbw46o$UwP4Wo0RfJUrlEwbmiuWAYOKaIEyS.HbInT0YjAq.86","architecture_id":1,"operatingsystem_id":13,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$BCIbw46o$UwP4Wo0RfJUrlEwbmiuWAYOKaIEyS.HbInT0YjAq.86","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":90,"host_id":101,"uuid":"d8969271-5f94-4fb5-8f23-232abf041e28","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":105,"host_id":101,"uuid":"d8969271-5f94-4fb5-8f23-232abf041e28","last_checkin":"2017-10-24T21:26:19.721Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-10-11T20:33:40.959Z","user_id":3}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 19:13:12 UTC","id":1991,"auditable_id":106,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 19:12:22 UTC","id":1990,"auditable_id":106,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 19:07:13 UTC","id":1989,"auditable_id":106,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 19:07:11 UTC","id":1988,"auditable_id":106,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-10-24 19:07:08 UTC","id":1987,"auditable_id":106,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$ooNL+xEU$MJW2FX0/QxSyGpYxIEC5c.","$5$4X/Op9cq$que5kYvW2zD.92aDpgjM3aQ5qWLUtyKKpjzykvjtd/3"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-10-24 19:07:08 UTC","id":1986,"auditable_id":106,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone68.usersys.redhat.com","root_pass":"$5$4X/Op9cq$que5kYvW2zD.92aDpgjM3aQ5qWLUtyKKpjzykvjtd/3","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$ooNL+xEU$MJW2FX0/QxSyGpYxIEC5c.","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-10-24 19:07:08 UTC","id":1985,"auditable_id":117,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"drone68.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-10-24 19:06:50 UTC","id":1984,"auditable_id":105,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone68.usersys.redhat.com","root_pass":"$5$YyX4eB2i$2NzoByKlMU2ReP0va8MQn/RSNpmkLONS66lsflf4ESD","architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$YyX4eB2i$2NzoByKlMU2ReP0va8MQn/RSNpmkLONS66lsflf4ESD","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":94,"host_id":105,"uuid":"be3246b7-846b-4efc-b756-95033c3cf4c5","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":109,"host_id":105,"uuid":"be3246b7-846b-4efc-b756-95033c3cf4c5","last_checkin":"2017-10-24T19:02:30.851Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-10-24T19:02:31.084Z","user_id":3}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 19:02:35 UTC","id":1983,"auditable_id":105,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 19:02:35 UTC","id":1982,"auditable_id":105,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-10-24 19:02:30 UTC","id":1981,"auditable_id":105,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$vESt/A6v$kdJFvDohrGVK7R87gbHdV.","$5$YyX4eB2i$2NzoByKlMU2ReP0va8MQn/RSNpmkLONS66lsflf4ESD"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-10-24 19:02:30 UTC","id":1980,"auditable_id":105,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone68.usersys.redhat.com","root_pass":"$5$YyX4eB2i$2NzoByKlMU2ReP0va8MQn/RSNpmkLONS66lsflf4ESD","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$vESt/A6v$kdJFvDohrGVK7R87gbHdV.","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-10-24 19:01:05 UTC","id":1978,"auditable_id":104,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone68.usersys.redhat.com","root_pass":"$5$mcHKejWl$YstUzF6o3gVxktsamsc53rNZs9c2xZjWdNi41VNX1f7","architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$mcHKejWl$YstUzF6o3gVxktsamsc53rNZs9c2xZjWdNi41VNX1f7","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":93,"host_id":104,"uuid":"05c2a243-6918-494c-8bec-107f43f5bfbe","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":108,"host_id":104,"uuid":"05c2a243-6918-494c-8bec-107f43f5bfbe","last_checkin":"2017-10-24T19:00:17.194Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-10-24T18:57:24.665Z","user_id":3}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 19:00:42 UTC","id":1977,"auditable_id":104,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 19:00:36 UTC","id":1976,"auditable_id":104,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 19:00:18 UTC","id":1975,"auditable_id":104,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 18:57:29 UTC","id":1974,"auditable_id":104,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 18:57:28 UTC","id":1973,"auditable_id":104,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-10-24 18:57:24 UTC","id":1972,"auditable_id":104,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$WV/zOeP3$ehRRGtYwwZWgCO0W4/wS/.","$5$mcHKejWl$YstUzF6o3gVxktsamsc53rNZs9c2xZjWdNi41VNX1f7"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-10-24 18:57:24 UTC","id":1971,"auditable_id":104,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone68.usersys.redhat.com","root_pass":"$5$mcHKejWl$YstUzF6o3gVxktsamsc53rNZs9c2xZjWdNi41VNX1f7","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$WV/zOeP3$ehRRGtYwwZWgCO0W4/wS/.","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-10-24 18:57:08 UTC","id":1969,"auditable_id":103,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone68.usersys.redhat.com","root_pass":"$5$WVMtNmbr$KAo.eH8RC.idwLdrZAXd7fEOy39JZrzrpYumxNIyfK8","architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$WVMtNmbr$KAo.eH8RC.idwLdrZAXd7fEOy39JZrzrpYumxNIyfK8","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":92,"host_id":103,"uuid":"26a03f8b-1961-42a9-b6af-a24643cc746a","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":107,"host_id":103,"uuid":"26a03f8b-1961-42a9-b6af-a24643cc746a","last_checkin":"2017-10-24T18:55:05.375Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-10-24T18:55:05.609Z","user_id":3}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 18:55:12 UTC","id":1968,"auditable_id":103,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-24 18:55:10 UTC","id":1967,"auditable_id":103,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-10-24 18:55:05 UTC","id":1966,"auditable_id":103,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$nUdTGGVa$5ujeFLpCIyZ/pAUOallCK.","$5$WVMtNmbr$KAo.eH8RC.idwLdrZAXd7fEOy39JZrzrpYumxNIyfK8"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-10-24 18:55:05 UTC","id":1965,"auditable_id":103,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone68.usersys.redhat.com","root_pass":"$5$WVMtNmbr$KAo.eH8RC.idwLdrZAXd7fEOy39JZrzrpYumxNIyfK8","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$nUdTGGVa$5ujeFLpCIyZ/pAUOallCK.","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-10-24 18:54:41 UTC","id":1963,"auditable_id":93,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone68.usersys.redhat.com","root_pass":"$5$FDagHjSl$VXnrHzUe2ig4daSDqz0N7e403nC0jr.nhpn0EqDNfB9","architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$FDagHjSl$VXnrHzUe2ig4daSDqz0N7e403nC0jr.nhpn0EqDNfB9","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":82,"host_id":93,"uuid":"98a38600-5ea5-45b4-a009-b3034583fb1e","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":96,"host_id":93,"uuid":"98a38600-5ea5-45b4-a009-b3034583fb1e","last_checkin":"2017-10-24T18:15:23.646Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-09-21T20:08:54.395Z","user_id":null}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.60","associated_name":null,"created_at":"2017-10-16 17:30:52 UTC","id":1962,"auditable_id":102,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"regclass1.usersys.redhat.com","root_pass":"$5$Bws8zSWS$1p5ZdKFyhBsHWjG/GWXsGoiEzLj4gfVsdOVmnYAPA40","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":8,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$Bws8zSWS$1p5ZdKFyhBsHWjG/GWXsGoiEzLj4gfVsdOVmnYAPA40","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":91,"host_id":102,"uuid":"71d62626-48c0-4230-bffe-0a296d36a889","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":106,"host_id":102,"uuid":"71d62626-48c0-4230-bffe-0a296d36a889","last_checkin":"2017-10-16T17:28:43.067Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-10-16T17:27:26.674Z","user_id":8}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-16 17:28:49 UTC","id":1961,"auditable_id":102,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-16 17:28:45 UTC","id":1960,"auditable_id":102,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-16 17:27:33 UTC","id":1959,"auditable_id":102,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-16 17:27:31 UTC","id":1958,"auditable_id":102,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":8,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.60","associated_name":null,"created_at":"2017-10-16 17:27:26 UTC","id":1957,"auditable_id":102,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$eYwPlx/2$AmnQDALGPY6yCUBUSYYIv.","$5$Bws8zSWS$1p5ZdKFyhBsHWjG/GWXsGoiEzLj4gfVsdOVmnYAPA40"]}},{"user_id":8,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.60","associated_name":null,"created_at":"2017-10-16 17:27:26 UTC","id":1956,"auditable_id":102,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"regclass1.usersys.redhat.com","root_pass":"$5$Bws8zSWS$1p5ZdKFyhBsHWjG/GWXsGoiEzLj4gfVsdOVmnYAPA40","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":8,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$eYwPlx/2$AmnQDALGPY6yCUBUSYYIv.","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.123.217","associated_name":null,"created_at":"2017-10-16 14:34:39 UTC","id":1954,"auditable_id":8,"auditable_name":"yous guys","auditable_type":"User","action":"create","audited_changes":{"login":"student","firstname":"yous","lastname":"guys","mail":"student@localhost.url","admin":true,"auth_source_id":1,"locale":null,"avatar_hash":null,"default_organization_id":null,"default_location_id":null,"lower_login":"student","mail_enabled":false,"timezone":""}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-12 20:02:01 UTC","id":1953,"auditable_id":357,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-12 20:02:01 UTC","id":1952,"auditable_id":358,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-12 20:02:01 UTC","id":1951,"auditable_id":356,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-12 20:02:01 UTC","id":1950,"auditable_id":359,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":136,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-12 20:01:59 UTC","id":1949,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-12 20:01:58 UTC","id":1948,"auditable_id":359,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":135,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-12 20:01:58 UTC","id":1947,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-12 20:01:57 UTC","id":1946,"auditable_id":358,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-12 20:01:57 UTC","id":1945,"auditable_id":357,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-12 20:01:57 UTC","id":1944,"auditable_id":356,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":34,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-12 19:58:59 UTC","id":1943,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":33,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-12 19:58:25 UTC","id":1942,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-11 20:53:15 UTC","id":1941,"auditable_id":101,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-11 20:44:23 UTC","id":1940,"auditable_id":101,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-11 20:43:49 UTC","id":1939,"auditable_id":101,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-11 20:43:41 UTC","id":1938,"auditable_id":100,"auditable_name":"drone69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-11 20:40:23 UTC","id":1937,"auditable_id":100,"auditable_name":"drone69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-11 20:39:15 UTC","id":1936,"auditable_id":100,"auditable_name":"drone69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-11 20:34:28 UTC","id":1935,"auditable_id":101,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-11 20:33:48 UTC","id":1934,"auditable_id":101,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-11 20:33:47 UTC","id":1933,"auditable_id":101,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,13]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.58","associated_name":null,"created_at":"2017-10-11 20:33:40 UTC","id":1932,"auditable_id":101,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$Xh1m1k3Y$o4ylUooHnp6SXlZlr85tE0","$5$BCIbw46o$UwP4Wo0RfJUrlEwbmiuWAYOKaIEyS.HbInT0YjAq.86"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.58","associated_name":null,"created_at":"2017-10-11 20:33:40 UTC","id":1931,"auditable_id":101,"auditable_name":"drone74.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone74.usersys.redhat.com","root_pass":"$5$BCIbw46o$UwP4Wo0RfJUrlEwbmiuWAYOKaIEyS.HbInT0YjAq.86","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$Xh1m1k3Y$o4ylUooHnp6SXlZlr85tE0","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-11 20:32:20 UTC","id":1929,"auditable_id":100,"auditable_name":"drone69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-11 20:31:32 UTC","id":1928,"auditable_id":100,"auditable_name":"drone69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-11 20:31:31 UTC","id":1927,"auditable_id":100,"auditable_name":"drone69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,12]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.127","associated_name":null,"created_at":"2017-10-11 20:31:25 UTC","id":1926,"auditable_id":100,"auditable_name":"drone69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$sas3VSFV$yfH2kX7TlNNEPUQ48MvRj/","$5$Q2r4J+Pz$vZ4EUikAKRnqyNRLcrhBC7ieTR8fqx.VOolNi7H6N9B"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.127","associated_name":null,"created_at":"2017-10-11 20:31:25 UTC","id":1925,"auditable_id":100,"auditable_name":"drone69.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone69.usersys.redhat.com","root_pass":"$5$Q2r4J+Pz$vZ4EUikAKRnqyNRLcrhBC7ieTR8fqx.VOolNi7H6N9B","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$sas3VSFV$yfH2kX7TlNNEPUQ48MvRj/","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-10 18:14:08 UTC","id":1923,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-10 18:14:07 UTC","id":1922,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-10 18:14:03 UTC","id":1921,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-09 22:27:52 UTC","id":1920,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-09 22:27:52 UTC","id":1919,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-09 22:27:48 UTC","id":1918,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$y9oUVzKl$ojeAHHAb3jBXaAfLNpaUb.","$5$CwsVa87n$YMbJk1lAEGgI1rtoPNTWa53BlSsl4f82jUXuOifeRL4"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-09 22:27:48 UTC","id":1917,"auditable_id":99,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":"$5$CwsVa87n$YMbJk1lAEGgI1rtoPNTWa53BlSsl4f82jUXuOifeRL4","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$y9oUVzKl$ojeAHHAb3jBXaAfLNpaUb.","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-09 22:27:48 UTC","id":1916,"auditable_id":110,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"drone73.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-09 22:27:28 UTC","id":1915,"auditable_id":98,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"dhcp153-103.rdu.redhat.com","root_pass":"$5$n3Ej75c5$e3o025oX7Y81.dlZUtlypWsgNReb6M43ertUBz1B282","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$n3Ej75c5$e3o025oX7Y81.dlZUtlypWsgNReb6M43ertUBz1B282","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":87,"host_id":98,"uuid":"67e9c3a4-04f5-474d-9bae-a241af47413d","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":102,"host_id":98,"uuid":"67e9c3a4-04f5-474d-9bae-a241af47413d","last_checkin":"2017-10-09T22:25:43.671Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-10-09T22:25:43.830Z","user_id":3}}},{"user_id":3,"user_type":null,"user_name":"admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-10-09 22:27:22 UTC","id":1914,"auditable_id":125,"auditable_name":"register_hostname_fact","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- network.hostname-override\n...\n"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-09 22:25:48 UTC","id":1913,"auditable_id":98,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-09 22:25:47 UTC","id":1912,"auditable_id":98,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-09 22:25:43 UTC","id":1911,"auditable_id":98,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$aPoWeUAq$Pg8mBjCuVKoAtAwhV67EH1","$5$n3Ej75c5$e3o025oX7Y81.dlZUtlypWsgNReb6M43ertUBz1B282"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-09 22:25:43 UTC","id":1910,"auditable_id":98,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"dhcp153-103.rdu.redhat.com","root_pass":"$5$n3Ej75c5$e3o025oX7Y81.dlZUtlypWsgNReb6M43ertUBz1B282","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$aPoWeUAq$Pg8mBjCuVKoAtAwhV67EH1","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-09 22:25:26 UTC","id":1908,"auditable_id":97,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":"$5$8GFW9q1o$F7XfDc120PWp8Yp3H1FyGP/BgkUBuB4BAQKi.DxHCZB","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$8GFW9q1o$F7XfDc120PWp8Yp3H1FyGP/BgkUBuB4BAQKi.DxHCZB","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":86,"host_id":97,"uuid":"e6006d38-77c4-4f65-892d-14bb321e7322","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":101,"host_id":97,"uuid":"e6006d38-77c4-4f65-892d-14bb321e7322","last_checkin":"2017-10-09T22:14:03.986Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-10-09T20:00:20.879Z","user_id":3}}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-10-09 22:24:59 UTC","id":1907,"auditable_id":125,"auditable_name":"register_hostname_fact","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- network.hostname-override\n...\n",null]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-09 20:01:23 UTC","id":1906,"auditable_id":97,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-09 20:01:19 UTC","id":1905,"auditable_id":97,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-09 20:00:27 UTC","id":1904,"auditable_id":97,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-09 20:00:25 UTC","id":1903,"auditable_id":97,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-09 20:00:20 UTC","id":1902,"auditable_id":97,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$Cwd2M0ZE$gP1r4vubnLu7ZJdWWIlN2/","$5$8GFW9q1o$F7XfDc120PWp8Yp3H1FyGP/BgkUBuB4BAQKi.DxHCZB"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-09 20:00:20 UTC","id":1901,"auditable_id":97,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":"$5$8GFW9q1o$F7XfDc120PWp8Yp3H1FyGP/BgkUBuB4BAQKi.DxHCZB","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$Cwd2M0ZE$gP1r4vubnLu7ZJdWWIlN2/","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-09 19:59:59 UTC","id":1899,"auditable_id":96,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":"$5$WC5oSgGT$15ypTD62Ls3UkhY7nAtS.kbQd2kUZvxVb.Y6F6hSR7A","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$WC5oSgGT$15ypTD62Ls3UkhY7nAtS.kbQd2kUZvxVb.Y6F6hSR7A","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":85,"host_id":96,"uuid":"182a2389-a860-40aa-9b0f-e13a57e87585","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":100,"host_id":96,"uuid":"182a2389-a860-40aa-9b0f-e13a57e87585","last_checkin":"2017-10-09T18:14:03.722Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-10-04T14:40:33.705Z","user_id":3}}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-10-09 19:59:53 UTC","id":1898,"auditable_id":125,"auditable_name":"register_hostname_fact","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- network.hostname-override\n...\n"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.120.104","associated_name":null,"created_at":"2017-10-07 18:40:41 UTC","id":1897,"auditable_id":7,"auditable_name":"you guy","auditable_type":"User","action":"destroy","audited_changes":{"login":"student","firstname":"you","lastname":"guy","mail":"guy@admin.local","admin":true,"auth_source_id":1,"locale":null,"avatar_hash":null,"default_organization_id":null,"default_location_id":null,"lower_login":"student","mail_enabled":false,"timezone":""}},{"user_id":3,"user_type":null,"user_name":"admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-07 18:40:24 UTC","id":1896,"auditable_id":91,"auditable_name":"willsat.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"willsat.usersys.redhat.com","root_pass":"$5$p0rSlDz4$vTHeq429J6eI6/intM65UYj8V9MWa5MbRMbENIzKbk6","architecture_id":1,"operatingsystem_id":13,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":7,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$p0rSlDz4$vTHeq429J6eI6/intM65UYj8V9MWa5MbRMbENIzKbk6","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":80,"host_id":91,"uuid":"da502807-ee02-407c-9e66-f099ab570389","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":93,"host_id":91,"uuid":"da502807-ee02-407c-9e66-f099ab570389","last_checkin":"2017-10-07T14:58:05.592Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-09-21T14:14:57.926Z","user_id":null}}},{"user_id":3,"user_type":null,"user_name":"admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-07 18:40:21 UTC","id":1895,"auditable_id":90,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"regclass1.usersys.redhat.com","root_pass":"$5$6nMO0NkI$UCccbnsw6hc9N.NPceirdmfu/vALAQqIKRNHieovDM/","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":7,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$6nMO0NkI$UCccbnsw6hc9N.NPceirdmfu/vALAQqIKRNHieovDM/","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":79,"host_id":90,"uuid":"f261547d-1833-458b-a412-720d243e30eb","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":92,"host_id":90,"uuid":"f261547d-1833-458b-a412-720d243e30eb","last_checkin":"2017-09-26T13:41:57.301Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-09-19T19:58:09.778Z","user_id":null}}},{"user_id":3,"user_type":null,"user_name":"admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-07 18:40:17 UTC","id":1894,"auditable_id":92,"auditable_name":"patsat.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"patsat.usersys.redhat.com","root_pass":"$5$eEoAkbxU$AB7EKm1GSDBSHxgJ9sn/oU2/UiBxwujKCyUyPH4n270","architecture_id":1,"operatingsystem_id":13,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":7,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$eEoAkbxU$AB7EKm1GSDBSHxgJ9sn/oU2/UiBxwujKCyUyPH4n270","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":81,"host_id":92,"uuid":"99d357b8-0058-481f-a1da-338ca8fd9189","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":95,"host_id":92,"uuid":"99d357b8-0058-481f-a1da-338ca8fd9189","last_checkin":"2017-09-21T17:29:22.027Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-09-21T17:24:26.208Z","user_id":null}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-04 18:14:02 UTC","id":1892,"auditable_id":96,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-04 18:13:57 UTC","id":1891,"auditable_id":96,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":3,"user_type":null,"user_name":"admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-10-04 14:41:08 UTC","id":1890,"auditable_id":96,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"name":["dhcp153-103.rdu.redhat.com","drone73.usersys.redhat.com"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-04 14:40:38 UTC","id":1889,"auditable_id":96,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-04 14:40:37 UTC","id":1888,"auditable_id":96,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-04 14:40:33 UTC","id":1887,"auditable_id":96,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$W9OWc2Od$IBAx/sIP70k9FQtXW2Os70","$5$WC5oSgGT$15ypTD62Ls3UkhY7nAtS.kbQd2kUZvxVb.Y6F6hSR7A"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-04 14:40:33 UTC","id":1886,"auditable_id":96,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"dhcp153-103.rdu.redhat.com","root_pass":"$5$WC5oSgGT$15ypTD62Ls3UkhY7nAtS.kbQd2kUZvxVb.Y6F6hSR7A","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$W9OWc2Od$IBAx/sIP70k9FQtXW2Os70","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-04 14:39:44 UTC","id":1884,"auditable_id":95,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"dhcp153-103.rdu.redhat.com","root_pass":"$5$G4HAFJT2$uADzmYDzqGAmRx8JTrbRddFRbR/PMYTe/6cNnTEMLw2","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$G4HAFJT2$uADzmYDzqGAmRx8JTrbRddFRbR/PMYTe/6cNnTEMLw2","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":84,"host_id":95,"uuid":"e0ce24e7-c5f0-4bdc-bdba-cccf9b9f0ce7","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":99,"host_id":95,"uuid":"e0ce24e7-c5f0-4bdc-bdba-cccf9b9f0ce7","last_checkin":"2017-10-04T14:34:09.350Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-10-04T14:32:21.815Z","user_id":3}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-04 14:34:15 UTC","id":1883,"auditable_id":95,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-04 14:34:11 UTC","id":1882,"auditable_id":95,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-04 14:32:26 UTC","id":1881,"auditable_id":95,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-04 14:32:26 UTC","id":1880,"auditable_id":95,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-04 14:32:21 UTC","id":1879,"auditable_id":95,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$lVRTSlgM$4tWrlVj2kGflEwuYnmSpU0","$5$G4HAFJT2$uADzmYDzqGAmRx8JTrbRddFRbR/PMYTe/6cNnTEMLw2"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-04 14:32:21 UTC","id":1878,"auditable_id":95,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"dhcp153-103.rdu.redhat.com","root_pass":"$5$G4HAFJT2$uADzmYDzqGAmRx8JTrbRddFRbR/PMYTe/6cNnTEMLw2","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$lVRTSlgM$4tWrlVj2kGflEwuYnmSpU0","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-04 14:31:49 UTC","id":1876,"auditable_id":94,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"dhcp153-103.rdu.redhat.com","root_pass":"$5$S36JC/m0$q.sEHowAbnatHcq00cIcbamBVR.ckcR8pWOadlNR8s9","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$S36JC/m0$q.sEHowAbnatHcq00cIcbamBVR.ckcR8pWOadlNR8s9","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":83,"host_id":94,"uuid":"5e4eaf2d-5c65-4c6d-b849-eea7f140f8cc","content_view_id":2,"lifecycle_environment_id":2,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":98,"host_id":94,"uuid":"5e4eaf2d-5c65-4c6d-b849-eea7f140f8cc","last_checkin":"2017-10-04T14:13:57.203Z","service_level":null,"release_version":"7Server","autoheal":true,"registered_at":"2017-10-03T15:04:38.886Z","user_id":3}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-03 15:07:55 UTC","id":1875,"auditable_id":94,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-03 15:07:15 UTC","id":1874,"auditable_id":94,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-03 15:04:43 UTC","id":1873,"auditable_id":94,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-03 15:04:42 UTC","id":1872,"auditable_id":94,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-03 15:04:38 UTC","id":1871,"auditable_id":94,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$pWZFgfjQ$0xWwFeBOvvHI/dmzkLpVm0","$5$S36JC/m0$q.sEHowAbnatHcq00cIcbamBVR.ckcR8pWOadlNR8s9"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-10-03 15:04:38 UTC","id":1870,"auditable_id":94,"auditable_name":"dhcp153-103.rdu.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"dhcp153-103.rdu.redhat.com","root_pass":"$5$S36JC/m0$q.sEHowAbnatHcq00cIcbamBVR.ckcR8pWOadlNR8s9","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$pWZFgfjQ$0xWwFeBOvvHI/dmzkLpVm0","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":20,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-10-03 15:03:23 UTC","id":1868,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":"$5$tYiLwJD2$4l1sRfI34.dYWzcDCQobSDvtY6L0vhmTursPXsa/9I9","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$tYiLwJD2$4l1sRfI34.dYWzcDCQobSDvtY6L0vhmTursPXsa/9I9","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":35,"host_id":43,"uuid":"db3edf44-9b11-4086-8ac4-50ea144a6511","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":97,"host_id":43,"uuid":"db3edf44-9b11-4086-8ac4-50ea144a6511","last_checkin":"2017-10-03T14:13:55.988Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-10-03T14:11:06.697Z","user_id":3}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":19,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-03 14:12:12 UTC","id":1867,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":18,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-10-03 14:11:34 UTC","id":1866,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":22,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-29 09:59:19 UTC","id":1864,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":43,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-29 09:59:17 UTC","id":1863,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":59,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-28 11:08:31 UTC","id":1862,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":55,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-09-26 19:18:03 UTC","id":1861,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":42,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-09-26 19:16:53 UTC","id":1860,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":54,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"fe80::5054:ff:fee3:685c","associated_name":null,"created_at":"2017-09-26 19:07:44 UTC","id":1859,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":41,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-09-26 18:19:52 UTC","id":1858,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":21,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-26 18:05:30 UTC","id":1857,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":38,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-26 18:05:18 UTC","id":1856,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":58,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 20:40:08 UTC","id":1855,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":40,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 20:37:50 UTC","id":1854,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":57,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 20:32:54 UTC","id":1853,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":39,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 20:32:53 UTC","id":1852,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":56,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:58:23 UTC","id":1851,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":38,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:57:51 UTC","id":1850,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:45:57 UTC","id":1849,"auditable_id":353,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:45:57 UTC","id":1848,"auditable_id":354,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:45:57 UTC","id":1847,"auditable_id":352,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:45:57 UTC","id":1846,"auditable_id":355,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":134,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:45:56 UTC","id":1845,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:45:55 UTC","id":1844,"auditable_id":355,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":133,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:45:55 UTC","id":1843,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:45:55 UTC","id":1842,"auditable_id":354,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:45:54 UTC","id":1841,"auditable_id":353,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:45:54 UTC","id":1840,"auditable_id":352,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":32,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:43:06 UTC","id":1839,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":31,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:42:32 UTC","id":1838,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:29:15 UTC","id":1837,"auditable_id":349,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:29:14 UTC","id":1836,"auditable_id":350,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:29:14 UTC","id":1835,"auditable_id":348,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:29:14 UTC","id":1834,"auditable_id":351,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":132,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:29:13 UTC","id":1833,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:29:12 UTC","id":1832,"auditable_id":351,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":131,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:29:12 UTC","id":1831,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:29:12 UTC","id":1830,"auditable_id":350,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:29:12 UTC","id":1829,"auditable_id":349,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:29:12 UTC","id":1828,"auditable_id":348,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:27:05 UTC","id":1827,"auditable_id":345,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:27:05 UTC","id":1826,"auditable_id":346,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:27:05 UTC","id":1825,"auditable_id":344,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:27:05 UTC","id":1824,"auditable_id":347,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":130,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:27:04 UTC","id":1823,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:27:03 UTC","id":1822,"auditable_id":347,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":129,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:27:03 UTC","id":1821,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:27:02 UTC","id":1820,"auditable_id":346,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:27:02 UTC","id":1819,"auditable_id":345,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:27:02 UTC","id":1818,"auditable_id":344,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:24:54 UTC","id":1817,"auditable_id":341,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:24:54 UTC","id":1816,"auditable_id":342,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:24:54 UTC","id":1815,"auditable_id":340,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:24:54 UTC","id":1814,"auditable_id":343,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":128,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:24:53 UTC","id":1813,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:24:48 UTC","id":1812,"auditable_id":343,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":127,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:24:48 UTC","id":1811,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:24:48 UTC","id":1810,"auditable_id":342,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:24:48 UTC","id":1809,"auditable_id":341,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-25 19:24:47 UTC","id":1808,"auditable_id":340,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-22 04:01:17 UTC","id":1807,"auditable_id":93,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-22 00:01:01 UTC","id":1806,"auditable_id":93,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-22 00:00:40 UTC","id":1805,"auditable_id":93,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":55,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 23:28:18 UTC","id":1804,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":54,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 23:27:17 UTC","id":1803,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-09-21 23:08:37 UTC","id":1802,"auditable_id":3,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"SmartProxy","action":"update","audited_changes":{"pubkey":[null,"ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAvIQq4P3o/OEtlMqG4KiAI+mxGL/6nHntJ2be3nBM0hkBI+ziY1Ct8iCz/nZcN1Eqw82zJ8pmbjD0J9zQ+ay89Stx5uXQqYnXzp1qfGLTCGJ7xLQyTcCUJlNs+ObagnDXsz4LN6bcY2usyUHiccXDpQCuSzOabf68YvwJuGK5yov88vK5SOiCj5yt0FezEdrTSszs7xuX855pslyLkWl1ySin7mxaMQrGZepKFJVo3mRSyN1c0d9UCLJlNOfTXrHS5w+BED5gaiBzTZ34GeaI58abZ89hiZwfnrJr9xZHhHWqOyKtcpY78kK6GVIbH0CKZA+jDWS7tqro+X3jtAcByQ== foreman-proxy@riddler.usersys.redhat.com"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":37,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 20:14:38 UTC","id":1801,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":36,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 20:13:58 UTC","id":1800,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-09-21 20:13:32 UTC","id":1799,"auditable_id":4,"auditable_name":"joker.usersys.redhat.com","auditable_type":"SmartProxy","action":"update","audited_changes":{"pubkey":[null,"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDBm4M9qS7S2xgxGPDd4lm2ET76+U9CTE1VPoVurgDNA3iwJzWaTKd3vVuh6QK6HnACKkYsczEeIfcxX1egfbaDjgqCmIeYW+QJEn78da9EdT1wYusRN443ATcKdyml3Mr8p/veWbvqlsrWEncD5QKdNXs3eYCbIKgthBz9Bms0GGOnXnwhZPw/sN0qKVLKVv+N8Y30s5oL3v4LiQiN8DcWXh5hyk9x/NbNKze+PMtGRxhWyjLJRlbAMAUSUhcrjOxWl4ipdULjZ/6hZok3+f9eUPL4x6C+zzMU5qx+JE9EYMQrUaf+OAvH0p1qYpB4Jc+n0t1q082xhtWeo7DnrWBd foreman-proxy@joker.usersys.redhat.com"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":35,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 20:13:03 UTC","id":1798,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 20:08:58 UTC","id":1797,"auditable_id":93,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 20:08:58 UTC","id":1796,"auditable_id":93,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-09-21 20:08:54 UTC","id":1795,"auditable_id":93,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$x2JCsXXg$jpVSUR.CO/3nev72Pj3w2/","$5$FDagHjSl$VXnrHzUe2ig4daSDqz0N7e403nC0jr.nhpn0EqDNfB9"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-09-21 20:08:54 UTC","id":1794,"auditable_id":93,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone68.usersys.redhat.com","root_pass":"$5$FDagHjSl$VXnrHzUe2ig4daSDqz0N7e403nC0jr.nhpn0EqDNfB9","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$x2JCsXXg$jpVSUR.CO/3nev72Pj3w2/","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":26,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.160","associated_name":null,"created_at":"2017-09-21 20:08:04 UTC","id":1792,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone68.usersys.redhat.com","root_pass":"$5$Pysd9Z3m$.GOW/1DoDHTTymRQ/WEoeIYBW3P.TdpTIiIClUDt3B/","architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$Pysd9Z3m$.GOW/1DoDHTTymRQ/WEoeIYBW3P.TdpTIiIClUDt3B/","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":8,"host_id":13,"uuid":"bbeccd41-aa43-48a9-a604-1790cc0ddcf0","content_view_id":4,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":44,"host_id":13,"uuid":"bbeccd41-aa43-48a9-a604-1790cc0ddcf0","last_checkin":"2017-09-21T20:00:31.368Z","service_level":null,"release_version":"6.8","autoheal":true,"registered_at":"2017-01-24T16:53:29.512Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 17:25:01 UTC","id":1789,"auditable_id":92,"auditable_name":"patsat.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 17:24:30 UTC","id":1788,"auditable_id":92,"auditable_name":"patsat.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 14:21:27 UTC","id":1786,"auditable_id":91,"auditable_name":"willsat.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 14:20:54 UTC","id":1785,"auditable_id":92,"auditable_name":"patsat.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 14:19:58 UTC","id":1784,"auditable_id":92,"auditable_name":"patsat.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 14:19:57 UTC","id":1783,"auditable_id":92,"auditable_name":"patsat.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,13]}},{"user_id":7,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.141","associated_name":null,"created_at":"2017-09-21 14:19:53 UTC","id":1782,"auditable_id":92,"auditable_name":"patsat.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$C/veK2Yn$VsKUfoHJ9nmKCRRRVgY3g0","$5$eEoAkbxU$AB7EKm1GSDBSHxgJ9sn/oU2/UiBxwujKCyUyPH4n270"]}},{"user_id":7,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.141","associated_name":null,"created_at":"2017-09-21 14:19:53 UTC","id":1781,"auditable_id":92,"auditable_name":"patsat.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"patsat.usersys.redhat.com","root_pass":"$5$eEoAkbxU$AB7EKm1GSDBSHxgJ9sn/oU2/UiBxwujKCyUyPH4n270","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":7,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$C/veK2Yn$VsKUfoHJ9nmKCRRRVgY3g0","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 14:15:17 UTC","id":1779,"auditable_id":91,"auditable_name":"willsat.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-21 14:15:15 UTC","id":1778,"auditable_id":91,"auditable_name":"willsat.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,13]}},{"user_id":7,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.68","associated_name":null,"created_at":"2017-09-21 14:14:56 UTC","id":1777,"auditable_id":91,"auditable_name":"willsat.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$vRgSoCUE$SThu92NfMtw1dbBGqKPYn/","$5$p0rSlDz4$vTHeq429J6eI6/intM65UYj8V9MWa5MbRMbENIzKbk6"]}},{"user_id":7,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.68","associated_name":null,"created_at":"2017-09-21 14:14:56 UTC","id":1776,"auditable_id":91,"auditable_name":"willsat.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"willsat.usersys.redhat.com","root_pass":"$5$p0rSlDz4$vTHeq429J6eI6/intM65UYj8V9MWa5MbRMbENIzKbk6","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":7,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$vRgSoCUE$SThu92NfMtw1dbBGqKPYn/","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:59:56 UTC","id":1774,"auditable_id":90,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:59:54 UTC","id":1773,"auditable_id":90,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:59:52 UTC","id":1772,"auditable_id":90,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:58:14 UTC","id":1771,"auditable_id":90,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:58:13 UTC","id":1770,"auditable_id":90,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":7,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.12.214.218","associated_name":null,"created_at":"2017-09-19 19:58:09 UTC","id":1769,"auditable_id":90,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$gQCXNlEc$pZjKGOuqtlOsUjsPD64yZ0","$5$6nMO0NkI$UCccbnsw6hc9N.NPceirdmfu/vALAQqIKRNHieovDM/"]}},{"user_id":7,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.12.214.218","associated_name":null,"created_at":"2017-09-19 19:58:09 UTC","id":1768,"auditable_id":90,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"regclass1.usersys.redhat.com","root_pass":"$5$6nMO0NkI$UCccbnsw6hc9N.NPceirdmfu/vALAQqIKRNHieovDM/","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":7,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$gQCXNlEc$pZjKGOuqtlOsUjsPD64yZ0","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.12.214.218","associated_name":null,"created_at":"2017-09-19 19:57:52 UTC","id":1766,"auditable_id":89,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"regclass1.usersys.redhat.com","root_pass":"$5$vBpL2gdA$qM.BaBMr3iUxURVbiI0qVh/ToRn..lQLQVrnRhUqyo8","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":7,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$vBpL2gdA$qM.BaBMr3iUxURVbiI0qVh/ToRn..lQLQVrnRhUqyo8","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":78,"host_id":89,"uuid":"d1b9ca98-e9ce-4e9a-b235-f68b89594c21","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":91,"host_id":89,"uuid":"d1b9ca98-e9ce-4e9a-b235-f68b89594c21","last_checkin":"2017-09-19T19:44:02.352Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-09-19T19:44:02.493Z"}}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:44:07 UTC","id":1765,"auditable_id":89,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:44:06 UTC","id":1764,"auditable_id":89,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":7,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.12.214.218","associated_name":null,"created_at":"2017-09-19 19:44:02 UTC","id":1763,"auditable_id":89,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$VgfHOk3S$mkhrnKfTYO/ROHNDF8OKp1","$5$vBpL2gdA$qM.BaBMr3iUxURVbiI0qVh/ToRn..lQLQVrnRhUqyo8"]}},{"user_id":7,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.12.214.218","associated_name":null,"created_at":"2017-09-19 19:44:02 UTC","id":1762,"auditable_id":89,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"regclass1.usersys.redhat.com","root_pass":"$5$vBpL2gdA$qM.BaBMr3iUxURVbiI0qVh/ToRn..lQLQVrnRhUqyo8","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":7,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$VgfHOk3S$mkhrnKfTYO/ROHNDF8OKp1","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.105","associated_name":null,"created_at":"2017-09-19 19:43:25 UTC","id":1760,"auditable_id":88,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"regclass1.usersys.redhat.com","root_pass":"$5$OYuuhGZW$TOR4pkqTnB/Uxw3Jp4Gr3MVqX.9urxWlio0azxV9ed4","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":7,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$OYuuhGZW$TOR4pkqTnB/Uxw3Jp4Gr3MVqX.9urxWlio0azxV9ed4","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":77,"host_id":88,"uuid":"16c2b2cc-ff87-4d12-8b6f-98c06db40e1a","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":90,"host_id":88,"uuid":"16c2b2cc-ff87-4d12-8b6f-98c06db40e1a","last_checkin":"2017-09-19T19:42:19.487Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-09-19T19:42:19.799Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:42:24 UTC","id":1758,"auditable_id":88,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:42:23 UTC","id":1757,"auditable_id":88,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":7,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.105","associated_name":null,"created_at":"2017-09-19 19:42:19 UTC","id":1756,"auditable_id":88,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$lwy8gdLn$3xAb31WvZzcr30YXUPZis0","$5$OYuuhGZW$TOR4pkqTnB/Uxw3Jp4Gr3MVqX.9urxWlio0azxV9ed4"]}},{"user_id":7,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.105","associated_name":null,"created_at":"2017-09-19 19:42:19 UTC","id":1755,"auditable_id":88,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"regclass1.usersys.redhat.com","root_pass":"$5$OYuuhGZW$TOR4pkqTnB/Uxw3Jp4Gr3MVqX.9urxWlio0azxV9ed4","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":7,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$lwy8gdLn$3xAb31WvZzcr30YXUPZis0","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.105","associated_name":null,"created_at":"2017-09-19 19:34:42 UTC","id":1753,"auditable_id":87,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"regclass1.usersys.redhat.com","root_pass":"$5$il19RcoK$EmHilQZhJmq.2df/kul37JVpwOJipSKCyG7p/shvbb6","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":7,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$il19RcoK$EmHilQZhJmq.2df/kul37JVpwOJipSKCyG7p/shvbb6","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":76,"host_id":87,"uuid":"e14165f9-74ea-4ed8-9cb7-6f7c95a27b2d","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":89,"host_id":87,"uuid":"e14165f9-74ea-4ed8-9cb7-6f7c95a27b2d","last_checkin":"2017-09-19T19:30:54.829Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-09-19T19:06:27.598Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:29:46 UTC","id":1752,"auditable_id":87,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:29:16 UTC","id":1751,"auditable_id":87,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:21:43 UTC","id":1750,"auditable_id":87,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:21:41 UTC","id":1749,"auditable_id":87,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:21:37 UTC","id":1748,"auditable_id":87,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:21:37 UTC","id":1747,"auditable_id":87,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:08:56 UTC","id":1746,"auditable_id":87,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:08:53 UTC","id":1745,"auditable_id":87,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:06:33 UTC","id":1744,"auditable_id":87,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 19:06:32 UTC","id":1743,"auditable_id":87,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":7,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.105","associated_name":null,"created_at":"2017-09-19 19:06:27 UTC","id":1742,"auditable_id":87,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$n27ke1Ev$SyksExS4P6UG.bjIkfTpM/","$5$il19RcoK$EmHilQZhJmq.2df/kul37JVpwOJipSKCyG7p/shvbb6"]}},{"user_id":7,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.105","associated_name":null,"created_at":"2017-09-19 19:06:27 UTC","id":1741,"auditable_id":87,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"regclass1.usersys.redhat.com","root_pass":"$5$il19RcoK$EmHilQZhJmq.2df/kul37JVpwOJipSKCyG7p/shvbb6","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":7,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$n27ke1Ev$SyksExS4P6UG.bjIkfTpM/","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.123.103","associated_name":null,"created_at":"2017-09-19 19:05:00 UTC","id":1739,"auditable_id":7,"auditable_name":"you guy","auditable_type":"User","action":"create","audited_changes":{"login":"student","firstname":"you","lastname":"guy","mail":"guy@admin.local","admin":true,"auth_source_id":1,"locale":null,"avatar_hash":null,"default_organization_id":null,"default_location_id":null,"lower_login":"student","mail_enabled":false,"timezone":""}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.105","associated_name":null,"created_at":"2017-09-19 18:40:03 UTC","id":1738,"auditable_id":80,"auditable_name":"dhcp153-158.rdu.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"dhcp153-158.rdu.redhat.com","root_pass":"$5$fl0+tLZr$ZuS2Rp2nkO/oGuNuvA4OdnH.w5WHYPdgJHeE1.T2eh3","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$fl0+tLZr$ZuS2Rp2nkO/oGuNuvA4OdnH.w5WHYPdgJHeE1.T2eh3","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":69,"host_id":80,"uuid":"1ce02e15-c069-4197-8ab0-81e24a0ccc3f","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":82,"host_id":80,"uuid":"1ce02e15-c069-4197-8ab0-81e24a0ccc3f","last_checkin":"2017-09-19T17:44:25.752Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-07-18T20:48:14.178Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-19 17:42:31 UTC","id":1737,"auditable_id":80,"auditable_name":"dhcp153-158.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-15 16:17:52 UTC","id":1736,"auditable_id":14,"auditable_name":"Base_Org/Library/Red_Hat_Server/Red_Hat_Enterprise_Linux_7_Server_Kickstart_x86_64_7_4","auditable_type":"Medium","action":"create","audited_changes":{"name":"Base_Org/Library/Red_Hat_Server/Red_Hat_Enterprise_Linux_7_Server_Kickstart_x86_64_7_4","path":"http://batman.usersys.redhat.com/pulp/repos/Base_Org/Library/content/dist/rhel/server/7/7.4/x86_64/kickstart/","media_path":null,"config_path":null,"image_path":null,"os_family":"Redhat"}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-09-15 14:53:27 UTC","id":1735,"auditable_id":41,"auditable_name":"entries_per_page","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- 40\n...\n"]}},{"user_id":6,"user_type":null,"user_name":"crag","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.12.214.239","associated_name":null,"created_at":"2017-09-14 14:54:50 UTC","id":1734,"auditable_id":6,"auditable_name":"crag","auditable_type":"User","action":"update","audited_changes":{"mail":["","root@localhost"],"firstname":["","crag"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.12.214.239","associated_name":null,"created_at":"2017-09-14 14:54:19 UTC","id":1733,"auditable_id":6,"auditable_name":"crag","auditable_type":"User","action":"update","audited_changes":{"default_organization_id":[null,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.12.214.239","associated_name":null,"created_at":"2017-09-14 14:53:51 UTC","id":1732,"auditable_id":6,"auditable_name":"crag","auditable_type":"User","action":"create","audited_changes":{"login":"crag","firstname":"","lastname":"","mail":"","admin":true,"auth_source_id":1,"locale":null,"avatar_hash":null,"default_organization_id":null,"default_location_id":null,"lower_login":"crag","mail_enabled":true,"timezone":""}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":20,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-13 10:28:04 UTC","id":1731,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":37,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-13 10:27:26 UTC","id":1730,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-09-11 20:23:03 UTC","id":1729,"auditable_id":11,"auditable_name":"E4S","auditable_type":"Organization","action":"create","audited_changes":{"name":"E4S","ignore_types":[],"description":"","label":"E4S","ancestry":null,"katello_default":false}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":17,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-07 09:42:31 UTC","id":1728,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":19,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-06 09:46:59 UTC","id":1727,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":36,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-06 09:46:46 UTC","id":1726,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-01 16:14:41 UTC","id":1725,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-09-01 16:09:31 UTC","id":1724,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":25,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-31 21:28:17 UTC","id":1723,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":24,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-31 21:26:54 UTC","id":1722,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-08-29 15:59:52 UTC","id":1721,"auditable_id":4,"auditable_name":"RedHat 7.3","auditable_type":"Operatingsystem","action":"update","audited_changes":{"description":[null,""],"release_name":[null,""]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-08-29 15:59:29 UTC","id":1720,"auditable_id":13,"auditable_name":"joker7.3","auditable_type":"Medium","action":"create","audited_changes":{"name":"joker7.3","path":"http://joker.usersys.redhat.com/pulp/repos/Base_Org/Library/content/dist/rhel/server/7/7.3/x86_64/kickstart/","media_path":"","config_path":"","image_path":"","os_family":"Redhat"}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-29 11:33:23 UTC","id":1719,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-25 18:08:34 UTC","id":1718,"auditable_id":86,"auditable_name":"teststuff.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.169","associated_name":null,"created_at":"2017-08-25 18:08:33 UTC","id":1717,"auditable_id":86,"auditable_name":"teststuff.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-25 14:52:21 UTC","id":1716,"auditable_id":86,"auditable_name":"teststuff.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-25 14:52:13 UTC","id":1715,"auditable_id":86,"auditable_name":"teststuff.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-25 14:52:02 UTC","id":1714,"auditable_id":86,"auditable_name":"teststuff.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-25 14:52:00 UTC","id":1713,"auditable_id":86,"auditable_name":"teststuff.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.169","associated_name":null,"created_at":"2017-08-25 14:51:54 UTC","id":1712,"auditable_id":86,"auditable_name":"teststuff.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$kejphpiU$moGh6QmxQP4i0jebay8jz.","$5$bSyHANVR$FdFl7Uw8BMI4HSs/cWY9rsDza3zI9ZSv/wx71OxrkZ6"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.169","associated_name":null,"created_at":"2017-08-25 14:51:54 UTC","id":1711,"auditable_id":86,"auditable_name":"teststuff.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"teststuff.usersys.redhat.com","root_pass":"$5$bSyHANVR$FdFl7Uw8BMI4HSs/cWY9rsDza3zI9ZSv/wx71OxrkZ6","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$kejphpiU$moGh6QmxQP4i0jebay8jz.","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-21 21:38:12 UTC","id":1709,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-21 21:38:08 UTC","id":1708,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-21 21:37:54 UTC","id":1707,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-21 21:37:53 UTC","id":1706,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,13]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.85","associated_name":null,"created_at":"2017-08-21 21:37:48 UTC","id":1705,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$mNqIIS5v$gGry0D7TNIV0FJlAxjP8n1","$5$vM3uc+7a$2D7hbVTALFKSlOM4epm/lMj6U6PsLp8CcP7.m/jRoa4"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.85","associated_name":null,"created_at":"2017-08-21 21:37:48 UTC","id":1704,"auditable_id":85,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"splinter.usersys.redhat.com","root_pass":"$5$vM3uc+7a$2D7hbVTALFKSlOM4epm/lMj6U6PsLp8CcP7.m/jRoa4","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$mNqIIS5v$gGry0D7TNIV0FJlAxjP8n1","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.85","associated_name":null,"created_at":"2017-08-21 21:37:48 UTC","id":1703,"auditable_id":94,"auditable_name":"splinter.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"splinter.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":18,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.10","associated_name":null,"created_at":"2017-08-18 07:15:14 UTC","id":1702,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":null,"user_type":null,"user_name":null,"version":35,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-18 04:53:13 UTC","id":1701,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":34,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.94","associated_name":null,"created_at":"2017-08-18 04:53:11 UTC","id":1700,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":33,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-18 03:45:53 UTC","id":1699,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":17,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-18 03:32:21 UTC","id":1698,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-16 19:09:51 UTC","id":1697,"auditable_id":84,"auditable_name":"testfacts.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-16 19:09:03 UTC","id":1696,"auditable_id":84,"auditable_name":"testfacts.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-16 19:09:01 UTC","id":1695,"auditable_id":84,"auditable_name":"testfacts.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-16 19:09:01 UTC","id":1694,"auditable_id":84,"auditable_name":"testfacts.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-16 15:12:33 UTC","id":1693,"auditable_id":84,"auditable_name":"testfacts.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-16 15:12:13 UTC","id":1692,"auditable_id":84,"auditable_name":"testfacts.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-16 15:12:11 UTC","id":1691,"auditable_id":84,"auditable_name":"testfacts.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"operatingsystem_id":[null,11]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2017-08-16 15:12:06 UTC","id":1690,"auditable_id":84,"auditable_name":"testfacts.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$6CZOYg72$/nmoNYmAtwQIPJ4wv8q5M.","$5$GGiSiFEi$17eNuDqMhZknCxJGfk76l29Agz/x7tHzDD/42Ml0HY9"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2017-08-16 15:12:06 UTC","id":1689,"auditable_id":84,"auditable_name":"testfacts.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"testfacts.usersys.redhat.com","root_pass":"$5$GGiSiFEi$17eNuDqMhZknCxJGfk76l29Agz/x7tHzDD/42Ml0HY9","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$6CZOYg72$/nmoNYmAtwQIPJ4wv8q5M.","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":53,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-16 10:17:20 UTC","id":1687,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":34,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-16 10:07:44 UTC","id":1686,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":33,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 20:21:44 UTC","id":1685,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:06:53 UTC","id":1684,"auditable_id":337,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:06:53 UTC","id":1683,"auditable_id":338,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:06:53 UTC","id":1682,"auditable_id":336,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:06:53 UTC","id":1681,"auditable_id":339,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":126,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:06:52 UTC","id":1680,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:06:50 UTC","id":1679,"auditable_id":339,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":125,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:06:50 UTC","id":1678,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:06:50 UTC","id":1677,"auditable_id":338,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:06:50 UTC","id":1676,"auditable_id":337,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:06:50 UTC","id":1675,"auditable_id":336,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:01:36 UTC","id":1674,"auditable_id":333,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:01:36 UTC","id":1673,"auditable_id":334,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:01:36 UTC","id":1672,"auditable_id":332,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:01:35 UTC","id":1671,"auditable_id":335,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":124,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 19:01:34 UTC","id":1670,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable='rhel-*-satellite-tools-*-rpms'\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":null,"user_type":null,"user_name":null,"version":30,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 18:59:56 UTC","id":1669,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":29,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 18:59:18 UTC","id":1668,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 18:50:32 UTC","id":1667,"auditable_id":335,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":123,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 18:50:32 UTC","id":1666,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 18:50:32 UTC","id":1665,"auditable_id":334,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 18:50:32 UTC","id":1664,"auditable_id":333,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 18:50:32 UTC","id":1663,"auditable_id":332,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":53,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-08-13 18:25:24 UTC","id":1662,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":32,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-08-13 18:24:02 UTC","id":1661,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[4,13]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-08-13 18:23:55 UTC","id":1660,"auditable_id":13,"auditable_name":"RedHat 7.4","auditable_type":"Operatingsystem","action":"create","audited_changes":{"major":"7","name":"RedHat","minor":"4","nameindicator":null,"release_name":null,"description":null,"password_hash":"SHA256","title":"RedHat 7.4"}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":52,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-08-13 18:16:37 UTC","id":1659,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":51,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-13 18:16:11 UTC","id":1658,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-01 21:54:34 UTC","id":1657,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-01 21:54:18 UTC","id":1656,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-01 21:54:18 UTC","id":1655,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.54","associated_name":null,"created_at":"2017-08-01 21:54:08 UTC","id":1654,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$y3p75NcB$B3HS3HNzq/KGJ633qRyc6.","$5$J+ab+FzO$epibs08rL.v84kKHYxSYXOpFTgDs.VLLX54hBmC3Q03"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.54","associated_name":null,"created_at":"2017-08-01 21:54:08 UTC","id":1653,"auditable_id":83,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"cds3-1.usersys.redhat.com","root_pass":"$5$J+ab+FzO$epibs08rL.v84kKHYxSYXOpFTgDs.VLLX54hBmC3Q03","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$y3p75NcB$B3HS3HNzq/KGJ633qRyc6.","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.54","associated_name":null,"created_at":"2017-08-01 21:54:08 UTC","id":1652,"auditable_id":92,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"cds3-1.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-01 21:53:57 UTC","id":1651,"auditable_id":82,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.54","associated_name":null,"created_at":"2017-08-01 21:50:05 UTC","id":1650,"auditable_id":81,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"cds3-1.usersys.redhat.com","root_pass":"$5$68cXWWgC$PmZijzrMBfTTpMy6KsfRO4DZlpMuVhLB2c4sbaMB7r6","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$68cXWWgC$PmZijzrMBfTTpMy6KsfRO4DZlpMuVhLB2c4sbaMB7r6","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":70,"host_id":81,"uuid":"150a3989-37ca-478d-8b21-eb7b791bc289","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":83,"host_id":81,"uuid":"150a3989-37ca-478d-8b21-eb7b791bc289","last_checkin":"2017-08-01T21:47:01.259Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-08-01T21:47:01.546Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-01 21:47:20 UTC","id":1649,"auditable_id":82,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-01 21:47:18 UTC","id":1648,"auditable_id":82,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-01 21:47:14 UTC","id":1647,"auditable_id":81,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-08-01 21:47:12 UTC","id":1646,"auditable_id":81,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.147","associated_name":null,"created_at":"2017-08-01 21:47:07 UTC","id":1645,"auditable_id":82,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$sw78pdiD$Xvrj/N/qRG7kT9d0oC.SX0","$5$mWkvEV+x$Fmi7mvgko1AnCvJUAgyR3PZsCVjhPBfPlUBTGFZj70B"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.147","associated_name":null,"created_at":"2017-08-01 21:47:07 UTC","id":1644,"auditable_id":82,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"cds3-2.usersys.redhat.com","root_pass":"$5$mWkvEV+x$Fmi7mvgko1AnCvJUAgyR3PZsCVjhPBfPlUBTGFZj70B","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$sw78pdiD$Xvrj/N/qRG7kT9d0oC.SX0","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.147","associated_name":null,"created_at":"2017-08-01 21:47:07 UTC","id":1643,"auditable_id":91,"auditable_name":"cds3-2.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"cds3-2.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.54","associated_name":null,"created_at":"2017-08-01 21:47:01 UTC","id":1642,"auditable_id":81,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$KEesHlAf$Bciu3ljIbEfIzaQf3b2fj.","$5$68cXWWgC$PmZijzrMBfTTpMy6KsfRO4DZlpMuVhLB2c4sbaMB7r6"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.54","associated_name":null,"created_at":"2017-08-01 21:47:01 UTC","id":1641,"auditable_id":81,"auditable_name":"cds3-1.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"cds3-1.usersys.redhat.com","root_pass":"$5$68cXWWgC$PmZijzrMBfTTpMy6KsfRO4DZlpMuVhLB2c4sbaMB7r6","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$KEesHlAf$Bciu3ljIbEfIzaQf3b2fj.","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-18 20:49:42 UTC","id":1639,"auditable_id":80,"auditable_name":"dhcp153-158.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-18 20:48:23 UTC","id":1638,"auditable_id":80,"auditable_name":"dhcp153-158.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-18 20:48:21 UTC","id":1637,"auditable_id":80,"auditable_name":"dhcp153-158.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.158","associated_name":null,"created_at":"2017-07-18 20:48:13 UTC","id":1636,"auditable_id":80,"auditable_name":"dhcp153-158.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$ti0Cx71o$K8BSHfsfgfBtYLYSgzYm21","$5$fl0+tLZr$ZuS2Rp2nkO/oGuNuvA4OdnH.w5WHYPdgJHeE1.T2eh3"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.158","associated_name":null,"created_at":"2017-07-18 20:48:13 UTC","id":1635,"auditable_id":80,"auditable_name":"dhcp153-158.rdu.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"dhcp153-158.rdu.redhat.com","root_pass":"$5$fl0+tLZr$ZuS2Rp2nkO/oGuNuvA4OdnH.w5WHYPdgJHeE1.T2eh3","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$ti0Cx71o$K8BSHfsfgfBtYLYSgzYm21","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.158","associated_name":null,"created_at":"2017-07-18 20:29:09 UTC","id":1633,"auditable_id":79,"auditable_name":"dhcp153-158.rdu.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"dhcp153-158.rdu.redhat.com","root_pass":"$5$d+aKBRTb$TPNi7fR26qYO1its0dL5tW41TGKSwjq3FFJCPLqlY16","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$d+aKBRTb$TPNi7fR26qYO1its0dL5tW41TGKSwjq3FFJCPLqlY16","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":68,"host_id":79,"uuid":"14b30740-0621-4e64-bbf4-02c44ad38d08","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":81,"host_id":79,"uuid":"14b30740-0621-4e64-bbf4-02c44ad38d08","last_checkin":"2017-07-18T20:27:21.754Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-07-18T20:25:04.238Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-18 20:27:23 UTC","id":1632,"auditable_id":79,"auditable_name":"dhcp153-158.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-18 20:25:15 UTC","id":1631,"auditable_id":79,"auditable_name":"dhcp153-158.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-18 20:25:13 UTC","id":1630,"auditable_id":79,"auditable_name":"dhcp153-158.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.158","associated_name":null,"created_at":"2017-07-18 20:25:04 UTC","id":1629,"auditable_id":79,"auditable_name":"dhcp153-158.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$EdYemve8$kbXEE1E/4wv2HSe3fJ7S0.","$5$d+aKBRTb$TPNi7fR26qYO1its0dL5tW41TGKSwjq3FFJCPLqlY16"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.158","associated_name":null,"created_at":"2017-07-18 20:25:03 UTC","id":1628,"auditable_id":79,"auditable_name":"dhcp153-158.rdu.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"dhcp153-158.rdu.redhat.com","root_pass":"$5$d+aKBRTb$TPNi7fR26qYO1its0dL5tW41TGKSwjq3FFJCPLqlY16","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$EdYemve8$kbXEE1E/4wv2HSe3fJ7S0.","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":52,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-07-12 22:25:28 UTC","id":1626,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":51,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-07-12 21:57:19 UTC","id":1625,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:12:38 UTC","id":1624,"auditable_id":27,"auditable_name":"camworkstation.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$j1PcxJT9$5oMthMuOxoWp5g7YT9NrS0","$5$rMJfEtFK$bu7uTE62Ap3hZC3kyFQGG7ogivhE9oLCZtztc2gOas9"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:11:34 UTC","id":1623,"auditable_id":329,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:11:34 UTC","id":1622,"auditable_id":330,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:11:34 UTC","id":1621,"auditable_id":328,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:11:34 UTC","id":1620,"auditable_id":331,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":122,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:11:33 UTC","id":1619,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:11:32 UTC","id":1618,"auditable_id":331,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":121,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:11:32 UTC","id":1617,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:11:32 UTC","id":1616,"auditable_id":330,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:11:32 UTC","id":1615,"auditable_id":329,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:11:32 UTC","id":1614,"auditable_id":328,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:06:55 UTC","id":1613,"auditable_id":325,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:06:55 UTC","id":1612,"auditable_id":326,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:06:55 UTC","id":1611,"auditable_id":324,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:06:54 UTC","id":1610,"auditable_id":327,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":120,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:06:53 UTC","id":1609,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:06:52 UTC","id":1608,"auditable_id":327,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":119,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:06:52 UTC","id":1607,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:06:51 UTC","id":1606,"auditable_id":326,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:06:51 UTC","id":1605,"auditable_id":325,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:06:51 UTC","id":1604,"auditable_id":324,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":28,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:05:17 UTC","id":1603,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":27,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-10 19:04:43 UTC","id":1602,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.36","associated_name":null,"created_at":"2017-07-07 13:19:32 UTC","id":1601,"auditable_id":78,"auditable_name":"rhua3.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"rhua3.usersys.redhat.com","root_pass":"$5$YSd4qUid$z.o.d6a12VRz1MGCcyLKdGsjfK1DnTRioQsr1.HEiV2","architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$YSd4qUid$z.o.d6a12VRz1MGCcyLKdGsjfK1DnTRioQsr1.HEiV2","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":67,"host_id":78,"uuid":"7bc3689e-add8-46ed-a29d-a253e4746093","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":80,"host_id":78,"uuid":"7bc3689e-add8-46ed-a29d-a253e4746093","last_checkin":"2017-07-07T13:12:36.839Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-07-07T13:11:27.549Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-07 13:12:29 UTC","id":1600,"auditable_id":78,"auditable_name":"rhua3.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-07 13:11:35 UTC","id":1599,"auditable_id":78,"auditable_name":"rhua3.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-07 13:11:34 UTC","id":1598,"auditable_id":78,"auditable_name":"rhua3.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.36","associated_name":null,"created_at":"2017-07-07 13:11:27 UTC","id":1597,"auditable_id":78,"auditable_name":"rhua3.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$8XhTaNtW$tZOAnrpvOSbVtI8O4wDNO.","$5$YSd4qUid$z.o.d6a12VRz1MGCcyLKdGsjfK1DnTRioQsr1.HEiV2"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.36","associated_name":null,"created_at":"2017-07-07 13:11:27 UTC","id":1596,"auditable_id":78,"auditable_name":"rhua3.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"rhua3.usersys.redhat.com","root_pass":"$5$YSd4qUid$z.o.d6a12VRz1MGCcyLKdGsjfK1DnTRioQsr1.HEiV2","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$8XhTaNtW$tZOAnrpvOSbVtI8O4wDNO.","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-07-06 18:43:38 UTC","id":1594,"auditable_id":76,"auditable_name":"bombitch.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"bombitch.usersys.redhat.com","root_pass":"$5$GgknYfDP$HZ25j274qU93kU1fGY9HcIv24e.mGqdR6tx4o/WqAK5","architecture_id":1,"operatingsystem_id":4,"environment_id":2,"ptable_id":61,"medium_id":null,"build":false,"comment":"","disk":"","installed_at":"2017-07-05T22:06:36.888Z","model_id":null,"hostgroup_id":2,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":1,"managed":true,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":1,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":"build","content_source_id":1,"grub_pass":"$5$GgknYfDP$HZ25j274qU93kU1fGY9HcIv24e.mGqdR6tx4o/WqAK5","content_view_id":1,"lifecycle_environment_id":1,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":65,"host_id":76,"uuid":null,"content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":110}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-06 18:40:01 UTC","id":1593,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-06 18:39:47 UTC","id":1592,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-06 18:39:45 UTC","id":1591,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.101","associated_name":null,"created_at":"2017-07-06 18:39:36 UTC","id":1590,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$KDIOQWLF$YNXlCj5JQnn/9OTo6OkYC0","$5$NowElik1$kMGSvB5BD/qpwizEI2Qg5heOBoOQC0vDfTp65xTsDP7"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.101","associated_name":null,"created_at":"2017-07-06 18:39:36 UTC","id":1589,"auditable_id":77,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"rhui3nfs.usersys.redhat.com","root_pass":"$5$NowElik1$kMGSvB5BD/qpwizEI2Qg5heOBoOQC0vDfTp65xTsDP7","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$KDIOQWLF$YNXlCj5JQnn/9OTo6OkYC0","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.101","associated_name":null,"created_at":"2017-07-06 18:39:36 UTC","id":1588,"auditable_id":86,"auditable_name":"rhui3nfs.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"rhui3nfs.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-06 12:42:15 UTC","id":1587,"auditable_id":45,"auditable_name":"disconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$KeJUKmar$qxkvxB33nqsqvkdIQYKwZ0","$5$HBoHDloe$KeJu.3UHedcDrhXvoapxYEZZqWgVH8XF9uI3.7MEfu3"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"192.168.100.102","associated_name":null,"created_at":"2017-07-05 22:06:37 UTC","id":1586,"auditable_id":76,"auditable_name":"bombitch.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"build":[true,false],"installed_at":[null,"2017-07-05T22:06:36.888Z"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.122.209","associated_name":null,"created_at":"2017-07-05 21:08:45 UTC","id":1585,"auditable_id":76,"auditable_name":"bombitch.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"bombitch.usersys.redhat.com","root_pass":"$5$GgknYfDP$HZ25j274qU93kU1fGY9HcIv24e.mGqdR6tx4o/WqAK5","architecture_id":1,"operatingsystem_id":4,"environment_id":2,"ptable_id":61,"medium_id":null,"build":true,"comment":"","disk":"","installed_at":null,"model_id":null,"hostgroup_id":2,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":1,"managed":true,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":1,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":"build","content_source_id":1,"grub_pass":"$5$GgknYfDP$HZ25j274qU93kU1fGY9HcIv24e.mGqdR6tx4o/WqAK5","content_view_id":1,"lifecycle_environment_id":1,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":null,"host_id":null,"uuid":null,"content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":110}}},{"user_id":3,"user_type":null,"user_name":"admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.122.209","associated_name":null,"created_at":"2017-07-05 21:07:54 UTC","id":1584,"auditable_id":1,"auditable_name":"usersys.redhat.com","auditable_type":"Domain","action":"update","audited_changes":{"dns_id":[1,null]}},{"user_id":3,"user_type":null,"user_name":"admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.122.209","associated_name":null,"created_at":"2017-07-05 21:06:59 UTC","id":1583,"auditable_id":1,"auditable_name":"taft.prov (192.168.100.0/24)","auditable_type":"Subnet","action":"update","audited_changes":{"dns_id":[1,null]}},{"user_id":3,"user_type":null,"user_name":"admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.122.209","associated_name":null,"created_at":"2017-07-05 21:06:13 UTC","id":1582,"auditable_id":1,"auditable_name":"taft.prov (192.168.100.0/24)","auditable_type":"Subnet","action":"update","audited_changes":{"ipam":["DHCP","None"],"dhcp_id":[1,null]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":32,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-05 09:45:59 UTC","id":1581,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-05 09:45:59 UTC","id":1580,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-07-04 20:36:14 UTC","id":1579,"auditable_id":1,"auditable_name":"taft.prov (192.168.100.0/24)","auditable_type":"Subnet","action":"update","audited_changes":{"gateway":["","192.168.100.2"],"dns_primary":["","192.168.100.3"],"dns_secondary":["","8.8.8.8"],"from":["192.168.100.100","192.168.100.111"],"to":["192.168.100.253","192.168.100.250"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-07-04 20:16:32 UTC","id":1578,"auditable_id":1,"auditable_name":"taft.prov (192.168.100.0/24)","auditable_type":"Subnet","action":"update","audited_changes":{"gateway":["192.168.100.254",""]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-07-04 19:19:41 UTC","id":1577,"auditable_id":1,"auditable_name":"battalionbox.usersys.redhat.com (Libvirt)","auditable_type":"ComputeResource","action":"update","audited_changes":{"url":["qemu+tcp://10.13.153.94/system","qemu+ssh://root@battalionbox.usersys.redhat.com/system"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.120.33","associated_name":null,"created_at":"2017-07-04 19:08:21 UTC","id":1576,"auditable_id":2,"auditable_name":"brigadebox.usersys.redhat.com (Libvirt)","auditable_type":"ComputeResource","action":"update","audited_changes":{"url":["qemu+tcp://10.13.153.10/system","qemu+ssh://root@brigadebox.usersys.redhat.com/system"],"uuid":[null,"C2C09E88-4838-E211-A7EA-00247E06F60E"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-07-04 18:46:29 UTC","id":1575,"auditable_id":2,"auditable_name":"Brigadebox (Libvirt)","auditable_type":"ComputeResource","action":"update","audited_changes":{"name":["Brigadebox","brigadebox.usersys.redhat.com"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-07-04 18:41:28 UTC","id":1574,"auditable_id":2,"auditable_name":"Brigadebox (Libvirt)","auditable_type":"ComputeResource","action":"update","audited_changes":{"url":["qemu://brigadebox.usersys.redhat.com","qemu+tcp://10.13.153.10/system"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-07-04 18:08:03 UTC","id":1573,"auditable_id":2,"auditable_name":"Brigadebox (Libvirt)","auditable_type":"ComputeResource","action":"create","audited_changes":{"name":"Brigadebox","description":"","url":"qemu://brigadebox.usersys.redhat.com","user":null,"uuid":null,"email":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":31,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-03 20:10:35 UTC","id":1540,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-07-03 19:58:00 UTC","id":1539,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":50,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-23 11:57:44 UTC","id":1538,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":31,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-23 10:53:47 UTC","id":1537,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-23 10:42:03 UTC","id":1536,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-23 10:41:13 UTC","id":1535,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":49,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-06-22 15:02:53 UTC","id":1534,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":48,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-06-22 14:47:50 UTC","id":1533,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":30,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 14:43:54 UTC","id":1532,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":47,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 14:40:32 UTC","id":1531,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:51:41 UTC","id":1530,"auditable_id":70,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$nZJvLTBQ$henIupcLkhFKrJdTm8FmY0","$5$sQ81+Gja$bnttNtkR.G8qCBSkEkmQ0ZlbUiddOalxYmKq8WAeyYA"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:51:39 UTC","id":1529,"auditable_id":51,"auditable_name":"testthis.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$ePgU8eLs$eoo3F60xnnYgs.RbieGUU.","$5$XFXFPgPq$cx9Pv4S2/OKsAkT0KQKKjsmB1wJVQO34yflJr2KP9j."]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:51:38 UTC","id":1528,"auditable_id":45,"auditable_name":"disconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$HBoHDloe$KeJu.3UHedcDrhXvoapxYEZZqWgVH8XF9uI3.7MEfu3"],"grub_pass":["","$1$KeJUKmar$qxkvxB33nqsqvkdIQYKwZ0"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:51:31 UTC","id":1527,"auditable_id":27,"auditable_name":"camworkstation.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$rMJfEtFK$bu7uTE62Ap3hZC3kyFQGG7ogivhE9oLCZtztc2gOas9"],"grub_pass":["","$1$j1PcxJT9$5oMthMuOxoWp5g7YT9NrS0"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:21:14 UTC","id":1526,"auditable_id":321,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:21:14 UTC","id":1525,"auditable_id":322,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:21:14 UTC","id":1524,"auditable_id":320,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:21:13 UTC","id":1523,"auditable_id":323,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":118,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:21:12 UTC","id":1522,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:21:11 UTC","id":1521,"auditable_id":323,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":117,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:21:11 UTC","id":1520,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:21:10 UTC","id":1519,"auditable_id":322,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:21:10 UTC","id":1518,"auditable_id":321,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:21:10 UTC","id":1517,"auditable_id":320,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:13:19 UTC","id":1516,"auditable_id":317,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:13:19 UTC","id":1515,"auditable_id":318,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:13:18 UTC","id":1514,"auditable_id":316,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:13:18 UTC","id":1513,"auditable_id":319,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":116,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:13:16 UTC","id":1512,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:13:10 UTC","id":1511,"auditable_id":319,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":115,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:13:10 UTC","id":1510,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:13:09 UTC","id":1509,"auditable_id":318,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:13:09 UTC","id":1508,"auditable_id":317,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:13:09 UTC","id":1507,"auditable_id":316,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":26,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:09:49 UTC","id":1506,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":25,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-22 13:08:40 UTC","id":1505,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:37:55 UTC","id":1504,"auditable_id":313,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:37:55 UTC","id":1503,"auditable_id":314,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:37:55 UTC","id":1502,"auditable_id":312,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:37:55 UTC","id":1501,"auditable_id":315,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":114,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:37:54 UTC","id":1500,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:37:53 UTC","id":1499,"auditable_id":315,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":113,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:37:53 UTC","id":1498,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:37:52 UTC","id":1497,"auditable_id":314,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:37:52 UTC","id":1496,"auditable_id":313,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:37:52 UTC","id":1495,"auditable_id":312,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:34:41 UTC","id":1494,"auditable_id":309,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:34:41 UTC","id":1493,"auditable_id":310,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:34:41 UTC","id":1492,"auditable_id":308,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:34:41 UTC","id":1491,"auditable_id":311,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":112,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:34:39 UTC","id":1490,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:34:38 UTC","id":1489,"auditable_id":311,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":111,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:34:38 UTC","id":1488,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:34:38 UTC","id":1487,"auditable_id":310,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:34:38 UTC","id":1486,"auditable_id":309,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:34:37 UTC","id":1485,"auditable_id":308,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:31:03 UTC","id":1484,"auditable_id":305,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:31:03 UTC","id":1483,"auditable_id":306,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:31:03 UTC","id":1482,"auditable_id":304,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:31:03 UTC","id":1481,"auditable_id":307,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":110,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:31:01 UTC","id":1480,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:30:53 UTC","id":1479,"auditable_id":307,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":109,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:30:53 UTC","id":1478,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:30:52 UTC","id":1477,"auditable_id":306,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:30:52 UTC","id":1476,"auditable_id":305,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-21 22:30:52 UTC","id":1475,"auditable_id":304,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 21:12:01 UTC","id":1474,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$hr9ba4Nh$Fv/v5vslSo2NUd5vJMMAE0","$5$IN+Qrohx$d363HpnCKgWy/le0hiNNFABHnFR2jKKVmpCTOUFcUM1"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 20:17:35 UTC","id":1473,"auditable_id":75,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 20:17:27 UTC","id":1472,"auditable_id":75,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 20:16:45 UTC","id":1471,"auditable_id":75,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 20:16:43 UTC","id":1470,"auditable_id":75,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.66","associated_name":null,"created_at":"2017-06-20 20:16:36 UTC","id":1469,"auditable_id":75,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$utOnklei$pl5vHKyVrCa1zRFIf1TvX1","$5$sDXW6MFb$s6BZ3vVfXHqePWtN0IUkaNBf7LBc2d6Cf.NaJ7s53Z4"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.66","associated_name":null,"created_at":"2017-06-20 20:16:36 UTC","id":1468,"auditable_id":75,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"hotbox0.usersys.redhat.com","root_pass":"$5$sDXW6MFb$s6BZ3vVfXHqePWtN0IUkaNBf7LBc2d6Cf.NaJ7s53Z4","architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$1$utOnklei$pl5vHKyVrCa1zRFIf1TvX1","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.66","associated_name":null,"created_at":"2017-06-20 20:16:35 UTC","id":1467,"auditable_id":85,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"hotbox0.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.66","associated_name":null,"created_at":"2017-06-20 20:16:12 UTC","id":1466,"auditable_id":72,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"hotbox0.usersys.redhat.com","root_pass":"$5$D1wdNcIp$iaQ1Wy2Jr/5yXC2smr/NS.zkpeGC8usIuHbjb5hUNH/","architecture_id":1,"operatingsystem_id":2,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"$5$D1wdNcIp$iaQ1Wy2Jr/5yXC2smr/NS.zkpeGC8usIuHbjb5hUNH/","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":61,"host_id":72,"uuid":"553d4c79-99fe-417c-9b66-32d2c2d821da","content_view_id":12,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":75,"host_id":72,"uuid":"553d4c79-99fe-417c-9b66-32d2c2d821da","last_checkin":"2017-06-20T20:14:50.462Z","service_level":"Standard","release_version":null,"autoheal":true,"registered_at":"2017-04-07T20:15:29.838Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 20:14:06 UTC","id":1465,"auditable_id":72,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 20:13:55 UTC","id":1464,"auditable_id":72,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":20,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 20:12:19 UTC","id":1463,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":19,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 20:08:56 UTC","id":1462,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 18:47:09 UTC","id":1461,"auditable_id":301,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 18:47:09 UTC","id":1460,"auditable_id":302,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 18:47:09 UTC","id":1459,"auditable_id":300,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 18:47:09 UTC","id":1458,"auditable_id":303,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":108,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 18:47:07 UTC","id":1457,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 18:47:06 UTC","id":1456,"auditable_id":303,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":107,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 18:47:06 UTC","id":1455,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 18:47:05 UTC","id":1454,"auditable_id":302,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 18:47:05 UTC","id":1453,"auditable_id":301,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 18:47:04 UTC","id":1452,"auditable_id":300,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":46,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-20 11:04:03 UTC","id":1451,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":45,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-14 10:28:18 UTC","id":1450,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-06-13 22:56:04 UTC","id":1449,"auditable_id":52,"auditable_name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$HZXxbFmv$rAAIS6RECJ834Oyfw2cKT.","$5$gKZqhJxe$IgkvEkXHNMQD4WrIu8pQMBk.xKrfGRtyctW/ZSrNMZ."]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-06-07 10:22:22 UTC","id":1448,"auditable_id":25,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-06-07 09:55:15 UTC","id":1447,"auditable_id":25,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:47:21 UTC","id":1446,"auditable_id":297,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:47:21 UTC","id":1445,"auditable_id":298,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:47:21 UTC","id":1444,"auditable_id":296,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:47:21 UTC","id":1443,"auditable_id":299,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":106,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:47:20 UTC","id":1442,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:47:19 UTC","id":1441,"auditable_id":299,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":105,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:47:19 UTC","id":1440,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:47:18 UTC","id":1439,"auditable_id":298,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:47:18 UTC","id":1438,"auditable_id":297,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:47:18 UTC","id":1437,"auditable_id":296,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:42:35 UTC","id":1436,"auditable_id":293,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:42:35 UTC","id":1435,"auditable_id":294,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:42:35 UTC","id":1434,"auditable_id":292,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:42:35 UTC","id":1433,"auditable_id":295,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":104,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:42:34 UTC","id":1432,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:42:33 UTC","id":1431,"auditable_id":295,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":103,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:42:33 UTC","id":1430,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:42:32 UTC","id":1429,"auditable_id":294,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:42:32 UTC","id":1428,"auditable_id":293,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:42:32 UTC","id":1427,"auditable_id":292,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":24,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:41:14 UTC","id":1426,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":23,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:40:41 UTC","id":1425,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":44,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:34:53 UTC","id":1424,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:31:55 UTC","id":1423,"auditable_id":289,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:31:54 UTC","id":1422,"auditable_id":290,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:31:54 UTC","id":1421,"auditable_id":288,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:31:54 UTC","id":1420,"auditable_id":291,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":102,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:31:53 UTC","id":1419,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:31:51 UTC","id":1418,"auditable_id":291,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":101,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:31:51 UTC","id":1417,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:31:51 UTC","id":1416,"auditable_id":290,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:31:51 UTC","id":1415,"auditable_id":289,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-31 22:31:50 UTC","id":1414,"auditable_id":288,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":43,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-30 11:17:47 UTC","id":1413,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-30 11:06:49 UTC","id":1412,"auditable_id":48,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$/WOa7xGG$1oMv8J0oXwoNEFcRZ4/IN0","$5$/6aWDFf7$1QDSXl/3hdjMpqUjkofqevayefdSs02i7U3DCn5cED3"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-30 11:00:46 UTC","id":1411,"auditable_id":22,"auditable_name":"drone71.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$riQ8LCVD$UV26htA/og0MoxSVNvMEe1","$5$gaa6keJz$W8glhANb/L1D6w2gEd9rlW9olVtqEGk6.UEqolsWVh8"]}},{"user_id":null,"user_type":null,"user_name":null,"version":18,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.114","associated_name":null,"created_at":"2017-05-29 17:11:38 UTC","id":1410,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$Gcc9T4y2$aNAUVvrTapdDfhVNdaN.L1","$5$jVOVY90J$0ov5YCJxFgtgo66qgfklVbvDcyJc7vZ5VrlSeMujfR."]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":17,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-29 17:11:35 UTC","id":1409,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$Gcc9T4y2$aNAUVvrTapdDfhVNdaN.L1","$5$jVOVY90J$0ov5YCJxFgtgo66qgfklVbvDcyJc7vZ5VrlSeMujfR."]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-29 17:11:34 UTC","id":1408,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$Gcc9T4y2$aNAUVvrTapdDfhVNdaN.L1","$5$jVOVY90J$0ov5YCJxFgtgo66qgfklVbvDcyJc7vZ5VrlSeMujfR."]}},{"user_id":null,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-29 14:09:43 UTC","id":1407,"auditable_id":52,"auditable_name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$gKZqhJxe$IgkvEkXHNMQD4WrIu8pQMBk.xKrfGRtyctW/ZSrNMZ."],"grub_pass":["","$1$HZXxbFmv$rAAIS6RECJ834Oyfw2cKT."]}},{"user_id":null,"user_type":null,"user_name":null,"version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.42","associated_name":null,"created_at":"2017-05-29 13:41:58 UTC","id":1406,"auditable_id":18,"auditable_name":"drone64.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[5,12]}},{"user_id":null,"user_type":null,"user_name":null,"version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-29 13:41:57 UTC","id":1405,"auditable_id":18,"auditable_name":"drone64.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[5,12]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-29 13:34:02 UTC","id":1404,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0],"grub_pass":["$1$iFDma27O$9IFya680sfvBkSeTWgHP//","$5$kWOdXm3v$BL9uMwlJ1GXt530EHSIiGlnx9gBd3u4PgExsEGb9a67"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-29 13:33:27 UTC","id":1403,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0],"grub_pass":["$1$cpKTcPtj$h/T2KjhNqnauyxIzYmlE0/","$5$pgQoByq+$Sad55jVueuUTzJxj8fByjF2uWLYlV/MmIiGREu/pqk7"]}},{"user_id":null,"user_type":null,"user_name":null,"version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.42","associated_name":null,"created_at":"2017-05-29 13:27:13 UTC","id":1402,"auditable_id":18,"auditable_name":"drone64.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$WxzkGLZQ$3McuFBE/VLke2y4y0rbD91","$5$BJemeOvZ$ciBbiaQ4fgbFHKD.S/G9ep398Bn3TfXIHkrOyLuvaV4"]}},{"user_id":null,"user_type":null,"user_name":null,"version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-29 13:25:50 UTC","id":1401,"auditable_id":18,"auditable_name":"drone64.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$WxzkGLZQ$3McuFBE/VLke2y4y0rbD91","$5$BJemeOvZ$ciBbiaQ4fgbFHKD.S/G9ep398Bn3TfXIHkrOyLuvaV4"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-29 13:24:40 UTC","id":1400,"auditable_id":18,"auditable_name":"drone64.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$WxzkGLZQ$3McuFBE/VLke2y4y0rbD91","$5$BJemeOvZ$ciBbiaQ4fgbFHKD.S/G9ep398Bn3TfXIHkrOyLuvaV4"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-05-29 13:23:21 UTC","id":1399,"auditable_id":25,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$rGVMBcBX$u.KWaQxiZg1IRYKhrRuOA.","$5$uvRjYwYr$n7v0sxGfQX9U.x8js0JAzDRlVawaCAjPvliMzlmNxS6"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-05-29 13:23:12 UTC","id":1398,"auditable_id":25,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$uvRjYwYr$n7v0sxGfQX9U.x8js0JAzDRlVawaCAjPvliMzlmNxS6"],"grub_pass":["","$1$rGVMBcBX$u.KWaQxiZg1IRYKhrRuOA."]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":29,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-26 10:27:07 UTC","id":1397,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-26 10:27:05 UTC","id":1396,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":30,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-23 10:29:17 UTC","id":1395,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-22 13:57:28 UTC","id":1394,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":29,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-22 13:55:13 UTC","id":1393,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":28,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-18 09:34:34 UTC","id":1392,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":28,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-13 10:39:25 UTC","id":1391,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$0iX93UNr$4MptVKrvv8utbYAO2VFAE1","$5$dh5peEaB$47aUoUEv7hVa6N1.t524Zndtuj7/r7leiEVtUh6cQC7"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 16:45:39 UTC","id":1390,"auditable_id":51,"auditable_name":"testthis.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$XFXFPgPq$cx9Pv4S2/OKsAkT0KQKKjsmB1wJVQO34yflJr2KP9j."],"grub_pass":["","$1$ePgU8eLs$eoo3F60xnnYgs.RbieGUU."]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 16:45:38 UTC","id":1389,"auditable_id":26,"auditable_name":"puppet.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$KmX1y0eV$ScD8s6FhGoUsNz8VSorJP1","$5$6TkAZ3IZ$m6j6D9d/aWw1/G.OsPGY8AB6d9rtH9HZDI2C0Up7g.7"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 16:45:38 UTC","id":1388,"auditable_id":70,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$sQ81+Gja$bnttNtkR.G8qCBSkEkmQ0ZlbUiddOalxYmKq8WAeyYA"],"grub_pass":["","$1$nZJvLTBQ$henIupcLkhFKrJdTm8FmY0"]}},{"user_id":null,"user_type":null,"user_name":null,"version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.10","associated_name":null,"created_at":"2017-05-10 16:38:36 UTC","id":1387,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$Pqa0tiNA$kq.n0S67ClwwqD8nD7mri1","$5$8k+oHR2N$qiAWQqJMgaR6HCoNGLCs.ZI8YZJP21m2cJ3OcH9XG4A"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 16:38:02 UTC","id":1386,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$Pqa0tiNA$kq.n0S67ClwwqD8nD7mri1","$5$8k+oHR2N$qiAWQqJMgaR6HCoNGLCs.ZI8YZJP21m2cJ3OcH9XG4A"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 16:36:55 UTC","id":1385,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$Pqa0tiNA$kq.n0S67ClwwqD8nD7mri1","$5$8k+oHR2N$qiAWQqJMgaR6HCoNGLCs.ZI8YZJP21m2cJ3OcH9XG4A"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 15:43:04 UTC","id":1384,"auditable_id":48,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$/6aWDFf7$1QDSXl/3hdjMpqUjkofqevayefdSs02i7U3DCn5cED3"],"grub_pass":["","$1$/WOa7xGG$1oMv8J0oXwoNEFcRZ4/IN0"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":23,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 15:40:28 UTC","id":1383,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$4PtDh46S$sBzyQ91mE8goE.6.97YgX0","$5$Pysd9Z3m$.GOW/1DoDHTTymRQ/WEoeIYBW3P.TdpTIiIClUDt3B/"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 15:40:01 UTC","id":1382,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$KWj1Xs3K$oZdYjbvRnJ.o.245ZV3/l0","$5$ok9dDNUJ$3GP9lEcqji.eMF0WjxIfD0cMa2DdMsB.GFCvxJVWpm3"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 15:39:53 UTC","id":1381,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$kWOdXm3v$BL9uMwlJ1GXt530EHSIiGlnx9gBd3u4PgExsEGb9a67"],"grub_pass":["","$1$iFDma27O$9IFya680sfvBkSeTWgHP//"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 15:39:43 UTC","id":1380,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$pgQoByq+$Sad55jVueuUTzJxj8fByjF2uWLYlV/MmIiGREu/pqk7"],"grub_pass":["","$1$cpKTcPtj$h/T2KjhNqnauyxIzYmlE0/"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 15:39:18 UTC","id":1379,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$ZsETTLLT$0rlnDgGIPQpP/tHvKD/wB0","$5$tYiLwJD2$4l1sRfI34.dYWzcDCQobSDvtY6L0vhmTursPXsa/9I9"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 15:39:16 UTC","id":1378,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$jVOVY90J$0ov5YCJxFgtgo66qgfklVbvDcyJc7vZ5VrlSeMujfR."],"grub_pass":["","$1$Gcc9T4y2$aNAUVvrTapdDfhVNdaN.L1"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 15:38:52 UTC","id":1377,"auditable_id":22,"auditable_name":"drone71.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$gaa6keJz$W8glhANb/L1D6w2gEd9rlW9olVtqEGk6.UEqolsWVh8"],"grub_pass":["","$1$riQ8LCVD$UV26htA/og0MoxSVNvMEe1"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 15:38:27 UTC","id":1376,"auditable_id":18,"auditable_name":"drone64.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$BJemeOvZ$ciBbiaQ4fgbFHKD.S/G9ep398Bn3TfXIHkrOyLuvaV4"],"grub_pass":["","$1$WxzkGLZQ$3McuFBE/VLke2y4y0rbD91"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 15:38:21 UTC","id":1375,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$IN+Qrohx$d363HpnCKgWy/le0hiNNFABHnFR2jKKVmpCTOUFcUM1"],"grub_pass":["","$1$hr9ba4Nh$Fv/v5vslSo2NUd5vJMMAE0"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 15:19:21 UTC","id":1374,"auditable_id":63,"auditable_name":"virt-who-c2c09e88-4838-e211-a7ea-00247e06f60e-1","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$aeHBBLuU$Gue4/XQshG7tXuUxT1PLi.","$5$u65F6jen$Eucvkdht/GZ6rcI/PiMmDKGo6wEIxt1eXCFaBrUOT69"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 13:50:37 UTC","id":1373,"auditable_id":72,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1],"grub_pass":["$1$O6TUahad$YDj2S.tGn2lcG4a1E5c/m.","$5$D1wdNcIp$iaQ1Wy2Jr/5yXC2smr/NS.zkpeGC8usIuHbjb5hUNH/"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 13:48:47 UTC","id":1372,"auditable_id":72,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2],"root_pass":[null,"$5$D1wdNcIp$iaQ1Wy2Jr/5yXC2smr/NS.zkpeGC8usIuHbjb5hUNH/"],"grub_pass":["","$1$O6TUahad$YDj2S.tGn2lcG4a1E5c/m."]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":22,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 10:33:34 UTC","id":1371,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$Pysd9Z3m$.GOW/1DoDHTTymRQ/WEoeIYBW3P.TdpTIiIClUDt3B/"],"grub_pass":["","$1$4PtDh46S$sBzyQ91mE8goE.6.97YgX0"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":32,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 10:32:46 UTC","id":1370,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$snSRAtig$BhMSARadI.qkLP8sRMqBk.","$5$WTat7m/q$zIMQJJ1E4M25c.CfsUJjIA/PfwV43tfR6n4nQJ/c4e."]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":27,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 10:28:28 UTC","id":1369,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$dh5peEaB$47aUoUEv7hVa6N1.t524Zndtuj7/r7leiEVtUh6cQC7"],"grub_pass":["","$1$0iX93UNr$4MptVKrvv8utbYAO2VFAE1"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 10:28:24 UTC","id":1368,"auditable_id":26,"auditable_name":"puppet.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$6TkAZ3IZ$m6j6D9d/aWw1/G.OsPGY8AB6d9rtH9HZDI2C0Up7g.7"],"grub_pass":["","$1$KmX1y0eV$ScD8s6FhGoUsNz8VSorJP1"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 10:27:54 UTC","id":1367,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$tYiLwJD2$4l1sRfI34.dYWzcDCQobSDvtY6L0vhmTursPXsa/9I9"],"grub_pass":["","$1$ZsETTLLT$0rlnDgGIPQpP/tHvKD/wB0"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 10:27:50 UTC","id":1366,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$8k+oHR2N$qiAWQqJMgaR6HCoNGLCs.ZI8YZJP21m2cJ3OcH9XG4A"],"grub_pass":["","$1$Pqa0tiNA$kq.n0S67ClwwqD8nD7mri1"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":31,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 10:23:15 UTC","id":1365,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$WTat7m/q$zIMQJJ1E4M25c.CfsUJjIA/PfwV43tfR6n4nQJ/c4e."],"grub_pass":["","$1$snSRAtig$BhMSARadI.qkLP8sRMqBk."]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 10:19:12 UTC","id":1364,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$ok9dDNUJ$3GP9lEcqji.eMF0WjxIfD0cMa2DdMsB.GFCvxJVWpm3"],"grub_pass":["","$1$KWj1Xs3K$oZdYjbvRnJ.o.245ZV3/l0"]}},{"user_id":null,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-10 00:08:22 UTC","id":1363,"auditable_id":63,"auditable_name":"virt-who-c2c09e88-4838-e211-a7ea-00247e06f60e-1","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$u65F6jen$Eucvkdht/GZ6rcI/PiMmDKGo6wEIxt1eXCFaBrUOT69"],"grub_pass":["","$1$aeHBBLuU$Gue4/XQshG7tXuUxT1PLi."]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":50,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-05-09 21:50:49 UTC","id":1362,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$Ps/oh7d6$l.NVjKPZ0F62yk.1W67yR0","$5$cT3J0MqW$2cvKBhKNU.rzsniZ75WzekvUT.ybSibeg5IppF5nWa3"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":49,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-05-09 21:50:49 UTC","id":1361,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$cT3J0MqW$2cvKBhKNU.rzsniZ75WzekvUT.ybSibeg5IppF5nWa3"],"grub_pass":["","$1$Ps/oh7d6$l.NVjKPZ0F62yk.1W67yR0"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":42,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-05-09 21:47:14 UTC","id":1360,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$9XzAc1iN$WXGh/lI/kDOjaFbxlwqSW1","$5$gwVQOI57$5E7GLI74mr8J54o.XRfUI6IlTjElhveQfZ6tQL0UC.5"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":41,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-05-09 21:47:14 UTC","id":1359,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$gwVQOI57$5E7GLI74mr8J54o.XRfUI6IlTjElhveQfZ6tQL0UC.5"],"grub_pass":["","$1$9XzAc1iN$WXGh/lI/kDOjaFbxlwqSW1"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":27,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-05-09 21:46:26 UTC","id":1358,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"grub_pass":["$1$AYOE06kq$A1lm0vJ3BC4SeO3zvatWS.","$5$PrRjsm/O$OF0jGXSFbKKJqVr1bz59WYH3IomeHax7qLAC10v1a/1"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":26,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-05-09 21:46:26 UTC","id":1357,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"root_pass":[null,"$5$PrRjsm/O$OF0jGXSFbKKJqVr1bz59WYH3IomeHax7qLAC10v1a/1"],"grub_pass":["","$1$AYOE06kq$A1lm0vJ3BC4SeO3zvatWS."]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-05-09 21:33:50 UTC","id":1356,"auditable_id":68,"auditable_name":"root_pass","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- redhat\n...\n"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":40,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-05 21:09:58 UTC","id":1355,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":39,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-05 21:09:16 UTC","id":1354,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":25,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:37:51 UTC","id":1353,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":38,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-05-01 15:32:11 UTC","id":1352,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[3,12]}},{"user_id":null,"user_type":null,"user_name":null,"version":37,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:32:06 UTC","id":1351,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[3,12]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:18:06 UTC","id":1350,"auditable_id":285,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:18:06 UTC","id":1349,"auditable_id":286,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:18:06 UTC","id":1348,"auditable_id":284,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:18:06 UTC","id":1347,"auditable_id":287,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":100,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:18:05 UTC","id":1346,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:18:04 UTC","id":1345,"auditable_id":287,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":99,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:18:04 UTC","id":1344,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:18:03 UTC","id":1343,"auditable_id":286,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:18:03 UTC","id":1342,"auditable_id":285,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:18:03 UTC","id":1341,"auditable_id":284,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:13:12 UTC","id":1340,"auditable_id":281,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:13:12 UTC","id":1339,"auditable_id":282,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:13:12 UTC","id":1338,"auditable_id":280,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:13:12 UTC","id":1337,"auditable_id":283,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":98,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:13:11 UTC","id":1336,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":null,"user_type":null,"user_name":null,"version":22,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:11:37 UTC","id":1335,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":21,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 15:10:59 UTC","id":1334,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 14:41:47 UTC","id":1333,"auditable_id":283,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":97,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 14:41:47 UTC","id":1332,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 14:41:46 UTC","id":1331,"auditable_id":282,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 14:41:46 UTC","id":1330,"auditable_id":281,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-05-01 14:41:46 UTC","id":1329,"auditable_id":280,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.158","associated_name":null,"created_at":"2017-04-27 15:12:36 UTC","id":1328,"auditable_id":53,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"regclass1.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":43,"host_id":53,"uuid":"309be36a-7c7e-451b-b678-678fc548166b","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":56,"host_id":53,"uuid":"309be36a-7c7e-451b-b678-678fc548166b","last_checkin":"2017-03-25T21:45:54.104Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-03-17T16:38:04.626Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-27 15:11:09 UTC","id":1327,"auditable_id":53,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":48,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-04-25 10:23:48 UTC","id":1326,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":47,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-04-25 09:57:37 UTC","id":1325,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":36,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-04-23 10:12:21 UTC","id":1324,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":35,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-04-23 09:44:13 UTC","id":1323,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-04-21 18:12:50 UTC","id":1322,"auditable_id":10,"auditable_name":"Employee Org","auditable_type":"Organization","action":"create","audited_changes":{"name":"Employee Org","ignore_types":[],"description":"","label":"Employee_Org","ancestry":null,"katello_default":false}},{"user_id":null,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-21 18:10:31 UTC","id":1321,"auditable_id":5,"auditable_name":"Big Red","auditable_type":"Organization","action":"destroy","audited_changes":{"name":"Big Red","ignore_types":[],"description":"","label":"Big_Red","ancestry":null,"katello_default":false}},{"user_id":null,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-21 18:10:27 UTC","id":1320,"auditable_id":6,"auditable_name":"Juicy Fruit","auditable_type":"Organization","action":"destroy","audited_changes":{"name":"Juicy Fruit","ignore_types":[],"description":"","label":"Juicy_Fruit","ancestry":null,"katello_default":false}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":46,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-04-21 10:24:52 UTC","id":1319,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":45,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-04-21 09:58:58 UTC","id":1318,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.222","associated_name":null,"created_at":"2017-04-19 04:05:16 UTC","id":1317,"auditable_id":74,"auditable_name":"sam69.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"sam69.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":12,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":63,"host_id":74,"uuid":"d6d23b0e-e755-4c43-b830-d29cb1271a2a","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":77,"host_id":74,"uuid":"d6d23b0e-e755-4c43-b830-d29cb1271a2a","last_checkin":"2017-04-19T03:55:43.855Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-04-19T03:54:56.417Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-19 03:55:26 UTC","id":1316,"auditable_id":74,"auditable_name":"sam69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-19 03:55:08 UTC","id":1315,"auditable_id":74,"auditable_name":"sam69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-19 03:55:06 UTC","id":1314,"auditable_id":74,"auditable_name":"sam69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,12]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.222","associated_name":null,"created_at":"2017-04-19 03:54:56 UTC","id":1313,"auditable_id":74,"auditable_name":"sam69.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"sam69.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.222","associated_name":null,"created_at":"2017-04-19 03:50:37 UTC","id":1311,"auditable_id":73,"auditable_name":"sam69.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"sam69.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":12,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":62,"host_id":73,"uuid":"80c8ad82-e2a6-46f9-9ca7-bb2a27b80257","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":76,"host_id":73,"uuid":"80c8ad82-e2a6-46f9-9ca7-bb2a27b80257","last_checkin":"2017-04-19T03:44:05.504Z","service_level":null,"release_version":"6Server","autoheal":true,"registered_at":"2017-04-19T03:36:12.045Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-19 03:38:13 UTC","id":1310,"auditable_id":73,"auditable_name":"sam69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-19 03:36:24 UTC","id":1309,"auditable_id":73,"auditable_name":"sam69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-19 03:36:22 UTC","id":1308,"auditable_id":73,"auditable_name":"sam69.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,12]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-19 03:36:21 UTC","id":1307,"auditable_id":12,"auditable_name":"RedHat 6.9","auditable_type":"Operatingsystem","action":"create","audited_changes":{"major":"6","name":"RedHat","minor":"9","nameindicator":null,"release_name":null,"description":null,"password_hash":"SHA256","title":"RedHat 6.9"}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.222","associated_name":null,"created_at":"2017-04-19 03:36:11 UTC","id":1306,"auditable_id":73,"auditable_name":"sam69.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"sam69.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-17 19:47:03 UTC","id":1304,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-17 19:45:33 UTC","id":1303,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-13 10:31:29 UTC","id":1302,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":26,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-13 10:31:22 UTC","id":1301,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-13 10:31:15 UTC","id":1300,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":24,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-13 10:31:09 UTC","id":1299,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 20:36:12 UTC","id":1298,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 20:15:46 UTC","id":1297,"auditable_id":72,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 20:15:39 UTC","id":1296,"auditable_id":72,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.66","associated_name":null,"created_at":"2017-04-07 20:15:29 UTC","id":1295,"auditable_id":72,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"hotbox0.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.66","associated_name":null,"created_at":"2017-04-07 20:15:18 UTC","id":1293,"auditable_id":71,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"hotbox0.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":2,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":60,"host_id":71,"uuid":"60226695-4f1e-4d67-8cff-547c0846cbed","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":74,"host_id":71,"uuid":"60226695-4f1e-4d67-8cff-547c0846cbed","last_checkin":"2017-04-07T20:14:28.624Z","service_level":"Standard","release_version":null,"autoheal":true,"registered_at":"2017-04-07T20:14:13.030Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 20:14:30 UTC","id":1292,"auditable_id":71,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 20:14:23 UTC","id":1291,"auditable_id":71,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.66","associated_name":null,"created_at":"2017-04-07 20:14:12 UTC","id":1290,"auditable_id":71,"auditable_name":"hotbox0.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"hotbox0.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:53:00 UTC","id":1288,"auditable_id":70,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:52:59 UTC","id":1287,"auditable_id":70,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:52:50 UTC","id":1286,"auditable_id":70,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:52:50 UTC","id":1285,"auditable_id":80,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"iptable.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:52:34 UTC","id":1284,"auditable_id":69,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":58,"host_id":69,"uuid":"a7104216-eb5c-4263-bb47-5b2976345bab","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":72,"host_id":69,"uuid":"a7104216-eb5c-4263-bb47-5b2976345bab","last_checkin":"2017-04-07T13:51:38.046Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-04-07T13:51:23.343Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:51:34 UTC","id":1283,"auditable_id":69,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:51:32 UTC","id":1282,"auditable_id":69,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:51:22 UTC","id":1281,"auditable_id":69,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:51:16 UTC","id":1279,"auditable_id":68,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":57,"host_id":68,"uuid":"6aef9e70-7b62-4eb7-8957-d4207dce64d8","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":71,"host_id":68,"uuid":"6aef9e70-7b62-4eb7-8957-d4207dce64d8","last_checkin":"2017-04-07T13:50:59.998Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-04-07T13:50:46.126Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:51:04 UTC","id":1278,"auditable_id":68,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:50:55 UTC","id":1277,"auditable_id":68,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:50:45 UTC","id":1276,"auditable_id":68,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:50:37 UTC","id":1274,"auditable_id":67,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":56,"host_id":67,"uuid":"cb06e672-bbf1-44a1-8e91-f1901b29852a","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":70,"host_id":67,"uuid":"cb06e672-bbf1-44a1-8e91-f1901b29852a","last_checkin":"2017-04-07T13:47:14.690Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-04-07T13:47:01.408Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:48:13 UTC","id":1273,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:47:11 UTC","id":1272,"auditable_id":67,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:47:09 UTC","id":1271,"auditable_id":67,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:47:01 UTC","id":1270,"auditable_id":67,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:46:52 UTC","id":1268,"auditable_id":66,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":55,"host_id":66,"uuid":"048e3c90-2b92-40a8-8a4c-b1d55358cd37","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":69,"host_id":66,"uuid":"048e3c90-2b92-40a8-8a4c-b1d55358cd37","last_checkin":"2017-04-07T13:46:42.615Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-04-07T13:46:29.887Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:46:38 UTC","id":1267,"auditable_id":66,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:46:38 UTC","id":1266,"auditable_id":66,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:46:29 UTC","id":1265,"auditable_id":66,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:46:11 UTC","id":1263,"auditable_id":65,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":54,"host_id":65,"uuid":"59f478f5-e8ea-499a-a2cb-dbfeedd4d544","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":68,"host_id":65,"uuid":"59f478f5-e8ea-499a-a2cb-dbfeedd4d544","last_checkin":"2017-04-07T13:46:02.722Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-04-07T13:45:49.906Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:45:58 UTC","id":1262,"auditable_id":65,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:45:58 UTC","id":1261,"auditable_id":65,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:45:49 UTC","id":1260,"auditable_id":65,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:45:37 UTC","id":1258,"auditable_id":64,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":53,"host_id":64,"uuid":"b6ca7cce-50dd-44e0-8a04-a175d738c76a","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":67,"host_id":64,"uuid":"b6ca7cce-50dd-44e0-8a04-a175d738c76a","last_checkin":"2017-04-07T13:45:30.908Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-04-07T13:45:17.334Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:45:27 UTC","id":1257,"auditable_id":64,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:45:27 UTC","id":1256,"auditable_id":64,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:45:16 UTC","id":1255,"auditable_id":64,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:44:16 UTC","id":1253,"auditable_id":62,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":52,"host_id":62,"uuid":"464ff166-fdc5-448e-bc6c-b61a0ada2d41","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":65,"host_id":62,"uuid":"464ff166-fdc5-448e-bc6c-b61a0ada2d41","last_checkin":"2017-04-07T13:35:25.597Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-04-07T13:35:11.657Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:42:57 UTC","id":1252,"auditable_id":73,"auditable_name":"virt-who-c2c09e88-4838-e211-a7ea-00247e06f60e-1","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":"2ae2981a-6898-498c-be7c-e1a79ac664c3","name":"virt-who-c2c09e88-4838-e211-a7ea-00247e06f60e-1","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:42:56 UTC","id":1251,"auditable_id":63,"auditable_name":"virt-who-c2c09e88-4838-e211-a7ea-00247e06f60e-1","auditable_type":"Host","action":"create","audited_changes":{"name":"virt-who-c2c09e88-4838-e211-a7ea-00247e06f60e-1","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:35:22 UTC","id":1250,"auditable_id":62,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:35:21 UTC","id":1249,"auditable_id":62,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:35:11 UTC","id":1248,"auditable_id":62,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:35:04 UTC","id":1246,"auditable_id":61,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":51,"host_id":61,"uuid":"5d95a2fe-2bf8-41e7-8a83-9d847c560a19","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":64,"host_id":61,"uuid":"5d95a2fe-2bf8-41e7-8a83-9d847c560a19","last_checkin":"2017-04-07T13:34:45.800Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-04-07T13:34:29.826Z"}}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:34:40 UTC","id":1245,"auditable_id":61,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:34:39 UTC","id":1244,"auditable_id":61,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:34:29 UTC","id":1243,"auditable_id":61,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:33:28 UTC","id":1241,"auditable_id":60,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":50,"host_id":60,"uuid":"58728085-6374-4737-863d-9b171dd4a3a4","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":63,"host_id":60,"uuid":"58728085-6374-4737-863d-9b171dd4a3a4","last_checkin":"2017-04-07T13:33:00.949Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-04-07T13:32:46.061Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:32:57 UTC","id":1240,"auditable_id":60,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:32:55 UTC","id":1239,"auditable_id":60,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:32:45 UTC","id":1238,"auditable_id":60,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:32:37 UTC","id":1236,"auditable_id":59,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":49,"host_id":59,"uuid":"7b47b909-aa84-4911-ab63-d0438228f739","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":62,"host_id":59,"uuid":"7b47b909-aa84-4911-ab63-d0438228f739","last_checkin":"2017-04-07T13:32:10.745Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-04-07T13:31:54.327Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:32:07 UTC","id":1235,"auditable_id":59,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:32:05 UTC","id":1234,"auditable_id":59,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:31:54 UTC","id":1233,"auditable_id":59,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:30:32 UTC","id":1231,"auditable_id":58,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":48,"host_id":58,"uuid":"89c0f110-d001-4b3c-9442-f8e9450c978b","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":61,"host_id":58,"uuid":"89c0f110-d001-4b3c-9442-f8e9450c978b","last_checkin":"2017-04-07T13:29:56.151Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-04-07T13:29:36.681Z"}}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:29:52 UTC","id":1230,"auditable_id":58,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:29:50 UTC","id":1229,"auditable_id":58,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:29:36 UTC","id":1228,"auditable_id":58,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:29:14 UTC","id":1226,"auditable_id":57,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":47,"host_id":57,"uuid":"1ab0e8c3-12f6-4610-a68f-0ecef34300ee","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":60,"host_id":57,"uuid":"1ab0e8c3-12f6-4610-a68f-0ecef34300ee","last_checkin":"2017-04-07T13:29:02.867Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-04-07T13:27:59.706Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:28:14 UTC","id":1225,"auditable_id":57,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-07 13:28:12 UTC","id":1224,"auditable_id":57,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-04-07 13:27:58 UTC","id":1223,"auditable_id":57,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-06 09:48:58 UTC","id":1221,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.42","associated_name":null,"created_at":"2017-04-05 20:58:22 UTC","id":1220,"auditable_id":66,"auditable_name":"drone64.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"drone64.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-05 20:04:21 UTC","id":1219,"auditable_id":48,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-05 20:03:38 UTC","id":1218,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-05 20:03:33 UTC","id":1217,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-05 20:03:29 UTC","id":1216,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-04-05 20:03:08 UTC","id":1215,"auditable_id":48,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":23,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-04-05 09:58:56 UTC","id":1214,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":34,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-04-05 09:58:28 UTC","id":1213,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":22,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-04-05 09:35:04 UTC","id":1211,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":33,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-04-05 09:35:04 UTC","id":1212,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-03-29 14:37:34 UTC","id":1210,"auditable_id":56,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":46,"host_id":56,"uuid":"c10809cc-a33d-4ebe-bd09-9f1ed9c02027","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":58,"host_id":56,"uuid":"c10809cc-a33d-4ebe-bd09-9f1ed9c02027","last_checkin":"2017-03-27T21:34:57.368Z","service_level":null,"release_version":"6.8","autoheal":true,"registered_at":"2017-03-27T21:33:22.606Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-29 07:00:01 UTC","id":1209,"auditable_id":56,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-28 19:40:07 UTC","id":1208,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-27 21:33:57 UTC","id":1207,"auditable_id":56,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-27 21:33:36 UTC","id":1206,"auditable_id":56,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-27 21:33:34 UTC","id":1205,"auditable_id":56,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.155","associated_name":null,"created_at":"2017-03-27 21:33:22 UTC","id":1204,"auditable_id":56,"auditable_name":"iptable.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"iptable.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-27 17:21:20 UTC","id":1202,"auditable_id":277,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-27 17:21:20 UTC","id":1201,"auditable_id":278,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-27 17:21:20 UTC","id":1200,"auditable_id":276,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-27 17:21:20 UTC","id":1199,"auditable_id":279,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":96,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-27 17:21:19 UTC","id":1198,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-27 17:21:16 UTC","id":1197,"auditable_id":279,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":95,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-27 17:21:16 UTC","id":1196,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-27 17:21:16 UTC","id":1195,"auditable_id":278,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-27 17:21:16 UTC","id":1194,"auditable_id":277,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-27 17:21:15 UTC","id":1193,"auditable_id":276,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":25,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-26 16:57:46 UTC","id":1192,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-26 16:56:32 UTC","id":1191,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-25 11:32:46 UTC","id":1190,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":24,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-25 11:31:21 UTC","id":1189,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":23,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-23 12:16:09 UTC","id":1188,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":22,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-23 11:20:35 UTC","id":1187,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":44,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-03-23 11:14:35 UTC","id":1186,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":43,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-03-23 10:49:17 UTC","id":1185,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-22 22:01:39 UTC","id":1184,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":32,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-03-22 09:58:14 UTC","id":1183,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":31,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-03-22 09:30:22 UTC","id":1182,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-21 12:52:39 UTC","id":1181,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-21 12:51:37 UTC","id":1180,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-21 12:51:34 UTC","id":1179,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,5],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.10","associated_name":null,"created_at":"2017-03-21 12:51:24 UTC","id":1178,"auditable_id":55,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"brigadebox.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.10","associated_name":null,"created_at":"2017-03-21 12:51:23 UTC","id":1177,"auditable_id":64,"auditable_name":"brigadebox.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"brigadebox.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-21 12:50:37 UTC","id":1176,"auditable_id":54,"auditable_name":"brigade.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"brigade.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":5,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":44,"host_id":54,"uuid":"d008f5bf-3002-420e-be61-852d7e6e30ae","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":55,"host_id":54,"uuid":"d008f5bf-3002-420e-be61-852d7e6e30ae","last_checkin":"2017-03-21T10:15:50.382Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-03-16T23:41:33.037Z"}}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":30,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-03-21 09:58:24 UTC","id":1175,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":29,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-03-21 09:29:56 UTC","id":1174,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":42,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-03-20 22:16:14 UTC","id":1173,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":41,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-03-20 21:52:14 UTC","id":1172,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-17 17:55:50 UTC","id":1171,"auditable_id":53,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-17 16:38:17 UTC","id":1170,"auditable_id":53,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.12.209.149","associated_name":null,"created_at":"2017-03-17 04:52:47 UTC","id":1168,"auditable_id":49,"auditable_name":"canis.hq.gsslab.rdu.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"canis.hq.gsslab.rdu.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":4,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":41,"host_id":49,"uuid":"e6c36d2b-eea9-4e8e-bc46-78e97e23666e","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":50,"host_id":49,"uuid":"e6c36d2b-eea9-4e8e-bc46-78e97e23666e","last_checkin":"2017-03-17T04:47:10.413Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-03-13T20:28:18.250Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-16 23:45:37 UTC","id":1167,"auditable_id":54,"auditable_name":"brigade.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-16 23:42:36 UTC","id":1166,"auditable_id":54,"auditable_name":"brigade.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-16 23:42:27 UTC","id":1165,"auditable_id":54,"auditable_name":"brigade.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,5],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.10","associated_name":null,"created_at":"2017-03-16 23:41:16 UTC","id":1164,"auditable_id":54,"auditable_name":"brigade.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"brigade.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-03-16 13:56:02 UTC","id":1162,"auditable_id":215,"auditable_name":"booger","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"booger","template":"boogerpickker","snippet":false,"template_kind_id":1,"locked":false,"default":false,"vendor":null,"os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-15 21:25:29 UTC","id":1161,"auditable_id":53,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-15 21:25:03 UTC","id":1160,"auditable_id":53,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-15 21:25:00 UTC","id":1159,"auditable_id":53,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.158","associated_name":null,"created_at":"2017-03-15 21:24:49 UTC","id":1158,"auditable_id":53,"auditable_name":"regclass1.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"regclass1.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":40,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-03-15 10:43:52 UTC","id":1156,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":39,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-03-15 10:22:18 UTC","id":1155,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.139","associated_name":null,"created_at":"2017-03-14 21:58:56 UTC","id":1154,"auditable_id":47,"auditable_name":"platoonbox.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"platoonbox.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":2,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":39,"host_id":47,"uuid":"66dac883-88fb-483d-975b-6355594b367f","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":43,"host_id":47,"uuid":"66dac883-88fb-483d-975b-6355594b367f","last_checkin":"2017-03-14T20:24:12.149Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-01-19T20:56:04.254Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 21:53:37 UTC","id":1153,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 21:52:17 UTC","id":1152,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 21:52:09 UTC","id":1151,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:49:46 UTC","id":1150,"auditable_id":273,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:49:46 UTC","id":1149,"auditable_id":274,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:49:46 UTC","id":1148,"auditable_id":272,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:49:46 UTC","id":1147,"auditable_id":275,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":94,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:49:45 UTC","id":1146,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:49:44 UTC","id":1145,"auditable_id":275,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":93,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:49:44 UTC","id":1144,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:49:44 UTC","id":1143,"auditable_id":274,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:49:44 UTC","id":1142,"auditable_id":273,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:49:44 UTC","id":1141,"auditable_id":272,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:44:03 UTC","id":1140,"auditable_id":269,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:44:03 UTC","id":1139,"auditable_id":270,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:44:03 UTC","id":1138,"auditable_id":268,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:44:03 UTC","id":1137,"auditable_id":271,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":92,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:44:02 UTC","id":1136,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:43:59 UTC","id":1135,"auditable_id":271,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":91,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:43:59 UTC","id":1134,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:43:58 UTC","id":1133,"auditable_id":270,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:43:58 UTC","id":1132,"auditable_id":269,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-14 16:43:57 UTC","id":1131,"auditable_id":268,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 23:05:22 UTC","id":1130,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 23:04:43 UTC","id":1129,"auditable_id":60,"auditable_name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":"d2271f2e-60f8-45ee-a8a0-648506e41981","name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 23:04:43 UTC","id":1128,"auditable_id":52,"auditable_name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","auditable_type":"Host","action":"create","audited_changes":{"name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 23:03:32 UTC","id":1127,"auditable_id":51,"auditable_name":"testthis.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 23:02:34 UTC","id":1126,"auditable_id":51,"auditable_name":"testthis.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 23:02:33 UTC","id":1125,"auditable_id":51,"auditable_name":"testthis.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.30","associated_name":null,"created_at":"2017-03-13 23:02:25 UTC","id":1124,"auditable_id":51,"auditable_name":"testthis.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"testthis.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-03-13 23:00:01 UTC","id":1122,"auditable_id":50,"auditable_name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","auditable_type":"Host","action":"destroy","audited_changes":{"name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"subscription_facet_attributes":{"id":51,"host_id":50,"uuid":"b4011dcd-9913-47d6-ad60-37c875335574","last_checkin":null,"service_level":null,"release_version":null,"autoheal":false,"registered_at":"2016-08-13T19:49:20.436Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 21:50:46 UTC","id":1120,"auditable_id":50,"auditable_name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","auditable_type":"Host","action":"create","audited_changes":{"name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 21:42:49 UTC","id":1119,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 20:29:32 UTC","id":1118,"auditable_id":49,"auditable_name":"canis.hq.gsslab.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 20:28:32 UTC","id":1117,"auditable_id":49,"auditable_name":"canis.hq.gsslab.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 20:28:30 UTC","id":1116,"auditable_id":49,"auditable_name":"canis.hq.gsslab.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,4],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.12.209.149","associated_name":null,"created_at":"2017-03-13 20:28:17 UTC","id":1115,"auditable_id":49,"auditable_name":"canis.hq.gsslab.rdu.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"canis.hq.gsslab.rdu.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":30,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 18:15:14 UTC","id":1113,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 18:15:12 UTC","id":1112,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 18:15:11 UTC","id":1111,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 18:15:10 UTC","id":1110,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-13 18:15:09 UTC","id":1109,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":29,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-12 20:30:56 UTC","id":1108,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":28,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-03-12 09:48:14 UTC","id":1107,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":27,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-03-12 09:20:30 UTC","id":1106,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":26,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-03-11 09:47:12 UTC","id":1105,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":25,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-03-11 09:19:39 UTC","id":1104,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":38,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-03-10 10:58:38 UTC","id":1103,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":37,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-03-10 10:39:18 UTC","id":1102,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":21,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-03-09 11:19:00 UTC","id":1101,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":20,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2017-03-09 10:50:03 UTC","id":1100,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":1,"associated_type":"Puppetclass","remote_address":"10.13.153.151","associated_name":"motd","created_at":"2017-03-09 01:28:39 UTC","id":1099,"auditable_id":3,"auditable_name":"motd::content","auditable_type":"LookupKey","action":"update","audited_changes":{"description":[null,""],"override":[false,true],"path":[null,"fqdn\nhostgroup\nlifecycle_environment\ncontent_view\nhostgroup_type\nlocation\nos\norganization\ndomain"],"puppetclass_id":[null,1],"use_puppet_default":[null,false]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-07 19:49:33 UTC","id":1098,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-07 19:49:23 UTC","id":1097,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-07 19:49:23 UTC","id":1096,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-07 19:49:06 UTC","id":1095,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.203","associated_name":null,"created_at":"2017-03-07 19:48:52 UTC","id":1094,"auditable_id":56,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"drone67.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":21,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-07 10:12:40 UTC","id":1093,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":19,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-07 10:09:52 UTC","id":1092,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":18,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 20:12:53 UTC","id":1091,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:19:07 UTC","id":1090,"auditable_id":265,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:19:07 UTC","id":1089,"auditable_id":266,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:19:07 UTC","id":1088,"auditable_id":264,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:19:07 UTC","id":1087,"auditable_id":267,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":90,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:19:06 UTC","id":1086,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:19:05 UTC","id":1085,"auditable_id":267,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":89,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:19:05 UTC","id":1084,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:19:04 UTC","id":1083,"auditable_id":266,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:19:04 UTC","id":1082,"auditable_id":265,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:19:04 UTC","id":1081,"auditable_id":264,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:13:29 UTC","id":1080,"auditable_id":261,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:13:29 UTC","id":1079,"auditable_id":262,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:13:29 UTC","id":1078,"auditable_id":260,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:13:29 UTC","id":1077,"auditable_id":263,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":88,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:13:28 UTC","id":1076,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:13:27 UTC","id":1075,"auditable_id":263,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":87,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:13:27 UTC","id":1074,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:13:27 UTC","id":1073,"auditable_id":262,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:13:27 UTC","id":1072,"auditable_id":261,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:13:26 UTC","id":1071,"auditable_id":260,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":20,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:12:03 UTC","id":1070,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":19,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:11:29 UTC","id":1069,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:04:10 UTC","id":1068,"auditable_id":257,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:04:10 UTC","id":1067,"auditable_id":258,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:04:10 UTC","id":1066,"auditable_id":256,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:04:10 UTC","id":1065,"auditable_id":259,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":86,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:04:09 UTC","id":1064,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:04:08 UTC","id":1063,"auditable_id":259,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":85,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:04:08 UTC","id":1062,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:04:07 UTC","id":1061,"auditable_id":258,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:04:07 UTC","id":1060,"auditable_id":257,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:04:07 UTC","id":1059,"auditable_id":256,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:02:01 UTC","id":1058,"auditable_id":253,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:02:01 UTC","id":1057,"auditable_id":254,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:02:01 UTC","id":1056,"auditable_id":252,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:02:01 UTC","id":1055,"auditable_id":255,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":84,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:02:00 UTC","id":1054,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:01:59 UTC","id":1053,"auditable_id":255,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":83,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:01:59 UTC","id":1052,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:01:58 UTC","id":1051,"auditable_id":254,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:01:58 UTC","id":1050,"auditable_id":253,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 16:01:58 UTC","id":1049,"auditable_id":252,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 15:59:35 UTC","id":1048,"auditable_id":249,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 15:59:35 UTC","id":1047,"auditable_id":250,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 15:59:35 UTC","id":1046,"auditable_id":248,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 15:59:35 UTC","id":1045,"auditable_id":251,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 15:59:34 UTC","id":1044,"auditable_id":77,"auditable_name":"Satellite Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<%#\nkind: provision\nname: Satellite Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","<%#\nkind: provision\nname: Satellite Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":82,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 15:59:34 UTC","id":1043,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 15:59:33 UTC","id":1042,"auditable_id":251,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= \" --device=#{@host.mac}\" -%>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":81,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 15:59:33 UTC","id":1041,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 15:59:32 UTC","id":1040,"auditable_id":250,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 15:59:32 UTC","id":1039,"auditable_id":249,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 15:59:32 UTC","id":1038,"auditable_id":248,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":20,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-03-06 14:31:51 UTC","id":1037,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-27 18:06:52 UTC","id":1036,"auditable_id":48,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-27 18:06:30 UTC","id":1035,"auditable_id":48,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-27 18:06:08 UTC","id":1034,"auditable_id":48,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.120","associated_name":null,"created_at":"2017-02-27 18:06:04 UTC","id":1033,"auditable_id":48,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"operatingsystem_id":[null,11]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.120","associated_name":null,"created_at":"2017-02-27 18:06:03 UTC","id":1032,"auditable_id":48,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone511.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.120","associated_name":null,"created_at":"2017-02-27 18:06:02 UTC","id":1031,"auditable_id":55,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"drone511.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-24 15:14:08 UTC","id":1030,"auditable_id":12,"auditable_name":"Base_Org/Library/Red_Hat_Server/Red_Hat_Enterprise_Linux_5_Server_Kickstart_x86_64_5_11","auditable_type":"Medium","action":"create","audited_changes":{"name":"Base_Org/Library/Red_Hat_Server/Red_Hat_Enterprise_Linux_5_Server_Kickstart_x86_64_5_11","path":"http://batman.usersys.redhat.com/pulp/repos/Base_Org/Library/content/dist/rhel/server/5/5.11/x86_64/kickstart/","media_path":null,"config_path":null,"image_path":null,"os_family":"Redhat"}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":28,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-22 22:43:31 UTC","id":1029,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":27,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-22 22:43:25 UTC","id":1028,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":36,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-02-21 11:51:33 UTC","id":1025,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":35,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-02-21 11:21:33 UTC","id":1024,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":24,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-02-20 10:05:10 UTC","id":1023,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":23,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-02-20 09:39:01 UTC","id":1022,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":22,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-02-19 13:34:14 UTC","id":1021,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":21,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-02-19 13:07:14 UTC","id":1020,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":34,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-02-19 11:21:45 UTC","id":1019,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":20,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-02-19 10:05:50 UTC","id":1018,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":33,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-02-19 09:47:31 UTC","id":1017,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":19,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-02-19 09:35:42 UTC","id":1016,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":32,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-02-18 13:49:39 UTC","id":1015,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":18,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-02-18 13:33:50 UTC","id":1014,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":31,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-02-18 13:23:35 UTC","id":1013,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":17,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2017-02-18 12:07:20 UTC","id":1012,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":30,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-02-18 10:22:03 UTC","id":1011,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":29,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-02-18 09:28:46 UTC","id":1010,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-02-17 16:23:39 UTC","id":1009,"auditable_id":9,"auditable_name":"Storrs","auditable_type":"Location","action":"destroy","audited_changes":{"name":"Storrs","ignore_types":["ProvisioningTemplate","Hostgroup"],"description":"","label":null,"ancestry":null,"katello_default":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-02-17 16:23:35 UTC","id":1008,"auditable_id":8,"auditable_name":"Storrs/Primary Campus DC","auditable_type":"Location","action":"destroy","audited_changes":{"name":"Primary Campus DC","ignore_types":["ProvisioningTemplate","Hostgroup"],"description":"","label":null,"ancestry":"9","katello_default":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-02-17 16:15:56 UTC","id":1006,"auditable_id":7,"auditable_name":"Groton","auditable_type":"Location","action":"destroy","audited_changes":{"name":"Groton","ignore_types":["ProvisioningTemplate","Hostgroup"],"description":"","label":null,"ancestry":null,"katello_default":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-02-17 16:15:07 UTC","id":1005,"auditable_id":8,"auditable_name":"Primary Campus DC","auditable_type":"Location","action":"update","audited_changes":{"ancestry":[null,"9"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-02-17 16:14:55 UTC","id":1004,"auditable_id":9,"auditable_name":"Storrs","auditable_type":"Location","action":"create","audited_changes":{"name":"Storrs","ignore_types":["ProvisioningTemplate","Hostgroup"],"description":"","label":null,"ancestry":null,"katello_default":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-02-17 16:12:33 UTC","id":1003,"auditable_id":8,"auditable_name":"Primary Campus DC","auditable_type":"Location","action":"create","audited_changes":{"name":"Primary Campus DC","ignore_types":["ProvisioningTemplate","Hostgroup"],"description":"","label":null,"ancestry":null,"katello_default":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-02-17 16:12:15 UTC","id":1002,"auditable_id":7,"auditable_name":"Groton","auditable_type":"Location","action":"create","audited_changes":{"name":"Groton","ignore_types":["ProvisioningTemplate","Hostgroup"],"description":"","label":null,"ancestry":null,"katello_default":false}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-17 12:20:58 UTC","id":1001,"auditable_id":26,"auditable_name":"puppet.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-17 12:20:47 UTC","id":1000,"auditable_id":22,"auditable_name":"drone71.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-17 12:20:28 UTC","id":999,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-17 12:10:07 UTC","id":998,"auditable_id":47,"auditable_name":"platoonbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":19,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-17 12:08:26 UTC","id":997,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:54:28 UTC","id":996,"auditable_id":245,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:54:28 UTC","id":995,"auditable_id":246,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:54:28 UTC","id":994,"auditable_id":244,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:54:28 UTC","id":993,"auditable_id":247,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":80,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:54:27 UTC","id":992,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:54:26 UTC","id":991,"auditable_id":247,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":79,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:54:26 UTC","id":990,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:54:26 UTC","id":989,"auditable_id":246,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:54:26 UTC","id":988,"auditable_id":245,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:54:26 UTC","id":987,"auditable_id":244,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2017-02-16 19:52:20 UTC","id":986,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"SmartProxy","action":"update","audited_changes":{"pubkey":["ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDiepO+d6GHZCNexIQJ9HirFIRyXLwZbDdtpBla48CMkPVc0jW67sBt7wZ2+ojEdixr5SHr3O5DoETa4WpP9T9dCku+LnEFW/3AShtKyMH3zWinD5NLYjFJJqAw9Yni+bCNdiSgiA0c4wGYxdoA9IMJc8ODnl/qdkRMBjUt5NZGBST94gQSl2TgExyvH10kMsW07tasDcajPClFROJ7k5PRV4aJaXbRvuUcPRX6uynnMmRvIX9xFAx0sfIx0p7qQXyQofJESFC9yakGk5iKTwFXhKs3cTA+xaecciYFI6dRawkEEK1Y24hwNApyhydud9MNzri4vHNZ9wDM07S+bosf foreman-proxy@batman.usersys.redhat.com","ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5hvJ486UieM5sYdwrZ6DplV22cbdam7Ztq1i0KbAfR/eRhKqEs+ZGMJ2X0dILS9Yq/4DpyMLdRlH3QgPGin8mzAoCdQTxG1dAOC9noSKTkcVTpc1mTgOKTHVOLmNWhfO60XobW915xk+wF3i5bKNf6x3AMeDChLQf2AQ39Ll2MldEnHK9HLWhoEnkNa8OgboaiYR2FJvAwSN/BiD3eixOt/sYPP5XyZSfrXgeXU4UrXCVNL05XJWDL5XXSrrGmO1JvpHS6AlH5hCGmSz+mryjbi/mvEQN58xBtu4kTPkiBOsOsD8QAyOq7OTa77Pc4e4937Sp6UTcMinNAoONyCll root@batman.usersys.redhat.com"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:50:03 UTC","id":985,"auditable_id":241,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:50:03 UTC","id":984,"auditable_id":242,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:50:03 UTC","id":983,"auditable_id":240,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:50:03 UTC","id":982,"auditable_id":243,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":78,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:50:02 UTC","id":981,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:50:00 UTC","id":980,"auditable_id":243,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":77,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:50:00 UTC","id":979,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:50:00 UTC","id":978,"auditable_id":242,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:50:00 UTC","id":977,"auditable_id":241,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:50:00 UTC","id":976,"auditable_id":240,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":18,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:48:45 UTC","id":975,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":17,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 19:48:12 UTC","id":974,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:19:15 UTC","id":973,"auditable_id":237,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:19:15 UTC","id":972,"auditable_id":238,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:19:15 UTC","id":971,"auditable_id":236,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:19:15 UTC","id":970,"auditable_id":239,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":76,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:19:14 UTC","id":969,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:19:13 UTC","id":968,"auditable_id":239,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":75,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:19:13 UTC","id":967,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:19:12 UTC","id":966,"auditable_id":238,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:19:12 UTC","id":965,"auditable_id":237,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:19:12 UTC","id":964,"auditable_id":236,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:15:35 UTC","id":963,"auditable_id":233,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:15:35 UTC","id":962,"auditable_id":234,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:15:35 UTC","id":961,"auditable_id":232,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:15:35 UTC","id":960,"auditable_id":235,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":74,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:15:34 UTC","id":959,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:15:32 UTC","id":958,"auditable_id":235,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":73,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:15:32 UTC","id":957,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:15:32 UTC","id":956,"auditable_id":234,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:15:32 UTC","id":955,"auditable_id":233,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-02-16 18:15:31 UTC","id":954,"auditable_id":232,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":21,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-25 11:25:31 UTC","id":953,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":26,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-24 20:35:23 UTC","id":952,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":20,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-24 18:01:48 UTC","id":951,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":19,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-24 17:14:32 UTC","id":950,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":25,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-24 16:56:59 UTC","id":949,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":18,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-24 16:56:35 UTC","id":948,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-24 16:40:39 UTC","id":945,"auditable_id":26,"auditable_name":"puppet.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-24 16:35:20 UTC","id":944,"auditable_id":22,"auditable_name":"drone71.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-24 16:28:44 UTC","id":943,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.126","associated_name":null,"created_at":"2017-01-23 20:08:02 UTC","id":942,"auditable_id":24,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone511.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":11,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":18,"host_id":24,"uuid":"f1011b82-e1d9-4647-b242-17bb3d5c1655","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":22,"host_id":24,"uuid":"f1011b82-e1d9-4647-b242-17bb3d5c1655","last_checkin":"2017-01-23T16:14:43.690Z","service_level":null,"release_version":"5.11","autoheal":true,"registered_at":"2016-11-27T18:45:41.125Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":18,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-23 18:21:18 UTC","id":941,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-20 16:16:40 UTC","id":940,"auditable_id":47,"auditable_name":"platoonbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-19 21:23:03 UTC","id":939,"auditable_id":47,"auditable_name":"platoonbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-19 20:56:09 UTC","id":938,"auditable_id":47,"auditable_name":"platoonbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.80","associated_name":null,"created_at":"2017-01-19 20:56:03 UTC","id":937,"auditable_id":47,"auditable_name":"platoonbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,2],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.80","associated_name":null,"created_at":"2017-01-19 20:56:01 UTC","id":936,"auditable_id":47,"auditable_name":"platoonbox.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"platoonbox.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.82","associated_name":null,"created_at":"2017-01-16 22:25:42 UTC","id":934,"auditable_id":46,"auditable_name":"uritest.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"uritest.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":11,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":38,"host_id":46,"uuid":"82c8aeb3-2c42-4cf5-b999-54a9204cebf2","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":42,"host_id":46,"uuid":"82c8aeb3-2c42-4cf5-b999-54a9204cebf2","last_checkin":"2017-01-16T20:36:29.277Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-01-16T16:38:56.546Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":17,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 17:05:58 UTC","id":933,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 16:43:21 UTC","id":932,"auditable_id":46,"auditable_name":"uritest.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 16:39:36 UTC","id":931,"auditable_id":46,"auditable_name":"uritest.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 16:38:59 UTC","id":930,"auditable_id":46,"auditable_name":"uritest.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.82","associated_name":null,"created_at":"2017-01-16 16:38:56 UTC","id":929,"auditable_id":46,"auditable_name":"uritest.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"operatingsystem_id":[null,11]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.82","associated_name":null,"created_at":"2017-01-16 16:38:55 UTC","id":928,"auditable_id":46,"auditable_name":"uritest.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"uritest.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 14:29:56 UTC","id":923,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 14:29:38 UTC","id":922,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 14:28:10 UTC","id":921,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 14:28:00 UTC","id":920,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 14:27:48 UTC","id":919,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 14:27:12 UTC","id":918,"auditable_id":27,"auditable_name":"camworkstation.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 14:26:48 UTC","id":917,"auditable_id":45,"auditable_name":"disconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 14:25:54 UTC","id":916,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 13:03:56 UTC","id":915,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 13:03:55 UTC","id":914,"auditable_id":27,"auditable_name":"camworkstation.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 13:03:53 UTC","id":913,"auditable_id":45,"auditable_name":"disconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 13:03:47 UTC","id":912,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 13:03:37 UTC","id":911,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 13:03:35 UTC","id":910,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 13:03:33 UTC","id":909,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":17,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 10:02:35 UTC","id":908,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-16 10:02:33 UTC","id":907,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-15 15:26:53 UTC","id":906,"auditable_id":45,"auditable_name":"disconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-15 14:54:54 UTC","id":905,"auditable_id":45,"auditable_name":"disconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-15 14:53:32 UTC","id":904,"auditable_id":45,"auditable_name":"disconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.153","associated_name":null,"created_at":"2017-01-15 14:51:08 UTC","id":903,"auditable_id":45,"auditable_name":"disconnected.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.153","associated_name":null,"created_at":"2017-01-15 14:51:06 UTC","id":902,"auditable_id":45,"auditable_name":"disconnected.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"disconnected.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-13 17:44:29 UTC","id":897,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":3,"user_type":null,"user_name":"admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-01-09 22:18:50 UTC","id":896,"auditable_id":96,"auditable_name":"Install Errata - Katello SSH Default","auditable_type":"JobTemplate","action":"update","audited_changes":{"locked":[false,true]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":"","associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-01-09 22:18:46 UTC","id":895,"auditable_id":96,"auditable_name":"Install Errata - Katello SSH Default","auditable_type":"JobTemplate","action":"update","audited_changes":{"template":["<%= render_template('Package Action - SSH Default', :action => 'update', :package => \"--advisories=#{input(:errata)}\") %>","<% if @host.operatingsystem.family == \"Redhat\" && @host.operatingsystem.major.to_i >= 6 %>\n   <%= render_template('Package Action - SSH Default', :action => 'update', :package => \"--advisory=#{input(:errata)}\") %>\n<% else %>\n   <% advisories = input(:errata).split(',').map { |e| \"--advisory=#{e}\" }.join(' ') %>\n   <%= render_template('Package Action - SSH Default', :action => 'update', :package => advisories) %>\n<% end %>"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-01-09 22:18:18 UTC","id":894,"auditable_id":96,"auditable_name":"Install Errata - Katello SSH Default","auditable_type":"JobTemplate","action":"update","audited_changes":{"locked":[true,false]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-07 09:32:39 UTC","id":893,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-06 21:54:03 UTC","id":892,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-06 21:53:57 UTC","id":891,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-01-06 21:53:50 UTC","id":890,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-01-06 21:53:49 UTC","id":889,"auditable_id":43,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-01-06 21:52:47 UTC","id":887,"auditable_id":42,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":34,"host_id":42,"uuid":"802040c0-b228-4298-ba62-d87100a1826d","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":38,"host_id":42,"uuid":"802040c0-b228-4298-ba62-d87100a1826d","last_checkin":"2017-01-06T21:46:33.260Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-01-06T21:46:27.755Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-01-06 21:46:27 UTC","id":886,"auditable_id":42,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-01-06 21:46:25 UTC","id":885,"auditable_id":42,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-01-06 21:46:02 UTC","id":883,"auditable_id":41,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":33,"host_id":41,"uuid":"dbc2a147-e7a4-43d6-bbfa-df46ee7a2cdd","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":37,"host_id":41,"uuid":"dbc2a147-e7a4-43d6-bbfa-df46ee7a2cdd","last_checkin":"2017-01-06T21:45:40.993Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-01-06T21:45:35.697Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-06 21:45:46 UTC","id":882,"auditable_id":41,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-06 21:45:42 UTC","id":881,"auditable_id":41,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-01-06 21:45:35 UTC","id":880,"auditable_id":41,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-01-06 21:45:33 UTC","id":879,"auditable_id":41,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-01-06 21:44:19 UTC","id":877,"auditable_id":40,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":32,"host_id":40,"uuid":"954f6efe-1516-47b5-8fef-2289184a8cde","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":36,"host_id":40,"uuid":"954f6efe-1516-47b5-8fef-2289184a8cde","last_checkin":"2017-01-06T21:43:50.997Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2017-01-06T21:43:11.074Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-06 21:43:57 UTC","id":876,"auditable_id":40,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-06 21:43:52 UTC","id":875,"auditable_id":40,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-06 21:43:12 UTC","id":874,"auditable_id":40,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-01-06 21:43:10 UTC","id":873,"auditable_id":40,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-01-06 21:43:09 UTC","id":872,"auditable_id":40,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2017-01-06 21:42:18 UTC","id":870,"auditable_id":35,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":28,"host_id":35,"uuid":"39f58dd0-dacf-40d0-b02a-d20cc452670b","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":34,"host_id":35,"uuid":"39f58dd0-dacf-40d0-b02a-d20cc452670b","last_checkin":"2017-01-06T21:07:20.291Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2016-12-29T20:58:11.093Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-06 09:38:58 UTC","id":869,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-01-05 21:54:14 UTC","id":868,"auditable_id":4,"auditable_name":null,"auditable_type":"User","action":"destroy","audited_changes":{"login":"test","firstname":"Taft","lastname":"Sanders","mail":"Tasander@redhat.com","admin":false,"auth_source_id":1,"locale":null,"avatar_hash":null,"default_organization_id":1,"default_location_id":2,"lower_login":"test","mail_enabled":true,"timezone":"America/New_York"}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-05 17:08:13 UTC","id":867,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-05 16:59:05 UTC","id":866,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-05 16:58:55 UTC","id":865,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-05 16:58:41 UTC","id":864,"auditable_id":27,"auditable_name":"camworkstation.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-05 16:58:23 UTC","id":863,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-05 16:54:10 UTC","id":862,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-05 05:00:17 UTC","id":861,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-05 05:00:14 UTC","id":860,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-05 05:00:10 UTC","id":859,"auditable_id":27,"auditable_name":"camworkstation.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2017-01-05 05:00:04 UTC","id":858,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-01-03 15:59:09 UTC","id":857,"auditable_id":36,"auditable_name":"baremetal-test3.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"baremetal-test3.usersys.redhat.com","root_pass":"$5$LuE7yhf+$uf8KZc3Shz.YWoB6Qkd9.gBdKy04rW2ynLFh5M40HQ2","architecture_id":1,"operatingsystem_id":2,"environment_id":null,"ptable_id":61,"medium_id":9,"build":false,"comment":"","disk":"","installed_at":"2016-12-29T22:50:45.798Z","model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":true,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":"build","content_source_id":null,"grub_pass":"$5$LuE7yhf+$uf8KZc3Shz.YWoB6Qkd9.gBdKy04rW2ynLFh5M40HQ2","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2017-01-03 15:34:43 UTC","id":856,"auditable_id":39,"auditable_name":"testvm2.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"testvm2.usersys.redhat.com","root_pass":"$5$GgknYfDP$HZ25j274qU93kU1fGY9HcIv24e.mGqdR6tx4o/WqAK5","architecture_id":1,"operatingsystem_id":2,"environment_id":2,"ptable_id":61,"medium_id":null,"build":true,"comment":"","disk":"","installed_at":null,"model_id":null,"hostgroup_id":2,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":1,"managed":true,"use_image":null,"image_file":null,"uuid":"70d4fcef-6578-40dd-a874-53bb8d960ca3","compute_resource_id":1,"puppet_proxy_id":1,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":4,"provision_method":"build","content_source_id":1,"grub_pass":"$5$GgknYfDP$HZ25j274qU93kU1fGY9HcIv24e.mGqdR6tx4o/WqAK5","content_view_id":1,"lifecycle_environment_id":1,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":31,"host_id":39,"uuid":null,"content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":9}}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:46:06 UTC","id":855,"auditable_id":229,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:46:06 UTC","id":854,"auditable_id":230,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:46:06 UTC","id":853,"auditable_id":228,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:46:06 UTC","id":852,"auditable_id":231,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":72,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:46:05 UTC","id":851,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:46:04 UTC","id":850,"auditable_id":231,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":71,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:46:04 UTC","id":849,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:46:03 UTC","id":848,"auditable_id":230,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:46:03 UTC","id":847,"auditable_id":229,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:46:03 UTC","id":846,"auditable_id":228,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:38:22 UTC","id":845,"auditable_id":225,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:38:22 UTC","id":844,"auditable_id":226,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:38:22 UTC","id":843,"auditable_id":224,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:38:22 UTC","id":842,"auditable_id":227,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":70,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:38:21 UTC","id":841,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:38:20 UTC","id":840,"auditable_id":227,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":69,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:38:20 UTC","id":839,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:38:20 UTC","id":838,"auditable_id":226,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:38:20 UTC","id":837,"auditable_id":225,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 21:38:20 UTC","id":836,"auditable_id":224,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-30 19:09:51 UTC","id":835,"auditable_id":1,"auditable_name":"usersys.redhat.com","auditable_type":"Domain","action":"update","audited_changes":{"fullname":[null,""],"dns_id":[null,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-30 18:51:12 UTC","id":834,"auditable_id":39,"auditable_name":"testvm2.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"testvm2.usersys.redhat.com","root_pass":"$5$GgknYfDP$HZ25j274qU93kU1fGY9HcIv24e.mGqdR6tx4o/WqAK5","architecture_id":1,"operatingsystem_id":2,"environment_id":2,"ptable_id":61,"medium_id":null,"build":true,"comment":"","disk":"","installed_at":null,"model_id":null,"hostgroup_id":2,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":1,"managed":true,"use_image":null,"image_file":null,"uuid":"70d4fcef-6578-40dd-a874-53bb8d960ca3","compute_resource_id":1,"puppet_proxy_id":1,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":4,"provision_method":"build","content_source_id":1,"grub_pass":"$5$GgknYfDP$HZ25j274qU93kU1fGY9HcIv24e.mGqdR6tx4o/WqAK5","content_view_id":1,"lifecycle_environment_id":1,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":null,"host_id":null,"uuid":null,"content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":9}}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-30 18:48:50 UTC","id":833,"auditable_id":38,"auditable_name":"testvm.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"testvm.usersys.redhat.com","root_pass":"$5$GgknYfDP$HZ25j274qU93kU1fGY9HcIv24e.mGqdR6tx4o/WqAK5","architecture_id":1,"operatingsystem_id":2,"environment_id":1,"ptable_id":61,"medium_id":null,"build":true,"comment":"","disk":"","installed_at":null,"model_id":null,"hostgroup_id":2,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":1,"managed":true,"use_image":null,"image_file":null,"uuid":"22bc5a47-7dd1-4f3b-a7b8-ffcc31af5655","compute_resource_id":1,"puppet_proxy_id":1,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":4,"provision_method":"build","content_source_id":1,"grub_pass":"$5$GgknYfDP$HZ25j274qU93kU1fGY9HcIv24e.mGqdR6tx4o/WqAK5","content_view_id":1,"lifecycle_environment_id":1,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":30,"host_id":38,"uuid":null,"content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":9}}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":4,"associated_type":"ComputeProfile","remote_address":"10.13.153.228","associated_name":"ClientVM","created_at":"2016-12-30 18:45:03 UTC","id":832,"auditable_id":1,"auditable_name":"2 CPUs and 4 GB memory","auditable_type":"ComputeAttribute","action":"update","audited_changes":{"vm_attrs":[{"cpus":"2","memory":"4294967296","image_id":"/var/lib/libvirt/images/rhel-server-7.3-x86_64-dvd.iso","nics_attributes":{"0":{"type":"bridge","bridge":"br0","model":"virtio"}},"volumes_attributes":{"0":{"pool_name":"default","capacity":"10G","allocation":"0G","format_type":"raw"}}},{"cpus":"2","memory":"4294967296","image_id":"/var/lib/libvirt/images/rhel-server-7.3-x86_64-dvd.iso","nics_attributes":{"0":{"type":"network","network":"BatmanProvision","bridge":"br0","model":"virtio"}},"volumes_attributes":{"0":{"pool_name":"default","capacity":"10G","allocation":"0G","format_type":"raw"}}}]}},{"user_id":3,"user_type":null,"user_name":"admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-30 18:44:38 UTC","id":831,"auditable_id":1,"auditable_name":"taft.prov (192.168.100.0/24)","auditable_type":"Subnet","action":"update","audited_changes":{"gateway":["","192.168.100.254"],"from":["192.168.100.200","192.168.100.100"],"to":["192.168.100.254","192.168.100.253"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-30 17:21:36 UTC","id":830,"auditable_id":1,"auditable_name":"taft.prov (192.168.100.0/24)","auditable_type":"Subnet","action":"update","audited_changes":{"dhcp_id":[null,1],"dns_id":[null,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 17:07:17 UTC","id":829,"auditable_id":35,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 17:07:10 UTC","id":828,"auditable_id":35,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 16:52:21 UTC","id":827,"auditable_id":221,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 16:52:21 UTC","id":826,"auditable_id":222,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 16:52:21 UTC","id":825,"auditable_id":220,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 16:52:21 UTC","id":824,"auditable_id":223,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":68,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 16:52:20 UTC","id":823,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 16:52:19 UTC","id":822,"auditable_id":223,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":67,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 16:52:19 UTC","id":821,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 16:52:19 UTC","id":820,"auditable_id":222,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 16:52:19 UTC","id":819,"auditable_id":221,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 16:52:19 UTC","id":818,"auditable_id":220,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-30 16:34:51 UTC","id":817,"auditable_id":1,"auditable_name":"taft.prov (192.168.100.0/24)","auditable_type":"Subnet","action":"create","audited_changes":{"network":"192.168.100.0","mask":"255.255.255.0","priority":null,"name":"taft.prov","vlanid":"","dhcp_id":null,"tftp_id":1,"gateway":"","dns_primary":"","dns_secondary":"","from":"192.168.100.200","to":"192.168.100.254","dns_id":null,"boot_mode":"DHCP","ipam":"DHCP","discovery_id":1}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 15:17:25 UTC","id":816,"auditable_id":217,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 15:17:25 UTC","id":815,"auditable_id":218,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 15:17:25 UTC","id":814,"auditable_id":216,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 15:17:25 UTC","id":813,"auditable_id":219,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":66,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 15:17:24 UTC","id":812,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 15:17:23 UTC","id":811,"auditable_id":219,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":65,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 15:17:23 UTC","id":810,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 15:17:23 UTC","id":809,"auditable_id":218,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 15:17:23 UTC","id":808,"auditable_id":217,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-30 15:17:23 UTC","id":807,"auditable_id":216,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-30 15:13:25 UTC","id":806,"auditable_id":38,"auditable_name":"testvm.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"testvm.usersys.redhat.com","root_pass":"$5$GgknYfDP$HZ25j274qU93kU1fGY9HcIv24e.mGqdR6tx4o/WqAK5","architecture_id":1,"operatingsystem_id":2,"environment_id":1,"ptable_id":61,"medium_id":null,"build":true,"comment":"","disk":"","installed_at":null,"model_id":null,"hostgroup_id":2,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":1,"managed":true,"use_image":null,"image_file":null,"uuid":"22bc5a47-7dd1-4f3b-a7b8-ffcc31af5655","compute_resource_id":1,"puppet_proxy_id":1,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":4,"provision_method":"build","content_source_id":1,"grub_pass":"$5$GgknYfDP$HZ25j274qU93kU1fGY9HcIv24e.mGqdR6tx4o/WqAK5","content_view_id":1,"lifecycle_environment_id":1,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":null,"host_id":null,"uuid":null,"content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":9}}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":4,"associated_type":"ComputeProfile","remote_address":"10.13.153.228","associated_name":"ClientVM","created_at":"2016-12-30 15:12:15 UTC","id":805,"auditable_id":1,"auditable_name":"2 CPUs and 4 GB memory","auditable_type":"ComputeAttribute","action":"create","audited_changes":{"compute_profile_id":4,"compute_resource_id":1,"name":"2 CPUs and 4 GB memory","vm_attrs":{"cpus":"2","memory":"4294967296","image_id":"/var/lib/libvirt/images/rhel-server-7.3-x86_64-dvd.iso","nics_attributes":{"0":{"type":"bridge","bridge":"br0","model":"virtio"}},"volumes_attributes":{"0":{"pool_name":"default","capacity":"10G","allocation":"0G","format_type":"raw"}}}}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-30 15:10:06 UTC","id":804,"auditable_id":4,"auditable_name":"ClientVM","auditable_type":"ComputeProfile","action":"create","audited_changes":{"name":"ClientVM"}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-30 15:08:35 UTC","id":803,"auditable_id":2,"auditable_name":"Rhel7.3","auditable_type":"Image","action":"create","audited_changes":{"operatingsystem_id":4,"compute_resource_id":1,"architecture_id":1,"uuid":"/var/lib/libvirt/images/rhel-server-7.3-x86_64-dvd.iso","username":"root","name":"Rhel7.3","iam_role":null,"user_data":false,"password":"redhat"}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-30 15:02:56 UTC","id":802,"auditable_id":11,"auditable_name":"Base_Org/Library/Red_Hat_Server/Red_Hat_Enterprise_Linux_7_Server_Kickstart_x86_64_7_3","auditable_type":"Medium","action":"update","audited_changes":{"media_path":[null,""],"config_path":[null,""],"image_path":[null,""]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-30 14:59:59 UTC","id":801,"auditable_id":2,"auditable_name":"vmbuild","auditable_type":"Hostgroup","action":"create","audited_changes":{"name":"vmbuild","environment_id":null,"operatingsystem_id":2,"architecture_id":1,"medium_id":null,"ptable_id":61,"root_pass":"$5$GgknYfDP$HZ25j274qU93kU1fGY9HcIv24e.mGqdR6tx4o/WqAK5","puppet_ca_proxy_id":1,"use_image":null,"image_file":null,"ancestry":null,"vm_defaults":null,"subnet_id":null,"domain_id":1,"puppet_proxy_id":1,"realm_id":null,"compute_profile_id":null,"content_source_id":1,"grub_pass":"$1$247bLwCe$KW2HfkLhOS4AIDTxR7w870","content_view_id":1,"lifecycle_environment_id":1,"lookup_value_matcher":"hostgroup=vmbuild","kickstart_repository_id":9,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-30 14:36:03 UTC","id":800,"auditable_id":5,"auditable_name":"Candace ","auditable_type":"User","action":"destroy","audited_changes":{"login":"Meta_Knight","firstname":"Candace","lastname":"","mail":"candace@redhat.com","admin":true,"auth_source_id":1,"locale":null,"avatar_hash":null,"default_organization_id":1,"default_location_id":null,"lower_login":"meta_knight","mail_enabled":false,"timezone":""}},{"user_id":3,"user_type":null,"user_name":"admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-30 14:35:53 UTC","id":799,"auditable_id":37,"auditable_name":"regclass67.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"regclass67.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":8,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":5,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":29,"host_id":37,"uuid":"9fcc6232-45be-4723-a76a-78ab7f07f613","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":35,"host_id":37,"uuid":"9fcc6232-45be-4723-a76a-78ab7f07f613","last_checkin":"2016-12-30T11:16:17.810Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2016-12-29T23:07:25.953Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-29 23:07:27 UTC","id":796,"auditable_id":37,"auditable_name":"regclass67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":5,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.45","associated_name":null,"created_at":"2016-12-29 23:07:25 UTC","id":795,"auditable_id":37,"auditable_name":"regclass67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,8]}},{"user_id":5,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.45","associated_name":null,"created_at":"2016-12-29 23:07:24 UTC","id":794,"auditable_id":37,"auditable_name":"regclass67.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"regclass67.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":5,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.150","associated_name":null,"created_at":"2016-12-29 23:06:54 UTC","id":792,"auditable_id":5,"auditable_name":"Candace ","auditable_type":"User","action":"update","audited_changes":{"admin":[false,true]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.202","associated_name":null,"created_at":"2016-12-29 22:50:45 UTC","id":791,"auditable_id":36,"auditable_name":"baremetal-test3.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"build":[true,false],"installed_at":[null,"2016-12-29T22:50:45.798Z"],"grub_pass":["$1$0jfY7Xp5$ActQAbW8UONJqUTlMVWp00","$5$LuE7yhf+$uf8KZc3Shz.YWoB6Qkd9.gBdKy04rW2ynLFh5M40HQ2"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-29 22:32:56 UTC","id":790,"auditable_id":36,"auditable_name":"baremetal-test3.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"baremetal-test3.usersys.redhat.com","root_pass":"$5$LuE7yhf+$uf8KZc3Shz.YWoB6Qkd9.gBdKy04rW2ynLFh5M40HQ2","architecture_id":1,"operatingsystem_id":2,"environment_id":null,"ptable_id":61,"medium_id":9,"build":true,"comment":"","disk":"","installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":true,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":"build","content_source_id":null,"grub_pass":"$1$0jfY7Xp5$ActQAbW8UONJqUTlMVWp00","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-29 22:20:45 UTC","id":789,"auditable_id":11,"auditable_name":"Base_Org/Library/Red_Hat_Server/Red_Hat_Enterprise_Linux_7_Server_Kickstart_x86_64_7_3","auditable_type":"Medium","action":"create","audited_changes":{"name":"Base_Org/Library/Red_Hat_Server/Red_Hat_Enterprise_Linux_7_Server_Kickstart_x86_64_7_3","path":"http://batman.usersys.redhat.com/pulp/repos/Base_Org/Library/content/dist/rhel/server/7/7.3/x86_64/kickstart/","media_path":null,"config_path":null,"image_path":null,"os_family":"Redhat"}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-29 20:58:12 UTC","id":788,"auditable_id":35,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-12-29 20:58:10 UTC","id":787,"auditable_id":35,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-12-29 20:58:09 UTC","id":786,"auditable_id":35,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-12-29 20:57:44 UTC","id":784,"auditable_id":34,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":27,"host_id":34,"uuid":"5a0e30a8-f41d-442b-a69f-5f9099b8c9ef","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":33,"host_id":34,"uuid":"5a0e30a8-f41d-442b-a69f-5f9099b8c9ef","last_checkin":"2016-12-29T20:57:26.310Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2016-12-29T20:57:27.113Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-29 16:54:34 UTC","id":782,"auditable_id":34,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-29 16:53:26 UTC","id":781,"auditable_id":34,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-29 15:15:30 UTC","id":780,"auditable_id":5,"auditable_name":"Candace ","auditable_type":"User","action":"create","audited_changes":{"login":"Meta_Knight","firstname":"Candace","lastname":"","mail":"candace@redhat.com","admin":false,"auth_source_id":1,"locale":null,"avatar_hash":null,"default_organization_id":1,"default_location_id":null,"lower_login":"meta_knight","mail_enabled":false,"timezone":""}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-28 18:46:42 UTC","id":779,"auditable_id":34,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-12-28 18:46:40 UTC","id":778,"auditable_id":34,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-12-28 18:46:39 UTC","id":777,"auditable_id":34,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-12-27 21:38:50 UTC","id":775,"auditable_id":33,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":26,"host_id":33,"uuid":"311cdabb-6583-4080-91af-e24e9bfb63a8","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":31,"host_id":33,"uuid":"311cdabb-6583-4080-91af-e24e9bfb63a8","last_checkin":"2016-12-27T21:07:06.093Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2016-12-26T18:16:07.545Z"}}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":28,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-12-27 17:40:42 UTC","id":774,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":27,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-12-27 17:13:09 UTC","id":773,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-26 18:16:20 UTC","id":772,"auditable_id":33,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-12-26 18:16:07 UTC","id":771,"auditable_id":33,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-12-26 18:16:05 UTC","id":770,"auditable_id":33,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-12-26 18:15:55 UTC","id":768,"auditable_id":32,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":25,"host_id":32,"uuid":"668fc1dc-35aa-4cb7-892f-6b13e5c149c7","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":30,"host_id":32,"uuid":"668fc1dc-35aa-4cb7-892f-6b13e5c149c7","last_checkin":"2016-12-26T18:15:15.820Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2016-12-26T18:14:50.112Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-12-26 18:14:49 UTC","id":767,"auditable_id":32,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-12-26 18:14:48 UTC","id":766,"auditable_id":32,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-12-26 18:14:08 UTC","id":764,"auditable_id":17,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":4,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":11,"host_id":17,"uuid":"d79aef59-e02b-4429-9ef0-f41af3a82044","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":15,"host_id":17,"uuid":"d79aef59-e02b-4429-9ef0-f41af3a82044","last_checkin":"2016-12-26T15:35:30.412Z","service_level":null,"release_version":"7.3","autoheal":true,"registered_at":"2016-11-08T22:21:21.581Z"}}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":"","associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-26 17:32:53 UTC","id":763,"auditable_id":215,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"booger","template":"boogerpickker","snippet":false,"template_kind_id":1,"locked":false,"default":false,"vendor":null,"os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-26 14:17:43 UTC","id":762,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 19:53:55 UTC","id":761,"auditable_id":212,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 19:53:55 UTC","id":760,"auditable_id":213,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 19:53:55 UTC","id":759,"auditable_id":211,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 19:53:55 UTC","id":758,"auditable_id":214,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":64,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 19:53:54 UTC","id":757,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 19:53:52 UTC","id":756,"auditable_id":214,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":63,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 19:53:52 UTC","id":755,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 19:53:52 UTC","id":754,"auditable_id":213,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 19:53:52 UTC","id":753,"auditable_id":212,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 19:53:52 UTC","id":752,"auditable_id":211,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:58:35 UTC","id":751,"auditable_id":208,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:58:35 UTC","id":750,"auditable_id":209,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:58:34 UTC","id":749,"auditable_id":207,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:58:34 UTC","id":748,"auditable_id":210,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":62,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:58:33 UTC","id":747,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:58:31 UTC","id":746,"auditable_id":210,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":61,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:58:30 UTC","id":745,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:58:30 UTC","id":744,"auditable_id":209,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:58:30 UTC","id":743,"auditable_id":208,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:58:30 UTC","id":742,"auditable_id":207,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:08:40 UTC","id":741,"auditable_id":204,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:08:40 UTC","id":740,"auditable_id":205,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:08:39 UTC","id":739,"auditable_id":203,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:08:39 UTC","id":738,"auditable_id":206,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":60,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:08:38 UTC","id":737,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:08:35 UTC","id":736,"auditable_id":206,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":59,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:08:35 UTC","id":735,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:08:35 UTC","id":734,"auditable_id":205,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:08:35 UTC","id":733,"auditable_id":204,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 17:08:34 UTC","id":732,"auditable_id":203,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 04:05:52 UTC","id":731,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-22 04:05:46 UTC","id":730,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-21 11:38:16 UTC","id":729,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-21 11:37:52 UTC","id":728,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":26,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-12-21 09:55:01 UTC","id":727,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":25,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-12-21 09:28:48 UTC","id":726,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-21 03:12:03 UTC","id":725,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-21 03:10:47 UTC","id":724,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.114","associated_name":null,"created_at":"2016-12-21 03:10:41 UTC","id":723,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.114","associated_name":null,"created_at":"2016-12-21 03:10:38 UTC","id":722,"auditable_id":31,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"batsquid.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.114","associated_name":null,"created_at":"2016-12-21 03:10:38 UTC","id":721,"auditable_id":33,"auditable_name":"batsquid.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"batsquid.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-20 21:00:59 UTC","id":720,"auditable_id":3,"auditable_name":"Admin User","auditable_type":"User","action":"update","audited_changes":{"timezone":[null,""]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-20 20:48:07 UTC","id":719,"auditable_id":15,"auditable_name":"Paused","auditable_type":"Bookmark","action":"create","audited_changes":{"name":"Paused","query":"state = paused","controller":"foreman_tasks_tasks","public":true,"owner_id":3,"owner_type":"User"}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-20 16:34:43 UTC","id":718,"auditable_id":200,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-20 16:34:43 UTC","id":717,"auditable_id":201,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-20 16:34:43 UTC","id":716,"auditable_id":199,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-20 16:34:43 UTC","id":715,"auditable_id":202,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":58,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-20 16:34:42 UTC","id":714,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-20 16:34:40 UTC","id":713,"auditable_id":202,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":57,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-20 16:34:40 UTC","id":712,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-20 16:34:39 UTC","id":711,"auditable_id":201,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-20 16:34:39 UTC","id":710,"auditable_id":200,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-20 16:34:39 UTC","id":709,"auditable_id":199,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2016-12-20 08:50:39 UTC","id":708,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2016-12-20 08:47:32 UTC","id":707,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2016-12-20 08:26:06 UTC","id":706,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2016-12-20 08:25:09 UTC","id":705,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:56:55 UTC","id":704,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:35:17 UTC","id":703,"auditable_id":196,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:35:17 UTC","id":702,"auditable_id":197,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:35:17 UTC","id":701,"auditable_id":195,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:35:17 UTC","id":700,"auditable_id":198,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":56,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:35:15 UTC","id":699,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:35:14 UTC","id":698,"auditable_id":198,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":55,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:35:14 UTC","id":697,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:35:13 UTC","id":696,"auditable_id":197,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:35:13 UTC","id":695,"auditable_id":196,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:35:13 UTC","id":694,"auditable_id":195,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:30:41 UTC","id":693,"auditable_id":192,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:30:41 UTC","id":692,"auditable_id":193,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:30:41 UTC","id":691,"auditable_id":191,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:30:41 UTC","id":690,"auditable_id":194,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":54,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:30:40 UTC","id":689,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:30:38 UTC","id":688,"auditable_id":194,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":53,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:30:38 UTC","id":687,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:30:38 UTC","id":686,"auditable_id":193,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:30:38 UTC","id":685,"auditable_id":192,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:30:38 UTC","id":684,"auditable_id":191,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:29:27 UTC","id":683,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:28:49 UTC","id":682,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":24,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-12-19 14:26:48 UTC","id":681,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":23,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-12-19 14:25:29 UTC","id":680,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:22:51 UTC","id":679,"auditable_id":188,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:22:51 UTC","id":678,"auditable_id":189,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:22:51 UTC","id":677,"auditable_id":187,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:22:51 UTC","id":676,"auditable_id":190,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":52,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:22:49 UTC","id":675,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:22:48 UTC","id":674,"auditable_id":190,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":51,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:22:48 UTC","id":673,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:22:47 UTC","id":672,"auditable_id":189,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:22:47 UTC","id":671,"auditable_id":188,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:22:47 UTC","id":670,"auditable_id":187,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:21:31 UTC","id":669,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:20:52 UTC","id":668,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:13:35 UTC","id":667,"auditable_id":184,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:13:34 UTC","id":666,"auditable_id":185,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:13:34 UTC","id":665,"auditable_id":183,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:13:34 UTC","id":664,"auditable_id":186,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":50,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:13:33 UTC","id":663,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:13:32 UTC","id":662,"auditable_id":186,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":49,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:13:32 UTC","id":661,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:13:31 UTC","id":660,"auditable_id":185,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:13:31 UTC","id":659,"auditable_id":184,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 14:13:31 UTC","id":658,"auditable_id":183,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-19 09:12:44 UTC","id":657,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2016-12-18 08:50:03 UTC","id":656,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2016-12-18 08:23:13 UTC","id":655,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-17 13:29:55 UTC","id":654,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":22,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-12-17 08:55:20 UTC","id":653,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2016-12-17 08:53:45 UTC","id":652,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2016-12-17 08:49:57 UTC","id":651,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":21,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-12-17 08:29:48 UTC","id":650,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2016-12-17 08:29:41 UTC","id":649,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2016-12-17 08:29:04 UTC","id":648,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2016-12-16 22:23:29 UTC","id":647,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2016-12-16 22:23:27 UTC","id":646,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"environment_id":[null,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2016-12-16 22:23:27 UTC","id":645,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"certname":[null,"joker.usersys.redhat.com"],"puppet_proxy_id":[null,4],"puppet_ca_proxy_id":[null,4]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2016-12-16 21:53:35 UTC","id":644,"auditable_id":4,"auditable_name":"joker.usersys.redhat.com","auditable_type":"SmartProxy","action":"create","audited_changes":{"name":"joker.usersys.redhat.com","url":"https://joker.usersys.redhat.com:9090","expired_logs":"0","pubkey":null}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 21:15:23 UTC","id":643,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2016-12-16 21:15:18 UTC","id":642,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2016-12-16 21:15:16 UTC","id":641,"auditable_id":30,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"joker.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.7","associated_name":null,"created_at":"2016-12-16 21:15:16 UTC","id":640,"auditable_id":32,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"joker.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":20,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-12-16 20:53:00 UTC","id":639,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":19,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-12-16 20:28:14 UTC","id":638,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.94","associated_name":null,"created_at":"2016-12-16 17:39:38 UTC","id":637,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[2,4]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 17:35:08 UTC","id":636,"auditable_id":24,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:08:32 UTC","id":635,"auditable_id":180,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:08:32 UTC","id":634,"auditable_id":181,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:08:32 UTC","id":633,"auditable_id":179,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:08:32 UTC","id":632,"auditable_id":182,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":48,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:08:31 UTC","id":631,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:08:30 UTC","id":630,"auditable_id":182,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":47,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:08:29 UTC","id":629,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:08:29 UTC","id":628,"auditable_id":181,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:08:28 UTC","id":627,"auditable_id":180,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:08:28 UTC","id":626,"auditable_id":179,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:03:49 UTC","id":625,"auditable_id":176,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:03:49 UTC","id":624,"auditable_id":177,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:03:49 UTC","id":623,"auditable_id":175,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:03:49 UTC","id":622,"auditable_id":178,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":46,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:03:48 UTC","id":621,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:03:46 UTC","id":620,"auditable_id":178,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":45,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:03:46 UTC","id":619,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:03:46 UTC","id":618,"auditable_id":177,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:03:46 UTC","id":617,"auditable_id":176,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:03:46 UTC","id":616,"auditable_id":175,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:02:38 UTC","id":615,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 15:02:05 UTC","id":614,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:56:30 UTC","id":613,"auditable_id":172,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:56:30 UTC","id":612,"auditable_id":173,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:56:30 UTC","id":611,"auditable_id":171,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:56:30 UTC","id":610,"auditable_id":174,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":44,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:56:29 UTC","id":609,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:56:28 UTC","id":608,"auditable_id":174,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":43,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:56:28 UTC","id":607,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:56:27 UTC","id":606,"auditable_id":173,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:56:27 UTC","id":605,"auditable_id":172,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:56:27 UTC","id":604,"auditable_id":171,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:53:56 UTC","id":603,"auditable_id":168,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:53:56 UTC","id":602,"auditable_id":169,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:53:56 UTC","id":601,"auditable_id":167,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:53:56 UTC","id":600,"auditable_id":170,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":42,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:53:55 UTC","id":599,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:53:52 UTC","id":598,"auditable_id":170,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":41,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:53:52 UTC","id":597,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:53:52 UTC","id":596,"auditable_id":169,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:53:52 UTC","id":595,"auditable_id":168,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-12-16 14:53:52 UTC","id":594,"auditable_id":167,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-16 14:38:27 UTC","id":593,"auditable_id":2,"auditable_name":null,"auditable_type":"SmartProxy","action":"destroy","audited_changes":{"name":"joker.usersys.redhat.com","url":"https://joker.usersys.redhat.com:9090","expired_logs":"0","pubkey":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":26,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.228","associated_name":null,"created_at":"2016-12-16 14:38:05 UTC","id":592,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"joker.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":4,"environment_id":1,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":2,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":2,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":2,"certname":"joker.usersys.redhat.com","image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":1,"host_id":2,"uuid":"3843ac4e-834e-4f30-919b-f8b12e96600e","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":1,"host_id":2,"uuid":"3843ac4e-834e-4f30-919b-f8b12e96600e","last_checkin":"2016-11-28T11:18:37.337Z","service_level":null,"release_version":"7Server","autoheal":true,"registered_at":"2016-08-13T23:00:42.422Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":24,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 22:26:04 UTC","id":591,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 22:23:00 UTC","id":590,"auditable_id":24,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 22:21:26 UTC","id":589,"auditable_id":18,"auditable_name":"drone64.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2016-11-27 21:43:16 UTC","id":588,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"environment_id":[null,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2016-11-27 21:43:16 UTC","id":587,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"certname":[null,"riddler.usersys.redhat.com"],"puppet_proxy_id":[null,3],"puppet_ca_proxy_id":[null,3]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2016-11-27 21:13:39 UTC","id":586,"auditable_id":3,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"SmartProxy","action":"create","audited_changes":{"name":"riddler.usersys.redhat.com","url":"https://riddler.usersys.redhat.com:9090","expired_logs":"0","pubkey":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 20:28:20 UTC","id":585,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 20:27:08 UTC","id":584,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2016-11-27 20:27:05 UTC","id":583,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2016-11-27 20:27:04 UTC","id":582,"auditable_id":29,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"riddler.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.33","associated_name":null,"created_at":"2016-11-27 20:27:04 UTC","id":581,"auditable_id":31,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"riddler.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.172","associated_name":null,"created_at":"2016-11-27 20:15:55 UTC","id":580,"auditable_id":28,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"riddler.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":3,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":21,"host_id":28,"uuid":"2ab761a0-e3a1-4de9-9d46-20db62012147","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":26,"host_id":28,"uuid":"2ab761a0-e3a1-4de9-9d46-20db62012147","last_checkin":"2016-11-27T20:04:26.180Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2016-11-27T20:04:27.870Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 20:04:31 UTC","id":579,"auditable_id":28,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.219","associated_name":null,"created_at":"2016-11-27 20:04:27 UTC","id":578,"auditable_id":28,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.219","associated_name":null,"created_at":"2016-11-27 20:04:26 UTC","id":577,"auditable_id":28,"auditable_name":"riddler.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"riddler.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 19:59:27 UTC","id":575,"auditable_id":27,"auditable_name":"camworkstation.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 19:49:58 UTC","id":574,"auditable_id":27,"auditable_name":"camworkstation.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.173","associated_name":null,"created_at":"2016-11-27 19:49:56 UTC","id":573,"auditable_id":27,"auditable_name":"camworkstation.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,8]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.173","associated_name":null,"created_at":"2016-11-27 19:49:55 UTC","id":572,"auditable_id":27,"auditable_name":"camworkstation.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"camworkstation.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.173","associated_name":null,"created_at":"2016-11-27 19:49:55 UTC","id":571,"auditable_id":29,"auditable_name":"camworkstation.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"camworkstation.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 19:36:09 UTC","id":570,"auditable_id":26,"auditable_name":"puppet.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 19:35:31 UTC","id":569,"auditable_id":26,"auditable_name":"puppet.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 19:34:54 UTC","id":568,"auditable_id":26,"auditable_name":"puppet.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.156","associated_name":null,"created_at":"2016-11-27 19:34:51 UTC","id":567,"auditable_id":26,"auditable_name":"puppet.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.156","associated_name":null,"created_at":"2016-11-27 19:34:49 UTC","id":566,"auditable_id":26,"auditable_name":"puppet.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"puppet.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.156","associated_name":null,"created_at":"2016-11-27 19:34:49 UTC","id":565,"auditable_id":28,"auditable_name":"puppet.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"puppet.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-11-27 19:25:40 UTC","id":564,"auditable_id":25,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2],"environment_id":[null,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-11-27 19:25:38 UTC","id":563,"auditable_id":25,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"hotbox1.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":null,"owner_type":null,"enabled":true,"puppet_ca_proxy_id":1,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":1,"certname":"hotbox1.usersys.redhat.com","image_id":null,"organization_id":null,"location_id":null,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.13","associated_name":null,"created_at":"2016-11-27 19:23:23 UTC","id":562,"auditable_id":8,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"hotbox1.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":2,"environment_id":2,"ptable_id":null,"medium_id":null,"build":false,"comment":"","disk":null,"installed_at":null,"model_id":1,"hostgroup_id":1,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":1,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":1,"certname":"hotbox1.usersys.redhat.com","image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":1,"grub_pass":"","content_view_id":2,"lifecycle_environment_id":1,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":5,"host_id":8,"uuid":"6191f2ab-5212-4885-9190-6f8ce605c286","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":23,"host_id":8,"uuid":"6191f2ab-5212-4885-9190-6f8ce605c286","last_checkin":"2016-11-27T19:20:06.204Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2016-11-27T18:54:03.355Z"}}},{"user_id":3,"user_type":null,"user_name":"admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.172","associated_name":null,"created_at":"2016-11-27 18:51:19 UTC","id":558,"auditable_id":28,"auditable_name":"force_post_sync_actions","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 18:46:29 UTC","id":556,"auditable_id":24,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 18:45:43 UTC","id":555,"auditable_id":24,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.126","associated_name":null,"created_at":"2016-11-27 18:45:40 UTC","id":554,"auditable_id":24,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"operatingsystem_id":[null,11]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.126","associated_name":null,"created_at":"2016-11-27 18:45:40 UTC","id":553,"auditable_id":11,"auditable_name":"RedHat 5.11","auditable_type":"Operatingsystem","action":"create","audited_changes":{"major":"5","name":"RedHat","minor":"11","nameindicator":null,"release_name":null,"description":null,"password_hash":"SHA256","title":"RedHat 5.11"}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.126","associated_name":null,"created_at":"2016-11-27 18:45:39 UTC","id":552,"auditable_id":24,"auditable_name":"drone511.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone511.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 17:49:03 UTC","id":550,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 17:47:05 UTC","id":549,"auditable_id":22,"auditable_name":"drone71.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.172","associated_name":null,"created_at":"2016-11-27 17:43:46 UTC","id":548,"auditable_id":28,"auditable_name":"force_post_sync_actions","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 16:33:57 UTC","id":547,"auditable_id":22,"auditable_name":"drone71.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 16:32:48 UTC","id":546,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 16:32:32 UTC","id":545,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.81","associated_name":null,"created_at":"2016-11-27 16:32:31 UTC","id":544,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,10]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.81","associated_name":null,"created_at":"2016-11-27 16:32:31 UTC","id":543,"auditable_id":10,"auditable_name":"RedHat 7.0","auditable_type":"Operatingsystem","action":"create","audited_changes":{"major":"7","name":"RedHat","minor":"0","nameindicator":null,"release_name":null,"description":null,"password_hash":"SHA256","title":"RedHat 7.0"}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.81","associated_name":null,"created_at":"2016-11-27 16:32:30 UTC","id":542,"auditable_id":23,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone70.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.81","associated_name":null,"created_at":"2016-11-27 16:32:30 UTC","id":541,"auditable_id":25,"auditable_name":"drone70.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"drone70.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 16:32:21 UTC","id":540,"auditable_id":22,"auditable_name":"drone71.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.38","associated_name":null,"created_at":"2016-11-27 16:32:19 UTC","id":539,"auditable_id":22,"auditable_name":"drone71.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,9]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.38","associated_name":null,"created_at":"2016-11-27 16:32:19 UTC","id":538,"auditable_id":9,"auditable_name":"RedHat 7.1","auditable_type":"Operatingsystem","action":"create","audited_changes":{"major":"7","name":"RedHat","minor":"1","nameindicator":null,"release_name":null,"description":null,"password_hash":"SHA256","title":"RedHat 7.1"}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.38","associated_name":null,"created_at":"2016-11-27 16:32:18 UTC","id":537,"auditable_id":22,"auditable_name":"drone71.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone71.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.38","associated_name":null,"created_at":"2016-11-27 16:32:18 UTC","id":536,"auditable_id":24,"auditable_name":"drone71.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"drone71.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 15:52:19 UTC","id":535,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 15:51:51 UTC","id":534,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 15:51:22 UTC","id":533,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 15:49:47 UTC","id":532,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.203","associated_name":null,"created_at":"2016-11-27 15:49:32 UTC","id":531,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,8]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.203","associated_name":null,"created_at":"2016-11-27 15:49:32 UTC","id":530,"auditable_id":8,"auditable_name":"RedHat 6.7","auditable_type":"Operatingsystem","action":"create","audited_changes":{"major":"6","name":"RedHat","minor":"7","nameindicator":null,"release_name":null,"description":null,"password_hash":"SHA256","title":"RedHat 6.7"}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.203","associated_name":null,"created_at":"2016-11-27 15:49:31 UTC","id":529,"auditable_id":21,"auditable_name":"drone67.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone67.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 15:49:29 UTC","id":527,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.120","associated_name":null,"created_at":"2016-11-27 15:49:24 UTC","id":526,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,7]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.120","associated_name":null,"created_at":"2016-11-27 15:49:24 UTC","id":525,"auditable_id":7,"auditable_name":"RedHat 6.6","auditable_type":"Operatingsystem","action":"create","audited_changes":{"major":"6","name":"RedHat","minor":"6","nameindicator":null,"release_name":null,"description":null,"password_hash":"SHA256","title":"RedHat 6.6"}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.120","associated_name":null,"created_at":"2016-11-27 15:49:23 UTC","id":524,"auditable_id":20,"auditable_name":"drone66.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone66.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 15:49:20 UTC","id":522,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.60","associated_name":null,"created_at":"2016-11-27 15:49:14 UTC","id":521,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,6]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.60","associated_name":null,"created_at":"2016-11-27 15:49:14 UTC","id":520,"auditable_id":6,"auditable_name":"RedHat 6.5","auditable_type":"Operatingsystem","action":"create","audited_changes":{"major":"6","name":"RedHat","minor":"5","nameindicator":null,"release_name":null,"description":null,"password_hash":"SHA256","title":"RedHat 6.5"}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.60","associated_name":null,"created_at":"2016-11-27 15:49:12 UTC","id":519,"auditable_id":19,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone65.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.60","associated_name":null,"created_at":"2016-11-27 15:49:12 UTC","id":518,"auditable_id":21,"auditable_name":"drone65.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"drone65.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.172","associated_name":null,"created_at":"2016-11-27 15:30:14 UTC","id":517,"auditable_id":16,"auditable_name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","auditable_type":"Host","action":"destroy","audited_changes":{"name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"subscription_facet_attributes":{"id":13,"host_id":16,"uuid":"7fba86c3-1c5e-45f3-8562-79f2f62f9f91","last_checkin":null,"service_level":null,"release_version":null,"autoheal":true,"registered_at":"2016-10-09T13:44:16.576Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":23,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 15:28:11 UTC","id":516,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":22,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 15:27:51 UTC","id":515,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 15:27:01 UTC","id":514,"auditable_id":18,"auditable_name":"drone64.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 15:24:16 UTC","id":513,"auditable_id":18,"auditable_name":"drone64.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 15:22:21 UTC","id":512,"auditable_id":18,"auditable_name":"drone64.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-27 15:19:14 UTC","id":511,"auditable_id":18,"auditable_name":"drone64.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.31","associated_name":null,"created_at":"2016-11-27 15:19:10 UTC","id":510,"auditable_id":18,"auditable_name":"drone64.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,5]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.31","associated_name":null,"created_at":"2016-11-27 15:19:10 UTC","id":509,"auditable_id":5,"auditable_name":"RedHat 6.4","auditable_type":"Operatingsystem","action":"create","audited_changes":{"major":"6","name":"RedHat","minor":"4","nameindicator":null,"release_name":null,"description":null,"password_hash":"SHA256","title":"RedHat 6.4"}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.31","associated_name":null,"created_at":"2016-11-27 15:19:09 UTC","id":508,"auditable_id":18,"auditable_name":"drone64.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone64.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":null,"user_type":null,"user_name":null,"version":25,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-22 08:19:46 UTC","id":506,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-11-21 19:23:54 UTC","id":505,"auditable_id":28,"auditable_name":"force_post_sync_actions","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":24,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 19:19:21 UTC","id":504,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:45:35 UTC","id":503,"auditable_id":164,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:45:35 UTC","id":502,"auditable_id":165,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:45:35 UTC","id":501,"auditable_id":163,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:45:35 UTC","id":500,"auditable_id":166,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":40,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:45:35 UTC","id":499,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:45:34 UTC","id":498,"auditable_id":166,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":39,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:45:34 UTC","id":497,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:45:33 UTC","id":496,"auditable_id":165,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:45:33 UTC","id":495,"auditable_id":164,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:45:33 UTC","id":494,"auditable_id":163,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:41:20 UTC","id":493,"auditable_id":160,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:41:20 UTC","id":492,"auditable_id":161,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:41:20 UTC","id":491,"auditable_id":159,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:41:20 UTC","id":490,"auditable_id":162,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":38,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:41:19 UTC","id":489,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:41:18 UTC","id":488,"auditable_id":162,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":37,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:41:18 UTC","id":487,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:41:17 UTC","id":486,"auditable_id":161,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:41:17 UTC","id":485,"auditable_id":160,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:41:17 UTC","id":484,"auditable_id":159,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:40:11 UTC","id":483,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-21 15:39:39 UTC","id":482,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":18,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-11-21 15:25:31 UTC","id":481,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[2,4]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":23,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.202","associated_name":null,"created_at":"2016-11-21 15:17:00 UTC","id":480,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"operatingsystem_id":[2,4]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-08 22:22:31 UTC","id":479,"auditable_id":17,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-08 22:22:10 UTC","id":478,"auditable_id":17,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-08 08:37:39 UTC","id":476,"auditable_id":17,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-08 08:37:37 UTC","id":475,"auditable_id":17,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":21,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-08 01:24:11 UTC","id":474,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-07 23:47:30 UTC","id":473,"auditable_id":17,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-07 23:46:24 UTC","id":472,"auditable_id":17,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-07 23:46:12 UTC","id":471,"auditable_id":17,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-07 23:44:11 UTC","id":470,"auditable_id":17,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-07 23:43:09 UTC","id":469,"auditable_id":17,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-11-07 23:43:06 UTC","id":468,"auditable_id":17,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,4]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-11-07 23:43:06 UTC","id":467,"auditable_id":4,"auditable_name":"RedHat 7.3","auditable_type":"Operatingsystem","action":"create","audited_changes":{"major":"7","name":"RedHat","minor":"3","nameindicator":null,"release_name":null,"description":null,"password_hash":"SHA256","title":"RedHat 7.3"}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.103","associated_name":null,"created_at":"2016-11-07 23:43:05 UTC","id":466,"auditable_id":17,"auditable_name":"drone73.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone73.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":17,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-07 17:32:47 UTC","id":464,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-07 17:31:37 UTC","id":463,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.88","associated_name":null,"created_at":"2016-11-03 22:22:34 UTC","id":462,"auditable_id":1,"auditable_name":"SatelliteInstallTest","auditable_type":"Image","action":"create","audited_changes":{"operatingsystem_id":2,"compute_resource_id":1,"architecture_id":1,"uuid":"/var/lib/libvirt/images/rhel-server-7.2-x86_64-dvd.iso?_auth_=1463755491_d56655d965d8c6348f4307e0e39ff492","username":"root","name":"SatelliteInstallTest","iam_role":null,"user_data":false,"password":"redhat"}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.88","associated_name":null,"created_at":"2016-11-03 22:18:36 UTC","id":461,"auditable_id":1,"auditable_name":"battalionbox.usersys.redhat.com (Libvirt)","auditable_type":"ComputeResource","action":"create","audited_changes":{"name":"battalionbox.usersys.redhat.com","description":"","url":"qemu+tcp://10.13.153.94/system","user":null,"uuid":"7A2906DC-91F0-E111-A8BD-CC52AF3EEB50","email":null}},{"user_id":null,"user_type":null,"user_name":null,"version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-03 08:40:05 UTC","id":460,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":20,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-03 08:40:04 UTC","id":459,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":22,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-11-03 08:40:03 UTC","id":458,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":21,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.202","associated_name":null,"created_at":"2016-11-02 15:23:15 UTC","id":457,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":20,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.202","associated_name":null,"created_at":"2016-11-02 14:53:15 UTC","id":456,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":19,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 15:53:26 UTC","id":455,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:12:06 UTC","id":454,"auditable_id":156,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:12:06 UTC","id":453,"auditable_id":157,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:12:06 UTC","id":452,"auditable_id":155,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:12:06 UTC","id":451,"auditable_id":158,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":36,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:12:05 UTC","id":450,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:12:04 UTC","id":449,"auditable_id":158,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":35,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:12:04 UTC","id":448,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:12:04 UTC","id":447,"auditable_id":157,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:12:04 UTC","id":446,"auditable_id":156,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:12:04 UTC","id":445,"auditable_id":155,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:07:50 UTC","id":444,"auditable_id":152,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:07:50 UTC","id":443,"auditable_id":153,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:07:50 UTC","id":442,"auditable_id":151,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:07:50 UTC","id":441,"auditable_id":154,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":34,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:07:49 UTC","id":440,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:07:48 UTC","id":439,"auditable_id":154,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":33,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:07:48 UTC","id":438,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:07:48 UTC","id":437,"auditable_id":153,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:07:48 UTC","id":436,"auditable_id":152,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:07:48 UTC","id":435,"auditable_id":151,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:06:47 UTC","id":434,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 13:06:17 UTC","id":433,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":17,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-10-26 13:04:22 UTC","id":432,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-10-26 12:59:53 UTC","id":431,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 12:57:28 UTC","id":430,"auditable_id":148,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 12:57:28 UTC","id":429,"auditable_id":149,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 12:57:28 UTC","id":428,"auditable_id":147,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 12:57:28 UTC","id":427,"auditable_id":150,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":32,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 12:57:27 UTC","id":426,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 12:57:27 UTC","id":425,"auditable_id":74,"auditable_name":"Satellite Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<%#\nkind: user_data\nname: Satellite Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'Red Hat Identity Management' -%>\n<%= indent 4 do\n      snippet 'idm_register'\n    end %>\n<% end -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n<%\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n","<%#\nkind: user_data\nname: Satellite Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'Red Hat Identity Management' -%>\n<%= indent 4 do\n      snippet 'idm_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n"]}},{"user_id":null,"user_type":null,"user_name":null,"version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 12:56:18 UTC","id":424,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 12:55:47 UTC","id":423,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 12:50:56 UTC","id":422,"auditable_id":150,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":31,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 12:50:56 UTC","id":421,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 12:50:55 UTC","id":420,"auditable_id":149,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 12:50:55 UTC","id":419,"auditable_id":148,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 12:50:55 UTC","id":418,"auditable_id":147,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":19,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-26 12:43:27 UTC","id":417,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":18,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-25 16:51:19 UTC","id":416,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-25 16:47:58 UTC","id":415,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-25 15:55:22 UTC","id":414,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":18,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-25 15:49:05 UTC","id":413,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-24 22:23:11 UTC","id":412,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-24 22:21:16 UTC","id":411,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-24 22:20:11 UTC","id":410,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-24 22:14:23 UTC","id":409,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-24 14:45:23 UTC","id":408,"auditable_id":22,"auditable_name":"mail","auditable_type":"Role","action":"create","audited_changes":{"name":"mail","builtin":0,"permissions":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-24 14:37:04 UTC","id":407,"auditable_id":4,"auditable_name":"Taft Sanders","auditable_type":"User","action":"create","audited_changes":{"login":"test","firstname":"Taft","lastname":"Sanders","mail":"Tasander@redhat.com","admin":false,"auth_source_id":1,"locale":null,"avatar_hash":null,"default_organization_id":1,"default_location_id":2,"lower_login":"test","mail_enabled":true,"timezone":"America/New_York"}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-19 20:56:40 UTC","id":406,"auditable_id":6,"auditable_name":"Juicy Fruit","auditable_type":"Organization","action":"create","audited_changes":{"name":"Juicy Fruit","ignore_types":[],"description":"","label":"Juicy_Fruit","ancestry":null,"katello_default":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-19 20:56:04 UTC","id":405,"auditable_id":5,"auditable_name":"Big Red","auditable_type":"Organization","action":"create","audited_changes":{"name":"Big Red","ignore_types":[],"description":"","label":"Big_Red","ancestry":null,"katello_default":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-19 13:16:14 UTC","id":404,"auditable_id":35,"auditable_name":"unregister_delete_host","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":"","associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-18 16:27:47 UTC","id":403,"auditable_id":1,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<%#\nkind: PXELinux\nname: PXELinux global default\n%>\n\n<%# This template has special name (do not change it) and it is used for booting unknown hosts. %>\n\nDEFAULT menu\nPROMPT 0\nMENU TITLE PXE Menu\nTIMEOUT 200\nTOTALTIMEOUT 6000\nONTIMEOUT local\n\nLABEL local\n     MENU LABEL (local)\n     MENU DEFAULT\n     LOCALBOOT 0\n\nLABEL discovery\n     MENU LABEL (discovery)\n     KERNEL boot/fdi-image-rhel_7-vmlinuz\n     APPEND initrd=boot/fdi-image-rhel_7-img rootflags=loop root=live:/fdi.iso rootfstype=auto ro rd.live.image acpi=force rd.luks=0 rd.md=0 rd.dm=0 rd.lvm=0 rd.bootif=0 rd.neednet=0 nomodeset proxy.url=https://SATELLITE_CAPSULE_URL:9090 proxy.type=proxy\n     IPAPPEND 2\n\n<% for profile in @profiles -%>\nLABEL <%= \"#{profile[:template]} - #{profile[:hostgroup]}\" %>\n     KERNEL <%= profile[:hostgroup].operatingsystem.kernel(profile[:hostgroup].architecture) %>\n<% case profile[:hostgroup].operatingsystem.pxe_type -%>\n<% when 'kickstart' -%>\n     APPEND initrd=<%= profile[:hostgroup].operatingsystem.initrd(profile[:hostgroup].architecture) %> ks=<%= default_template_url(profile[:template], profile[:hostgroup]) %> ksdevice=bootif network kssendmac\n<% when 'preseed' -%>\n     APPEND initrd=<%= profile[:hostgroup].operatingsystem.initrd(profile[:hostgroup].architecture) %> interface=auto url=<%= default_template_url(profile[:template], profile[:hostgroup]) %> ramdisk_size=10800 root=/dev/rd/0 rw auto hostname=unassigned-hostname locale=<%= profile[:hostgroup].params['lang'] || 'en_US' %> console-setup/ask_detect=false console-setup/layout=USA console-setup/variant=USA\n<% end -%>\n\n<% end -%>\n","<%#\nkind: PXELinux\nname: PXELinux global default\n%>\n\n<%# This template has special name (do not change it) and it is used for booting unknown hosts. %>\n\nDEFAULT menu\nPROMPT 0\nMENU TITLE PXE Menu\nTIMEOUT 200\nTOTALTIMEOUT 6000\nONTIMEOUT local\n\nLABEL local\n     MENU LABEL (local)\n     MENU DEFAULT\n     LOCALBOOT 0\n\nLABEL discovery\n     MENU LABEL (discovery)\n     KERNEL boot/fdi-image-rhel_7-vmlinuz\n     APPEND initrd=boot/fdi-image-rhel_7-img rootflags=loop root=live:/fdi.iso rootfstype=auto ro rd.live.image acpi=force rd.luks=0 rd.md=0 rd.dm=0 rd.lvm=0 rd.bootif=0 rd.neednet=0 nomodeset proxy.url=https://SATELLITE_CAPSULE_URL:9090 proxy.type=proxy\n     IPAPPEND 2\n\n<% for profile in @profiles -%>\nLABEL <%= \"#{profile[:template]} - #{profile[:hostgroup]}\" %>\n     KERNEL <%= profile[:hostgroup].operatingsystem.kernel(profile[:hostgroup].architecture) %>\n<% case profile[:hostgroup].operatingsystem.pxe_type -%>\n<% when 'kickstart' -%>\n     APPEND initrd=<%= profile[:hostgroup].operatingsystem.initrd(profile[:hostgroup].architecture) %> ks=<%= default_template_url(profile[:template], profile[:hostgroup]) %> ksdevice=bootif network kssendmac\n<% when 'preseed' -%>\n     APPEND initrd=<%= profile[:hostgroup].operatingsystem.initrd(profile[:hostgroup].architecture) %> interface=auto url=<%= default_template_url(profile[:template], profile[:hostgroup]) %> ramdisk_size=10800 root=/dev/rd/0 rw auto hostname=unassigned-hostname locale=<%= profile[:hostgroup].params['lang'] || 'en_US' %> console-setup/ask_detect=false console-setup/layout=USA console-setup/variant=USA\n<% end -%>\n\n<% end -%>\n"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":"","associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-18 16:27:44 UTC","id":402,"auditable_id":48,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<%#\nkind: snippet\nname: kickstart_networking_setup\ndescription: this will configure your host networking, it configures your primary interface as well\n    as other configures NICs. It supports physical, VLAN and Alias interfaces. It's intended to be\n    called from %post in your kickstart template. Note that this snippet can be used with Foreman 1.7\n    and later\n%>\n<% subnet = @host.subnet -%>\n<% dhcp = subnet.dhcp_boot_mode? -%>\n\n<% if @host.respond_to?(:has_primary_interface?) %>\n<%# Foreman 1.7 - primary interface contained in @host %>\n# primary interface\nreal=`ip -o link | grep <%= @host.mac -%> | awk '{print $2;}' | sed s/://`\n<% if @host.has_primary_interface? %>\ncat << EOF > /etc/sysconfig/network-scripts/ifcfg-$real\nBOOTPROTO=\"<%= dhcp ? 'dhcp' : 'none' -%>\"\n<% unless dhcp -%>\nIPADDR=\"<%= @host.ip -%>\"\nNETMASK=\"<%= subnet.mask -%>\"\n<% if !subnet.gateway.nil? && !subnet.gateway.empty? -%>\nGATEWAY=\"<%= subnet.gateway %>\"\n<% end -%>\n<% end -%>\nDEVICE=$real\nHWADDR=\"<%= @host.mac -%>\"\nONBOOT=yes\nEOF\n<% end -%>\n<% end -%>\n\n<% bonded_interfaces = [] %>\n<% bonds = @host.bond_interfaces %>\n<% bonds.each do |bond| %>\n<% subnet = bond.subnet -%>\n<% dhcp = subnet.nil? ? false : subnet.dhcp_boot_mode? -%>\n# <%= bond.identifier %> interface\nreal=\"<%= bond.identifier -%>\"\ncat << EOF > /etc/sysconfig/network-scripts/ifcfg-$real\nBOOTPROTO=\"<%= dhcp ? 'dhcp' : 'none' -%>\"\n<% unless dhcp || subnet.nil? -%>\nIPADDR=\"<%= bond.ip -%>\"\nNETMASK=\"<%= subnet.mask -%>\"\n<% if !subnet.gateway.nil? && !subnet.gateway.empty? -%>\nGATEWAY=\"<%= subnet.gateway %>\"\n<% end -%>\n<% end -%>\nDEVICE=$real\nONBOOT=yes\nPEERDNS=no\nPEERROUTES=no\nDEFROUTE=\"<%= bond.primary ? 'yes' : 'no' -%>\"\nTYPE=Bond\nBONDING_OPTS=\"<%= bond.bond_options -%> mode=<%= bond.mode -%>\"\nBONDING_MASTER=yes\nNM_CONTROLLED=no\nEOF\n\n<% @host.interfaces_with_identifier(bond.attached_devices_identifiers).each do |interface| -%>\n<% next if !interface.managed? -%>\n\n<% subnet = interface.subnet -%>\n<% virtual = interface.virtual? -%>\n<% vlan = virtual && (subnet.has_vlanid? || interface.vlanid.present?) -%>\n<% alias_type = virtual && !subnet.nil? && !subnet.has_vlanid? && interface.identifier.include?(':') -%>\n<% dhcp = !subnet.nil? && subnet.dhcp_boot_mode? -%>\n\n# <%= interface.identifier %> interface\nreal=`ip -o link | grep <%= interface.inheriting_mac -%> | awk '{print $2;}' | sed s/:$//`\n<% if virtual -%>\nreal=`echo <%= interface.identifier -%> | sed s/<%= interface.attached_to -%>/$real/`\n<% end -%>\n\n# ifcfg files are ignored by NM if their name contains colons so we convert colons to underscore\n<% if alias_type -%>\nsanitized_real=`echo $real | sed s/:/_/`\n<% else -%>\nsanitized_real=$real\n<% end -%>\n\ncat << EOF > /etc/sysconfig/network-scripts/ifcfg-$sanitized_real\nBOOTPROTO=\"none\"\nDEVICE=$real\n<% unless virtual -%>\nHWADDR=\"<%= interface.mac -%>\"\n<% end -%>\nONBOOT=yes\nPEERDNS=no\nPEERROUTES=no\n<% if vlan -%>\nVLAN=yes\n<% elsif alias_type -%>\nTYPE=Alias\n<% end -%>\nNM_CONTROLLED=no\nMASTER=<%= bond.identifier %>\nSLAVE=yes\nEOF\n\n<% bonded_interfaces.push(interface.identifier) -%>\n<% end %>\n<% end %>\n\n<% @host.managed_interfaces.each do |interface| %>\n<% next if !interface.managed? || interface.subnet.nil? -%>\n<% next if bonded_interfaces.include?(interface.identifier) -%>\n\n<% subnet = interface.subnet -%>\n<% virtual = interface.virtual? -%>\n<% vlan = virtual && (subnet.has_vlanid? || interface.vlanid.present?) -%>\n<% alias_type = virtual && !subnet.has_vlanid? && interface.identifier.include?(':') -%>\n<% dhcp = subnet.dhcp_boot_mode? -%>\n\n# <%= interface.identifier %> interface\nreal=`ip -o link | grep <%= interface.inheriting_mac -%> | awk '{print $2;}' | sed s/:$//`\n<% if virtual -%>\n  real=`echo <%= interface.identifier -%> | sed s/<%= interface.attached_to -%>/$real/`\n<% end -%>\n\n# ifcfg files are ignored by NM if their name contains colons so we convert colons to underscore\n<% if alias_type -%>\nsanitized_real=`echo $real | sed s/:/_/`\n<% else -%>\nsanitized_real=$real\n<% end -%>\n\ncat << EOF > /etc/sysconfig/network-scripts/ifcfg-$sanitized_real\nBOOTPROTO=\"<%= dhcp ? 'dhcp' : 'none' -%>\"\n<% unless dhcp -%>\nIPADDR=\"<%= interface.ip -%>\"\nNETMASK=\"<%= subnet.mask -%>\"\n<% if !subnet.gateway.nil? && !subnet.gateway.empty? -%>\nGATEWAY=\"<%= subnet.gateway %>\"\n<% end -%>\n<% end -%>\nDEVICE=$real\n<% unless virtual -%>\nHWADDR=\"<%= interface.mac -%>\"\n<% end -%>\nONBOOT=yes\n<% if interface.respond_to?(:primary) && interface.primary -%>\nPEERDNS=yes\nPEERROUTES=yes\n<% if !dhcp && !subnet.dns_primary.nil? && !subnet.dns_primary.empty? -%>\nDNS1=<%= subnet.dns_primary %>\n<% if !subnet.dns_secondary.nil? && !subnet.dns_secondary.empty? -%>\nDNS2=<%= subnet.dns_secondary %>\n<% end -%>\n<% end -%>\n<% else -%>\nPEERDNS=no\nPEERROUTES=no\n<% end -%>\n<% if vlan -%>\nVLAN=yes\n<% elsif alias_type -%>\nTYPE=Alias\n<% end -%>\nEOF\n\n<% end %>\n","<%#\nkind: snippet\nname: kickstart_networking_setup\ndescription: this will configure your host networking, it configures your primary interface as well\n    as other configures NICs. It supports physical, VLAN and Alias interfaces. It's intended to be\n    called from %post in your kickstart template. Note that this snippet can be used with Foreman 1.7\n    and later\n%>\n<% subnet = @host.subnet -%>\n<% dhcp = subnet.dhcp_boot_mode? -%>\n\n<% if @host.respond_to?(:has_primary_interface?) %>\n<%# Foreman 1.7 - primary interface contained in @host %>\n# primary interface\nreal=`ip -o link | grep <%= @host.mac -%> | awk '{print $2;}' | sed s/://`\n<% if @host.has_primary_interface? %>\ncat << EOF > /etc/sysconfig/network-scripts/ifcfg-$real\nBOOTPROTO=\"<%= dhcp ? 'dhcp' : 'none' -%>\"\n<% unless dhcp -%>\nIPADDR=\"<%= @host.ip -%>\"\nNETMASK=\"<%= subnet.mask -%>\"\n<% if !subnet.gateway.nil? && !subnet.gateway.empty? -%>\nGATEWAY=\"<%= subnet.gateway %>\"\n<% end -%>\n<% end -%>\nDEVICE=$real\nHWADDR=\"<%= @host.mac -%>\"\nONBOOT=yes\nEOF\n<% end -%>\n<% end -%>\n\n<% bonded_interfaces = [] %>\n<% bonds = @host.bond_interfaces %>\n<% bonds.each do |bond| %>\n<% subnet = bond.subnet -%>\n<% dhcp = subnet.nil? ? false : subnet.dhcp_boot_mode? -%>\n# <%= bond.identifier %> interface\nreal=\"<%= bond.identifier -%>\"\ncat << EOF > /etc/sysconfig/network-scripts/ifcfg-$real\nBOOTPROTO=\"<%= dhcp ? 'dhcp' : 'none' -%>\"\n<% unless dhcp || subnet.nil? -%>\nIPADDR=\"<%= bond.ip -%>\"\nNETMASK=\"<%= subnet.mask -%>\"\n<% if !subnet.gateway.nil? && !subnet.gateway.empty? -%>\nGATEWAY=\"<%= subnet.gateway %>\"\n<% end -%>\n<% end -%>\nDEVICE=$real\nONBOOT=yes\nPEERDNS=no\nPEERROUTES=no\nDEFROUTE=\"<%= bond.primary ? 'yes' : 'no' -%>\"\nTYPE=Bond\nBONDING_OPTS=\"<%= bond.bond_options -%> mode=<%= bond.mode -%>\"\nBONDING_MASTER=yes\nNM_CONTROLLED=no\nEOF\n\n<% @host.interfaces_with_identifier(bond.attached_devices_identifiers).each do |interface| -%>\n<% next if !interface.managed? -%>\n\n<% subnet = interface.subnet -%>\n<% virtual = interface.virtual? -%>\n<% vlan = virtual && (subnet.has_vlanid? || interface.vlanid.present?) -%>\n<% alias_type = virtual && !subnet.nil? && !subnet.has_vlanid? && interface.identifier.include?(':') -%>\n<% dhcp = !subnet.nil? && subnet.dhcp_boot_mode? -%>\n\n# <%= interface.identifier %> interface\nreal=`ip -o link | grep <%= interface.inheriting_mac -%> | awk '{print $2;}' | sed s/:$//`\n<% if virtual -%>\nreal=`echo <%= interface.identifier -%> | sed s/<%= interface.attached_to -%>/$real/`\n<% end -%>\n\n# ifcfg files are ignored by NM if their name contains colons so we convert colons to underscore\n<% if alias_type -%>\nsanitized_real=`echo $real | sed s/:/_/`\n<% else -%>\nsanitized_real=$real\n<% end -%>\n\ncat << EOF > /etc/sysconfig/network-scripts/ifcfg-$sanitized_real\nBOOTPROTO=\"none\"\nDEVICE=$real\n<% unless virtual -%>\nHWADDR=\"<%= interface.mac -%>\"\n<% end -%>\nONBOOT=yes\nPEERDNS=no\nPEERROUTES=no\n<% if vlan -%>\nVLAN=yes\n<% elsif alias_type -%>\nTYPE=Alias\n<% end -%>\nNM_CONTROLLED=no\nMASTER=<%= bond.identifier %>\nSLAVE=yes\nEOF\n\n<% bonded_interfaces.push(interface.identifier) -%>\n<% end %>\n<% end %>\n\n<% @host.managed_interfaces.each do |interface| %>\n<% next if !interface.managed? || interface.subnet.nil? -%>\n<% next if bonded_interfaces.include?(interface.identifier) -%>\n\n<% subnet = interface.subnet -%>\n<% virtual = interface.virtual? -%>\n<% vlan = virtual && (subnet.has_vlanid? || interface.vlanid.present?) -%>\n<% alias_type = virtual && !subnet.has_vlanid? && interface.identifier.include?(':') -%>\n<% dhcp = subnet.dhcp_boot_mode? -%>\n\n# <%= interface.identifier %> interface\nreal=`ip -o link | grep <%= interface.inheriting_mac -%> | awk '{print $2;}' | sed s/:$//`\n<% if virtual -%>\n  real=`echo <%= interface.identifier -%> | sed s/<%= interface.attached_to -%>/$real/`\n<% end -%>\n\n# ifcfg files are ignored by NM if their name contains colons so we convert colons to underscore\n<% if alias_type -%>\nsanitized_real=`echo $real | sed s/:/_/`\n<% else -%>\nsanitized_real=$real\n<% end -%>\n\ncat << EOF > /etc/sysconfig/network-scripts/ifcfg-$sanitized_real\nBOOTPROTO=\"<%= dhcp ? 'dhcp' : 'none' -%>\"\n<% unless dhcp -%>\nIPADDR=\"<%= interface.ip -%>\"\nNETMASK=\"<%= subnet.mask -%>\"\n<% if !subnet.gateway.nil? && !subnet.gateway.empty? -%>\nGATEWAY=\"<%= subnet.gateway %>\"\n<% end -%>\n<% end -%>\nDEVICE=$real\n<% unless virtual -%>\nHWADDR=\"<%= interface.mac -%>\"\n<% end -%>\nONBOOT=yes\n<% if interface.respond_to?(:primary) && interface.primary -%>\nPEERDNS=yes\nPEERROUTES=yes\n<% if !dhcp && !subnet.dns_primary.nil? && !subnet.dns_primary.empty? -%>\nDNS1=<%= subnet.dns_primary %>\n<% if !subnet.dns_secondary.nil? && !subnet.dns_secondary.empty? -%>\nDNS2=<%= subnet.dns_secondary %>\n<% end -%>\n<% end -%>\n<% else -%>\nPEERDNS=no\nPEERROUTES=no\n<% end -%>\n<% if vlan -%>\nVLAN=yes\n<% elsif alias_type -%>\nTYPE=Alias\n<% end -%>\nEOF\n\n<% end %>\n"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":"","associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-18 16:27:41 UTC","id":401,"auditable_id":29,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<%#\nkind: user_data\nname: Kickstart default user data\noses:\n- CentOS 4\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- Fedora 16\n- Fedora 17\n- Fedora 18\n- Fedora 19\n- Fedora 20\n-%>\n#!/bin/bash\n\n<%# Cloud instances frequently have incorrect hosts data %>\n<%= snippet 'fix_hosts' %>\n\n<%\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.param_true?('force-puppet')\n%>\n<% if puppet_enabled %>\nyum install -y puppet\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\n# UserData still needs wget to mark as finished\n/usr/bin/wget --quiet --output-document=/dev/null --no-check-certificate <%= foreman_url('built') %>\n","<%#\nkind: user_data\nname: Kickstart default user data\noses:\n- CentOS 4\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- Fedora 16\n- Fedora 17\n- Fedora 18\n- Fedora 19\n- Fedora 20\n-%>\n#!/bin/bash\n\n<%# Cloud instances frequently have incorrect hosts data %>\n<%= snippet 'fix_hosts' %>\n\n<%\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.param_true?('force-puppet')\n%>\n<% if puppet_enabled %>\nyum install -y puppet\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\n# UserData still needs wget to mark as finished\n/usr/bin/wget --quiet --output-document=/dev/null --no-check-certificate <%= foreman_url('built') %>\n"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":"","associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-18 16:27:38 UTC","id":400,"auditable_id":27,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<%#\nkind: PXELinux\nname: Kickstart default PXELinux\noses:\n- CentOS 4\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- Fedora 16\n- Fedora 17\n- Fedora 18\n- Fedora 19\n- Fedora 20\n- RedHat 4\n- RedHat 5\n- RedHat 6\n- RedHat 7\n%>\n#\n# This file was deployed via '<%= @template_name %>' template\n#\n# Supported host/hostgroup parameters:\n#\n# blacklist = module1, module2\n#   Blacklisted kernel modules\n#\n<%\n  options = []\n  if @host.params['blacklist']\n    options << \"modprobe.blacklist=\" + @host.params['blacklist'].gsub(' ', '')\n  end\n  options = options.join(' ')\n-%>\n\nDEFAULT linux\n\nLABEL linux\n    KERNEL <%= @kernel %>\n    <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    APPEND initrd=<%= @initrd %> ks=<%= foreman_url('provision') %> repo=<%= @host.operatingsystem.medium_uri(@host) %> ks.device=bootif network ks.sendmac <%= options %>\n    <% elsif @host.operatingsystem.name == 'Fedora' and @host.operatingsystem.major.to_i > 16 -%>\n    APPEND initrd=<%= @initrd %> ks=<%= foreman_url('provision')%> ks.device=bootif network ks.sendmac <%= options %>\n    <% elsif @host.operatingsystem.name != 'Fedora' and @host.operatingsystem.major.to_i >= 7 -%>\n    APPEND initrd=<%= @initrd %> ks=<%= foreman_url('provision')%> network ks.sendmac <%= options %>\n    <% else -%>\n    APPEND initrd=<%= @initrd %> ks=<%= foreman_url('provision')%> ksdevice=bootif network kssendmac <%= options %>\n    <% end -%>\n    IPAPPEND 2\n","<%#\nkind: PXELinux\nname: Kickstart default PXELinux\noses:\n- CentOS 4\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- Fedora 16\n- Fedora 17\n- Fedora 18\n- Fedora 19\n- Fedora 20\n- RedHat 4\n- RedHat 5\n- RedHat 6\n- RedHat 7\n%>\n#\n# This file was deployed via '<%= @template_name %>' template\n#\n# Supported host/hostgroup parameters:\n#\n# blacklist = module1, module2\n#   Blacklisted kernel modules\n#\n<%\n  options = []\n  if @host.params['blacklist']\n    options << \"modprobe.blacklist=\" + @host.params['blacklist'].gsub(' ', '')\n  end\n  options = options.join(' ')\n-%>\n\nDEFAULT linux\n\nLABEL linux\n    KERNEL <%= @kernel %>\n    <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    APPEND initrd=<%= @initrd %> ks=<%= foreman_url('provision') %> repo=<%= @host.operatingsystem.medium_uri(@host) %> ks.device=bootif network ks.sendmac <%= options %>\n    <% elsif @host.operatingsystem.name == 'Fedora' and @host.operatingsystem.major.to_i > 16 -%>\n    APPEND initrd=<%= @initrd %> ks=<%= foreman_url('provision')%> ks.device=bootif network ks.sendmac <%= options %>\n    <% elsif @host.operatingsystem.name != 'Fedora' and @host.operatingsystem.major.to_i >= 7 -%>\n    APPEND initrd=<%= @initrd %> ks=<%= foreman_url('provision')%> network ks.sendmac <%= options %>\n    <% else -%>\n    APPEND initrd=<%= @initrd %> ks=<%= foreman_url('provision')%> ksdevice=bootif network kssendmac <%= options %>\n    <% end -%>\n    IPAPPEND 2\n"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":"","associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-18 16:27:35 UTC","id":399,"auditable_id":28,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["#!gpxe\n<%#\nkind: iPXE\nname: Kickstart default iPXE\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- Fedora 16\n- Fedora 17\n- Fedora 18\n- Fedora 19\n- Fedora 20\n- RedHat 5\n- RedHat 6\n- RedHat 7\n%>\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) && subnet.dhcp_boot_mode? -%>\n  <% static = '' -%>\n<% else -%>\n  <% static_arg = 'static=yes' -%>\n  <% static = (@host.token.nil? ? '?' : '&') + static_arg -%>\n<% end -%>\n\nkernel <%= \"#{@host.url_for_boot(:kernel)}\" %> ks=<%= foreman_url('provision')%><%= static %> ksdevice=<%= @host.mac %> network kssendmac ip=${netX/ip} netmask=${netX/netmask} gateway=${netX/gateway} dns=${dns}\ninitrd <%= \"#{@host.url_for_boot(:initrd)}\" %>\n\nboot\n","#!gpxe\n<%#\nkind: iPXE\nname: Kickstart default iPXE\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- Fedora 16\n- Fedora 17\n- Fedora 18\n- Fedora 19\n- Fedora 20\n- RedHat 5\n- RedHat 6\n- RedHat 7\n%>\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) && subnet.dhcp_boot_mode? -%>\n  <% static = '' -%>\n<% else -%>\n  <% static_arg = 'static=yes' -%>\n  <% static = (@host.token.nil? ? '?' : '&') + static_arg -%>\n<% end -%>\n\nkernel <%= \"#{@host.url_for_boot(:kernel)}\" %> ks=<%= foreman_url('provision')%><%= static %> ksdevice=<%= @host.mac %> network kssendmac ip=${netX/ip} netmask=${netX/netmask} gateway=${netX/gateway} dns=${dns}\ninitrd <%= \"#{@host.url_for_boot(:initrd)}\" %>\n\nboot\n"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":"","associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-18 16:27:32 UTC","id":398,"auditable_id":10,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<%#\nkind: provision\nname: Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","<%#\nkind: provision\nname: Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":"","associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-18 16:27:27 UTC","id":397,"auditable_id":26,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<%#\nkind: finish\nname: Kickstart default finish\noses:\n- CentOS 4\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- Fedora 16\n- Fedora 17\n- Fedora 18\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.param_true?('force-puppet')\n  chef_enabled = @host.respond_to?(:chef_proxy) && @host.chef_proxy\n%>\n\n<% if @host.provision_method == 'image' && !root_pass.empty? -%>\n# Install the root password\necho 'root:<%= root_pass -%>' | /usr/sbin/chpasswd -e\n<% end -%>\n\n<% if rhel_compatible -%>\n<%= snippet 'epel' -%>\n<% end -%>\n\n<% if puppet_enabled -%>\n<% if @host.param_true?('enable-puppetlabs-repo') -%>\n<% if @host.operatingsystem.name == 'Fedora' -%>\nrpm -ivh http://yum.puppetlabs.com/puppetlabs-release-fedora-<%= os_major -%>.noarch.rpm\n<% else -%>\nrpm -ivh http://yum.puppetlabs.com/puppetlabs-release-el-<%= os_major -%>.noarch.rpm\n<% end -%>\n<% end -%>\nyum -t -y -e 0 install puppet\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet 'freeipa_register' %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<% if puppet_enabled %>\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n<% if chef_enabled %>\n<%= snippet 'chef_client' %>\n<% end -%>\n\n# Setup puppet to run on system reboot\n<% if @host.operatingsystem.name == 'Fedora' -%>\npuppet_unit=puppet\n/usr/bin/systemctl list-unit-files | grep -q puppetagent && puppet_unit=puppetagent\n/usr/bin/systemctl enable ${puppet_unit}\n<% else -%>\n/sbin/chkconfig --level 345 puppet on\n<% end -%>\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nexit 0\n","<%#\nkind: finish\nname: Kickstart default finish\noses:\n- CentOS 4\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- Fedora 16\n- Fedora 17\n- Fedora 18\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.param_true?('force-puppet')\n  chef_enabled = @host.respond_to?(:chef_proxy) && @host.chef_proxy\n%>\n\n<% if @host.provision_method == 'image' && !root_pass.empty? -%>\n# Install the root password\necho 'root:<%= root_pass -%>' | /usr/sbin/chpasswd -e\n<% end -%>\n\n<% if rhel_compatible -%>\n<%= snippet 'epel' -%>\n<% end -%>\n\n<% if puppet_enabled -%>\n<% if @host.param_true?('enable-puppetlabs-repo') -%>\n<% if @host.operatingsystem.name == 'Fedora' -%>\nrpm -ivh http://yum.puppetlabs.com/puppetlabs-release-fedora-<%= os_major -%>.noarch.rpm\n<% else -%>\nrpm -ivh http://yum.puppetlabs.com/puppetlabs-release-el-<%= os_major -%>.noarch.rpm\n<% end -%>\n<% end -%>\nyum -t -y -e 0 install puppet\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet 'freeipa_register' %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<% if puppet_enabled %>\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n<% if chef_enabled %>\n<%= snippet 'chef_client' %>\n<% end -%>\n\n# Setup puppet to run on system reboot\n<% if @host.operatingsystem.name == 'Fedora' -%>\npuppet_unit=puppet\n/usr/bin/systemctl list-unit-files | grep -q puppetagent && puppet_unit=puppetagent\n/usr/bin/systemctl enable ${puppet_unit}\n<% else -%>\n/sbin/chkconfig --level 345 puppet on\n<% end -%>\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nexit 0\n"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-18 16:26:00 UTC","id":396,"auditable_id":4,"auditable_name":"Test_Org","auditable_type":"Organization","action":"create","audited_changes":{"name":"Test_Org","ignore_types":[],"description":"","label":"Test_Org","ancestry":null,"katello_default":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-14 16:01:18 UTC","id":395,"auditable_id":67,"auditable_name":"idle_timeout","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- 999\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-10-13 23:09:47 UTC","id":394,"auditable_id":8,"auditable_name":"hotbox1","auditable_type":"Host","action":"update","audited_changes":{"name":["hotbox1","hotbox1.usersys.redhat.com"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.61.199","associated_name":null,"created_at":"2016-10-13 21:57:51 UTC","id":393,"auditable_id":8,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"name":["hotbox1.usersys.redhat.com","hotbox1"],"comment":[null,""]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":17,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.202","associated_name":null,"created_at":"2016-10-12 19:46:11 UTC","id":392,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-12 19:45:33 UTC","id":391,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-12 15:51:22 UTC","id":390,"auditable_id":16,"auditable_name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","auditable_type":"Host","action":"update","audited_changes":{"owner_type":[null,"User"],"owner_id":[null,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-12 08:25:54 UTC","id":388,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":17,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-12 08:25:54 UTC","id":387,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-12 08:25:54 UTC","id":386,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-11 21:47:08 UTC","id":385,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-10 12:45:06 UTC","id":384,"auditable_id":3,"auditable_name":"Test_Org","auditable_type":"Organization","action":"destroy","audited_changes":{"name":"Test_Org","ignore_types":[],"description":"","label":"Test","ancestry":null,"katello_default":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-10 12:24:56 UTC","id":383,"auditable_id":3,"auditable_name":"Test_Org","auditable_type":"Organization","action":"create","audited_changes":{"name":"Test_Org","ignore_types":[],"description":"","label":"Test","ancestry":null,"katello_default":false}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-09 13:47:30 UTC","id":382,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-09 13:47:16 UTC","id":381,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-09 13:47:02 UTC","id":380,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-09 13:44:20 UTC","id":378,"auditable_id":16,"auditable_name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","auditable_type":"Host","action":"create","audited_changes":{"name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":null,"owner_type":null,"enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-09 13:44:12 UTC","id":377,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.94","associated_name":null,"created_at":"2016-10-09 13:44:10 UTC","id":376,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,3],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.94","associated_name":null,"created_at":"2016-10-09 13:44:08 UTC","id":375,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"battalionbox.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.94","associated_name":null,"created_at":"2016-10-09 13:44:08 UTC","id":374,"auditable_id":15,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Katello::System","action":"create","audited_changes":{"uuid":null,"name":"battalionbox.usersys.redhat.com","location":"None","environment_id":1,"content_view_id":1,"host_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.249.231","associated_name":null,"created_at":"2016-10-09 13:16:48 UTC","id":373,"auditable_id":14,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"battalionbox.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":2,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":3,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":9,"host_id":14,"uuid":"b060fafa-25f2-492a-85c3-dbadad9811cd","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":11,"host_id":14,"uuid":"1f6c291c-4c76-459a-add5-571e38b3d08e","last_checkin":"2016-10-09T12:58:06.858Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2016-10-09T12:58:12.612Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-09 13:16:40 UTC","id":372,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-09 13:16:36 UTC","id":371,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.249.231","associated_name":null,"created_at":"2016-10-09 13:05:37 UTC","id":370,"auditable_id":14,"auditable_name":"b060fafa-25f2-492a-85c3-dbadad9811cd.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"name":["b060fafa-25f2-492a-85c3-dbadad9811cd.usersys.redhat.com","battalionbox.usersys.redhat.com"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.249.231","associated_name":null,"created_at":"2016-10-09 13:04:43 UTC","id":369,"auditable_id":14,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"name":["battalionbox.usersys.redhat.com","b060fafa-25f2-492a-85c3-dbadad9811cd.usersys.redhat.com"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-09 13:00:57 UTC","id":368,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-09 13:00:45 UTC","id":367,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-09 12:58:47 UTC","id":366,"auditable_id":14,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-09 12:58:10 UTC","id":364,"auditable_id":14,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.94","associated_name":null,"created_at":"2016-10-09 12:58:08 UTC","id":363,"auditable_id":14,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,3],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.94","associated_name":null,"created_at":"2016-10-09 12:58:06 UTC","id":362,"auditable_id":14,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"battalionbox.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.249.231","associated_name":null,"created_at":"2016-10-09 12:56:09 UTC","id":360,"auditable_id":11,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"battalionbox.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":2,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":3,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":1,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":7,"host_id":11,"uuid":"e18c2eff-22c5-4c5d-a46e-5ac11d75d544","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":7,"host_id":11,"uuid":"bd938ea7-b27b-4c9f-9bf0-439ef2807cc6","last_checkin":"2016-10-04T10:47:19.461Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2016-10-04T13:23:20.783Z"}}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.249.231","associated_name":null,"created_at":"2016-10-09 12:56:02 UTC","id":359,"auditable_id":12,"auditable_name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","auditable_type":"Host","action":"destroy","audited_changes":{"name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null,"subscription_facet_attributes":{"id":8,"host_id":12,"uuid":"cee92c76-5309-4b88-83c7-8ec1e5e633d3","last_checkin":null,"service_level":null,"release_version":null,"autoheal":true,"registered_at":"2016-10-03T23:11:19.873Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-09 12:48:31 UTC","id":358,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-09 12:48:28 UTC","id":357,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-10-07 22:04:29 UTC","id":356,"auditable_id":9,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"hotbox1.rdu.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":2,"environment_id":2,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":1,"owner_id":2,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":1,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":1,"certname":"hotbox1.rdu.redhat.com","image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":1,"grub_pass":"","content_view_id":2,"lifecycle_environment_id":1,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-05 17:27:57 UTC","id":355,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-05 14:42:36 UTC","id":354,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-05 14:37:41 UTC","id":353,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-05 14:32:05 UTC","id":352,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-05 14:31:46 UTC","id":351,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-05 14:31:29 UTC","id":350,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.160","associated_name":null,"created_at":"2016-10-05 14:31:26 UTC","id":349,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,3]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.160","associated_name":null,"created_at":"2016-10-05 14:31:25 UTC","id":348,"auditable_id":13,"auditable_name":"drone68.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone68.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 16:14:52 UTC","id":346,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 16:14:38 UTC","id":345,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:53:43 UTC","id":344,"auditable_id":144,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:53:43 UTC","id":343,"auditable_id":145,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:53:43 UTC","id":342,"auditable_id":143,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:53:43 UTC","id":341,"auditable_id":146,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":30,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:53:42 UTC","id":340,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:53:41 UTC","id":339,"auditable_id":146,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":29,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:53:41 UTC","id":338,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:53:41 UTC","id":337,"auditable_id":145,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:53:41 UTC","id":336,"auditable_id":144,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:53:41 UTC","id":335,"auditable_id":143,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:49:24 UTC","id":334,"auditable_id":140,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:49:24 UTC","id":333,"auditable_id":141,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:49:24 UTC","id":332,"auditable_id":139,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:49:24 UTC","id":331,"auditable_id":142,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":28,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:49:24 UTC","id":330,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:49:23 UTC","id":329,"auditable_id":142,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":27,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:49:23 UTC","id":328,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:49:22 UTC","id":327,"auditable_id":141,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:49:22 UTC","id":326,"auditable_id":140,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:49:22 UTC","id":325,"auditable_id":139,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:48:27 UTC","id":324,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 14:47:57 UTC","id":323,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 13:27:58 UTC","id":322,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 13:27:46 UTC","id":321,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 13:25:19 UTC","id":320,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 13:24:21 UTC","id":319,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 13:14:39 UTC","id":317,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 13:14:35 UTC","id":316,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 13:14:32 UTC","id":315,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:21:47 UTC","id":313,"auditable_id":136,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:21:47 UTC","id":312,"auditable_id":137,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:21:47 UTC","id":311,"auditable_id":135,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:21:46 UTC","id":310,"auditable_id":138,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":26,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:21:46 UTC","id":309,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:21:45 UTC","id":308,"auditable_id":138,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":25,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:21:45 UTC","id":307,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:21:44 UTC","id":306,"auditable_id":137,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:21:44 UTC","id":305,"auditable_id":136,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:21:44 UTC","id":304,"auditable_id":135,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:19:46 UTC","id":303,"auditable_id":132,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:19:46 UTC","id":302,"auditable_id":133,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:19:46 UTC","id":301,"auditable_id":131,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:19:46 UTC","id":300,"auditable_id":134,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":24,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:19:46 UTC","id":299,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:19:45 UTC","id":298,"auditable_id":134,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":23,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:19:44 UTC","id":297,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:19:44 UTC","id":296,"auditable_id":133,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:19:44 UTC","id":295,"auditable_id":132,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-04 12:19:44 UTC","id":294,"auditable_id":131,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 23:11:23 UTC","id":291,"auditable_id":12,"auditable_name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","auditable_type":"Host","action":"create","audited_changes":{"name":"virt-who-7a2906dc-91f0-e111-a8bd-cc52af3eeb50-1","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":1,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 22:05:33 UTC","id":290,"auditable_id":11,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 22:03:06 UTC","id":289,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 22:03:05 UTC","id":288,"auditable_id":11,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 19:28:51 UTC","id":287,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:06:38 UTC","id":286,"auditable_id":128,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:06:38 UTC","id":285,"auditable_id":129,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:06:38 UTC","id":284,"auditable_id":127,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:06:38 UTC","id":283,"auditable_id":130,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":22,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:06:37 UTC","id":282,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:06:36 UTC","id":281,"auditable_id":130,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":21,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:06:36 UTC","id":280,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:06:35 UTC","id":279,"auditable_id":129,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:06:35 UTC","id":278,"auditable_id":128,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:06:35 UTC","id":277,"auditable_id":127,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:02:28 UTC","id":276,"auditable_id":124,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:02:28 UTC","id":275,"auditable_id":125,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:02:28 UTC","id":274,"auditable_id":123,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:02:28 UTC","id":273,"auditable_id":126,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":20,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:02:27 UTC","id":272,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:02:26 UTC","id":271,"auditable_id":126,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":19,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:02:26 UTC","id":270,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:02:26 UTC","id":269,"auditable_id":125,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:02:26 UTC","id":268,"auditable_id":124,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:02:26 UTC","id":267,"auditable_id":123,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:01:21 UTC","id":266,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 14:00:45 UTC","id":265,"auditable_id":34,"auditable_name":"use_pulp_oauth","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:36:34 UTC","id":264,"auditable_id":120,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:36:34 UTC","id":263,"auditable_id":121,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:36:34 UTC","id":262,"auditable_id":119,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:36:34 UTC","id":261,"auditable_id":122,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":18,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:36:33 UTC","id":260,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:36:32 UTC","id":259,"auditable_id":122,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":17,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:36:32 UTC","id":258,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:36:31 UTC","id":257,"auditable_id":121,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:36:31 UTC","id":256,"auditable_id":120,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:36:31 UTC","id":255,"auditable_id":119,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:34:52 UTC","id":254,"auditable_id":116,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:34:52 UTC","id":253,"auditable_id":117,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:34:52 UTC","id":252,"auditable_id":115,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:34:52 UTC","id":251,"auditable_id":118,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":16,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:34:51 UTC","id":250,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:34:50 UTC","id":249,"auditable_id":118,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:34:50 UTC","id":248,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:34:49 UTC","id":247,"auditable_id":117,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:34:49 UTC","id":246,"auditable_id":116,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:34:49 UTC","id":245,"auditable_id":115,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:33:05 UTC","id":244,"auditable_id":112,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:33:05 UTC","id":243,"auditable_id":113,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:33:05 UTC","id":242,"auditable_id":111,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:33:05 UTC","id":241,"auditable_id":114,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:33:05 UTC","id":240,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:33:04 UTC","id":239,"auditable_id":114,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:33:04 UTC","id":238,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:33:03 UTC","id":237,"auditable_id":113,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:33:03 UTC","id":236,"auditable_id":112,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:33:03 UTC","id":235,"auditable_id":111,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:31:12 UTC","id":234,"auditable_id":108,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:31:12 UTC","id":233,"auditable_id":109,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:31:12 UTC","id":232,"auditable_id":107,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:31:12 UTC","id":231,"auditable_id":110,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:31:11 UTC","id":230,"auditable_id":76,"auditable_name":"idm_register","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<%#\nkind: snippet\nname: idm_register\n%>\n# Identity Management Registration Snippet\n#\n# Optional parameters:\n#\n#   idm_server              IdM server\n#\n#   idm_sudo                Enable sudoers\n#                           Default: true\n#\n#   idm_ssh                 Enable ssh integration\n#                           Default: true\n#\n#   idm_automount           Enable automounter\n#                           Default: false\n#\n#   idm_automount_location  Location for automounts\n#\n#   idm_mkhomedir           Enable automatically making home directories\n#                           Default: true\n#\n#   idm_opts                Additional options to pass directly to installer\n#\n<% if @host.operatingsystem.family == 'Redhat' -%>\n  <% if @host.operatingsystem.name == \"Fedora\" -%>\n    idm_client=freeipa-client\n  <% else -%>\n    idm_client=ipa-client\n  <% end -%>\n<% else -%>\n  idm_client=freeipa-client\n<% end -%>\n\n<%= @host.operatingsystem.family == \"Redhat\" ? 'yum install -y libsss_sudo' : 'apt-get install -y libsss-sudo' %> $idm_client\n\n##\n## IDM Client Installation\n##\n\n<% if @host.params[\"idm_server\"] -%>\nidm_server=\"--server <%= @host.params[\"idm_server\"] %>\"\n<% end -%>\n\n<% unless @host.param_false? \"idm_mkhomedir\" %>\nidm_mkhomedir=\"--mkhomedir\"\n<% end -%>\n\n<% if @host.param_false? \"idm_ssh\" %>\nidm_ssh=\"--no-ssh\"\n<% end -%>\n\n<% if @host.params[\"idm_opts\"] -%>\nidm_opts=\"<%= @host.params[\"idm_opts\"] %>\"\n<% end -%>\n\n/usr/sbin/ipa-client-install -w '<%= @host.otp %>' --realm=<%= @host.realm %> -f -U $idm_mkhomedir $idm_opts $idm_server $idm_ssh\n\n##\n## Automounter\n##\n\n<% if @host.params[\"idm_automount_location\"] -%>\nautomount_location=\"--location <%= @host.params[\"idm_automount_location\"] %>\"\n<% end -%>\n\n<% if @host.param_true? \"idm_automount\" -%>\nif [ -f /usr/sbin/ipa-client-automount ]\nthen\n  /usr/sbin/ipa-client-automount $idm_server $automount_location --unattended\nfi\n<% end -%>\n\n##\n## Sudoers\n##\n\n<% unless @host.param_false? \"idm_enable_sudo\" %>\n\nidm_realm=$(grep default_realm /etc/krb5.conf | cut -d\"=\" -f2 | tr -d ' ')\nidm_domain=$(grep default_domain /etc/krb5.conf | cut -d\"=\" -f2 | tr -d ' ')\nidm_dn=$(for word in $(echo $idm_domain | sed 's/\\./ /g'); do echo -n dc=$word,; done)\n\nsssd_version=$(sssd --version)\nsssd_major=$(echo $sssd_version | cut -f1 -d.)\nsssd_minor=$(echo $sssd_version | cut -f2 -d.)\nLDAP_CONFIG=$(mktemp)\n\nif [ $sssd_minor -ge 11 ] || [ $sssd_major -gt 1 ]\nthen\n    echo \"sudo_provider = ipa\" > $LDAP_CONFIG\nelse\n    <% if @host.params[\"idm_server\"] -%>\n    ldap_uri=\", ldap://<%= @host.params[\"idm_server\"] %>\"\n    krb5_server=<%= @host.params[\"idm_server\"] %>\n    <% else -%>\n    krb5_server=\"_srv_\"\n    <% end -%>\n\ncat <<EOF > $LDAP_CONFIG\nsudo_provider = ldap\nldap_uri = _srv_ $ldap_uri\nldap_sudo_search_base = ou=SUDOers,${idm_dn%?}\nldap_sasl_mech = GSSAPI\nldap_sasl_authid = host/$HOSTNAME\nldap_sasl_realm = $idm_realm\nkrb5_server = $krb5_server\nEOF\n\nfi\n\nsed -i -e \"/\\[domain\\/.*\\]/ r $LDAP_CONFIG\" /etc/sssd/sssd.conf\nsed -i -e \"s/services = .*/\\0, sudo/\" /etc/sssd/sssd.conf\n\n<% if @host.operatingsystem.family == 'Redhat' -%>\n  authconfig --nisdomain ${idm_domain} --update\n  chkconfig sssd on\n\n  if [[ $(rpm -qa systemd | wc -l) -gt 0 ]];\n  then\n    domain_service=/usr/lib/systemd/system/*-domainname.service\n\n    # Workaround for BZ1071969 on RHEL 7.0\n    grep -q \"DefaultDependencies=no\" $domain_service\n    if [[ $? -ne 0 ]]\n    then\n        sed -i -e \"s/\\[Unit\\]/\\[Unit\\]\\nDefaultDependencies=no/\" $domain_service\n    fi\n\n    systemctl start $(basename $domain_service)\n    systemctl enable $(basename $domain_service)\n  fi\n<% else -%>\n  sed -i -e '/^exit /d' /etc/rc.local\n  echo \"nisdomainname ${idm_domain}\" >> /etc/rc.local\n  echo \"exit 0\" >> /etc/rc.local\n  nisdomainname ${idm_domain}\n<% end -%>\n\ngrep -q sudoers /etc/nsswitch.conf\nif [[ $? -eq 0 ]];\nthen\n  sed -i -e \"s/^sudoers.*/sudoers:    files sss/\" /etc/nsswitch.conf\nelse\n  echo sudoers:    files sss >> /etc/nsswitch.conf\nfi\n<% end -%>\n","<%#\nkind: snippet\nname: idm_register\n%>\n# Identity Management Registration Snippet\n#\n# Optional parameters:\n#\n#   idm_server              IdM server\n#\n#   idm_sudo                Enable sudoers\n#                           Default: true\n#\n#   idm_ssh                 Enable ssh integration\n#                           Default: true\n#\n#   idm_automount           Enable automounter\n#                           Default: false\n#\n#   idm_automount_location  Location for automounts\n#\n#   idm_mkhomedir           Enable automatically making home directories\n#                           Default: true\n#\n#   idm_opts                Additional options to pass directly to installer\n#\n\n<% if @host.operatingsystem.family == 'Redhat' -%>\n  <% if @host.operatingsystem.name == 'Fedora' -%>\n    idm_client=freeipa-client\n  <% else -%>\n    idm_client=ipa-client\n  <% end -%>\n  <% if @host.operatingsystem.major.to_i > 6 -%>\n    /usr/sbin/sshd-keygen\n  <% end -%>\n<% else -%>\n  idm_client=freeipa-client\n<% end -%>\n\n<%= @host.operatingsystem.family == 'Redhat' ? 'yum install -y libsss_sudo' : 'apt-get install -y libsss-sudo' %> $idm_client\n\n##\n## IDM Client Installation\n##\n<% if @host.params['idm_server'] -%>\n<% domain = @host.params['idm_domain'] || @host.realm.name.downcase -%>\n\nidm_server=\"--server <%= @host.params['idm_server'] %> --domain <%=domain %>\"\n<% end -%>\n\n<% unless @host.param_false? 'idm_mkhomedir' %>\nidm_mkhomedir=\"--mkhomedir\"\n<% end -%>\n\n<% if @host.param_false? 'idm_ssh' %>\nidm_ssh=\"--no-ssh\"\n<% end -%>\n\n<% if @host.params['idm_opts'] -%>\nidm_opts=\"<%= @host.params['idm_opts'] %>\"\n<% end -%>\n\n# One-time password will be requested at install time. Otherwise, $HOST[OTP] is used as a placeholder value.\n/usr/sbin/ipa-client-install -w '<%= @host.otp || \"$HOST[OTP]\" %>' --realm=<%= @host.realm %> -U $idm_mkhomedir $idm_opts $idm_server $idm_ssh\n\n##\n## Automounter\n##\n\n<% if @host.params['idm_automount_location'] -%>\nautomount_location=\"--location <%= @host.params['idm_automount_location'] %>\"\n<% end -%>\n\n<% if @host.param_true? 'idm_automount' -%>\nif [ -f /usr/sbin/ipa-client-automount ]\nthen\n  /usr/sbin/ipa-client-automount $idm_server $automount_location --unattended\nfi\n<% end -%>\n\n##\n## Sudoers\n##\n\n<% unless @host.param_false? 'idm_enable_sudo' %>\n\nidm_client_version=$(ipa-client-install --version)\nidm_client_version_major=$(echo $idm_client_version | cut -f1 -d.)\nidm_client_version_minor=$(echo $idm_client_version | cut -f2 -d.)\nidm_realm=$(grep default_realm /etc/krb5.conf | cut -d\"=\" -f2 | tr -d ' ')\nidm_domain=$(grep -A 2 domain_realm /etc/krb5.conf | tail -n1 | awk '{print $1}')\nidm_dn=$(for word in $(echo $idm_domain | sed 's/\\./ /g'); do echo -n dc=$word,; done)\nsssd_version=$(sssd --version)\nsssd_major=$(echo $sssd_version | cut -f1 -d.)\nsssd_minor=$(echo $sssd_version | cut -f2 -d.)\nLDAP_CONFIG=$(mktemp)\n\n# >=ipa-client-4.1.0 automatically configures sssd for sudo\n# =<ipa-client-3 requires manual configuration which this snippet takes care of\n\nif [ $idm_client_version_major -lt 4 ]\nthen\n  # Modify sssd.conf\n  sed -i -e \"s/services = .*/\\0, sudo/\" /etc/sssd/sssd.conf\n\n  # Modify sssd.conf for sssd <1.11 (RHEL <6.6)\n  if [ $sssd_minor -lt 11 ] || [ $sssd_major -lt 1 ]\n  then\n    <% if @host.params['idm_server'] -%>\n    ldap_uri=\", ldap://<%= @host.params['idm_server'] %>\"\n    krb5_server=<%= @host.params['idm_server'] %>\n    <% else -%>\n    krb5_server=\"_srv_\"\n    <% end -%>\n\ncat <<EOF > $LDAP_CONFIG\nsudo_provider = ldap\nldap_uri = _srv_ $ldap_uri\nldap_sudo_search_base = ou=SUDOers,${idm_dn%?}\nldap_sasl_mech = GSSAPI\nldap_sasl_authid = host/$HOSTNAME\nldap_sasl_realm = $idm_realm\nkrb5_server = $krb5_server\nEOF\n  sed -i -e \"/\\[domain\\/.*\\]/ r $LDAP_CONFIG\" /etc/sssd/sssd.conf\n  fi\n\n  # Modify nsswitch.conf\n  grep -q sudoers /etc/nsswitch.conf\n  if [[ $? -eq 0 ]];\n  then\n    sed -i -e \"s/^sudoers.*/sudoers:    files sss/\" /etc/nsswitch.conf\n  else\n    echo \"sudoers:    files sss\" >> /etc/nsswitch.conf\n  fi\n\n  # Configure nisdomain\n  <% if @host.operatingsystem.family == 'Redhat' -%>\n    authconfig --nisdomain ${idm_domain} --update\n    chkconfig sssd on\n\n    if [[ $(rpm -qa systemd | wc -l) -gt 0 ]];\n    then\n      domain_service=/usr/lib/systemd/system/*-domainname.service\n\n      # Workaround for BZ1071969 on RHEL 7.0\n      grep -q \"DefaultDependencies=no\" $domain_service\n      if [[ $? -ne 0 ]]\n      then\n        sed -i -e \"s/\\[Unit\\]/\\[Unit\\]\\nDefaultDependencies=no/\" $domain_service\n      fi\n\n      systemctl start $(basename $domain_service)\n      systemctl enable $(basename $domain_service)\n    fi\n  <% else -%>\n  # OS is not RedHat\n  sed -i -e '/^exit /d' /etc/rc.local\n  echo \"nisdomainname ${idm_domain}\" >> /etc/rc.local\n  echo \"exit 0\" >> /etc/rc.local\n  nisdomainname ${idm_domain}\n  <% end -%>\nfi\n\n<% end -%>\n\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:31:11 UTC","id":229,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:31:08 UTC","id":228,"auditable_id":110,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:31:08 UTC","id":227,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:31:08 UTC","id":226,"auditable_id":109,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:31:08 UTC","id":225,"auditable_id":108,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-03 13:31:07 UTC","id":224,"auditable_id":107,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":null,"user_type":null,"user_name":null,"version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-10-01 08:34:13 UTC","id":223,"auditable_id":11,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-09-30 14:28:05 UTC","id":222,"auditable_id":11,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-09-28 08:27:04 UTC","id":221,"auditable_id":11,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":15,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-09-20 22:02:04 UTC","id":220,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":14,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-09-20 21:35:42 UTC","id":219,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-09-20 03:05:47 UTC","id":218,"auditable_id":11,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-09-20 03:01:43 UTC","id":217,"auditable_id":11,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-09-20 02:56:42 UTC","id":216,"auditable_id":11,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-09-20 02:55:06 UTC","id":215,"auditable_id":11,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.94","associated_name":null,"created_at":"2016-09-20 02:55:03 UTC","id":214,"auditable_id":11,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,3],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.94","associated_name":null,"created_at":"2016-09-20 02:55:00 UTC","id":213,"auditable_id":11,"auditable_name":"battalionbox.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"battalionbox.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":13,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-09-19 08:49:15 UTC","id":211,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":12,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-09-19 08:25:48 UTC","id":210,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":11,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-09-15 08:48:32 UTC","id":209,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-09-15 08:24:38 UTC","id":208,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-09-09 08:47:11 UTC","id":207,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-09-09 08:23:59 UTC","id":206,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-09-06 08:46:54 UTC","id":205,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-09-06 08:27:37 UTC","id":204,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-09-02 08:47:57 UTC","id":203,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-09-02 08:21:06 UTC","id":202,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-08-24 16:45:56 UTC","id":201,"auditable_id":9,"auditable_name":"Base_Org/Library/Red_Hat_Server/Red_Hat_Enterprise_Linux_7_Server_Kickstart_x86_64_7_2","auditable_type":"Medium","action":"update","audited_changes":{"media_path":[null,""],"config_path":[null,""],"image_path":[null,""]}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-23 12:09:17 UTC","id":200,"auditable_id":10,"auditable_name":"Base_Org/Library/Red_Hat_Server/Red_Hat_Enterprise_Linux_6_Server_Kickstart_x86_64_6_8","auditable_type":"Medium","action":"create","audited_changes":{"name":"Base_Org/Library/Red_Hat_Server/Red_Hat_Enterprise_Linux_6_Server_Kickstart_x86_64_6_8","path":"http://batman.usersys.redhat.com/pulp/repos/Base_Org/Library/content/dist/rhel/server/6/6.8/x86_64/kickstart/","media_path":null,"config_path":null,"image_path":null,"os_family":"Redhat"}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-23 12:09:15 UTC","id":199,"auditable_id":3,"auditable_name":"RedHat 6.8","auditable_type":"Operatingsystem","action":"create","audited_changes":{"major":"6","name":"RedHat","minor":"8","nameindicator":null,"release_name":null,"description":null,"password_hash":"SHA256","title":"RedHat 6.8"}},{"user_id":null,"user_type":null,"user_name":null,"version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-19 08:48:01 UTC","id":198,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":null,"user_type":null,"user_name":null,"version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-19 08:48:00 UTC","id":197,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-18 14:15:30 UTC","id":196,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.41","associated_name":null,"created_at":"2016-08-18 14:15:25 UTC","id":195,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.41","associated_name":null,"created_at":"2016-08-18 14:15:23 UTC","id":194,"auditable_id":10,"auditable_name":"drone72.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"drone72.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 05:59:39 UTC","id":192,"auditable_id":8,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"certname":[null,"hotbox1.usersys.redhat.com"],"puppet_proxy_id":[null,1],"puppet_ca_proxy_id":[null,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":18,"associated_type":"LookupKey","remote_address":"10.10.56.164","associated_name":"foreman_scap_client::port","created_at":"2016-08-16 05:53:04 UTC","id":191,"auditable_id":2,"auditable_name":"hostgroup=PuppetGroup","auditable_type":"LookupValue","action":"create","audited_changes":{"match":"hostgroup=PuppetGroup","value":9090,"lookup_key_id":18,"use_puppet_default":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":17,"associated_type":"LookupKey","remote_address":"10.10.56.164","associated_name":"foreman_scap_client::server","created_at":"2016-08-16 05:53:04 UTC","id":190,"auditable_id":1,"auditable_name":"hostgroup=PuppetGroup","auditable_type":"LookupValue","action":"create","audited_changes":{"match":"hostgroup=PuppetGroup","value":"batman.usersys.redhat.com","lookup_key_id":17,"use_puppet_default":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":1,"associated_type":"Hostgroup","remote_address":"10.10.56.164","associated_name":"PuppetGroup","created_at":"2016-08-16 05:53:04 UTC","id":189,"auditable_id":2,"auditable_name":"2","auditable_type":"HostgroupClass","action":"create","audited_changes":{"hostgroup_id":1,"puppetclass_id":5}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":5,"associated_type":"Puppetclass","remote_address":"10.10.56.164","associated_name":"foreman_scap_client","created_at":"2016-08-16 05:51:34 UTC","id":188,"auditable_id":22,"auditable_name":"foreman_scap_client::policies","auditable_type":"LookupKey","action":"update","audited_changes":{"key_type":[null,"array"],"default_value":[null,"<%= @host.policies_enc %>"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 05:48:53 UTC","id":187,"auditable_id":22,"auditable_name":"::policies","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"policies","puppetclass_id":null,"default_value":null,"path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":null,"override":true,"required":true,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 05:48:53 UTC","id":186,"auditable_id":21,"auditable_name":"::host_private_key","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"host_private_key","puppetclass_id":null,"default_value":"${$::foreman_scap_client::params::host_private_key}","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 05:48:53 UTC","id":185,"auditable_id":20,"auditable_name":"::host_certificate","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"host_certificate","puppetclass_id":null,"default_value":"${$::foreman_scap_client::params::host_certificate}","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 05:48:53 UTC","id":184,"auditable_id":19,"auditable_name":"::ca_file","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"ca_file","puppetclass_id":null,"default_value":"${$::foreman_scap_client::params::ca_file}","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 05:48:53 UTC","id":183,"auditable_id":18,"auditable_name":"::port","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"port","puppetclass_id":null,"default_value":null,"path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":null,"override":true,"required":true,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 05:48:53 UTC","id":182,"auditable_id":17,"auditable_name":"::server","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"server","puppetclass_id":null,"default_value":null,"path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":null,"override":true,"required":true,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 05:48:53 UTC","id":181,"auditable_id":6,"auditable_name":"foreman_scap_client::params","auditable_type":"Puppetclass","action":"create","audited_changes":{"name":"foreman_scap_client::params","hostgroups_count":0}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 05:48:53 UTC","id":180,"auditable_id":5,"auditable_name":"foreman_scap_client","auditable_type":"Puppetclass","action":"create","audited_changes":{"name":"foreman_scap_client","hostgroups_count":0}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 05:48:53 UTC","id":179,"auditable_id":4,"auditable_name":"stdlib::stages","auditable_type":"Puppetclass","action":"create","audited_changes":{"name":"stdlib::stages","hostgroups_count":0}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 05:48:53 UTC","id":178,"auditable_id":3,"auditable_name":"stdlib","auditable_type":"Puppetclass","action":"create","audited_changes":{"name":"stdlib","hostgroups_count":0}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 05:41:50 UTC","id":177,"auditable_id":104,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 05:41:50 UTC","id":176,"auditable_id":105,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 05:41:50 UTC","id":175,"auditable_id":103,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 05:41:50 UTC","id":174,"auditable_id":106,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":10,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 05:41:49 UTC","id":173,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 05:41:48 UTC","id":172,"auditable_id":106,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 05:41:48 UTC","id":171,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 05:41:47 UTC","id":170,"auditable_id":105,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 05:41:47 UTC","id":169,"auditable_id":104,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 05:41:47 UTC","id":168,"auditable_id":103,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 05:14:41 UTC","id":167,"auditable_id":8,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 05:05:19 UTC","id":166,"auditable_id":8,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 04:30:55 UTC","id":165,"auditable_id":8,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2],"content_source_id":[null,1],"content_view_id":[null,2],"lifecycle_environment_id":[null,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 04:28:41 UTC","id":164,"auditable_id":9,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"content_source_id":[null,1],"content_view_id":[null,2],"lifecycle_environment_id":[null,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 04:28:00 UTC","id":163,"auditable_id":9,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"environment_id":[1,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 04:27:50 UTC","id":162,"auditable_id":9,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"hostgroup_id":[null,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 04:27:29 UTC","id":161,"auditable_id":9,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"owner_type":[null,"User"],"owner_id":[null,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 04:27:24 UTC","id":160,"auditable_id":9,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2],"environment_id":[null,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 04:27:22 UTC","id":159,"auditable_id":9,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"hotbox1.rdu.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":null,"owner_type":null,"enabled":true,"puppet_ca_proxy_id":1,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":1,"certname":"hotbox1.rdu.redhat.com","image_id":null,"organization_id":null,"location_id":null,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 04:26:14 UTC","id":158,"auditable_id":8,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"environment_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 04:26:03 UTC","id":157,"auditable_id":8,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"hostgroup_id":[null,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 04:19:36 UTC","id":156,"auditable_id":8,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 04:19:01 UTC","id":155,"auditable_id":8,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.177","associated_name":null,"created_at":"2016-08-16 04:18:58 UTC","id":154,"auditable_id":8,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.177","associated_name":null,"created_at":"2016-08-16 04:18:57 UTC","id":153,"auditable_id":8,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"hotbox1.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.52.234","associated_name":null,"created_at":"2016-08-16 04:16:11 UTC","id":151,"auditable_id":97,"auditable_name":"create_new_host_when_facts_are_uploaded","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- false\n...\n",null]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.52.234","associated_name":null,"created_at":"2016-08-16 04:16:08 UTC","id":150,"auditable_id":98,"auditable_name":"create_new_host_when_report_is_uploaded","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- false\n...\n",null]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.52.234","associated_name":null,"created_at":"2016-08-16 04:16:03 UTC","id":149,"auditable_id":99,"auditable_name":"legacy_puppet_hostname","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":3,"user_type":null,"user_name":"admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 03:59:22 UTC","id":148,"auditable_id":7,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"hotbox1.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":2,"environment_id":2,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":1,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":1,"grub_pass":"","content_view_id":2,"lifecycle_environment_id":1,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":4,"host_id":7,"uuid":"4f8597f1-90e3-48ad-a234-f8f5b40ad6b7","content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null},"subscription_facet_attributes":{"id":4,"host_id":7,"uuid":"4f8597f1-90e3-48ad-a234-f8f5b40ad6b7","last_checkin":"2016-08-16T03:36:05.210Z","service_level":null,"release_version":null,"autoheal":true,"registered_at":"2016-08-16T03:36:06.982Z"}}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 03:45:53 UTC","id":147,"auditable_id":7,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"content_source_id":[null,1],"content_view_id":[null,2],"lifecycle_environment_id":[null,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 03:39:52 UTC","id":146,"auditable_id":7,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"environment_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 03:39:42 UTC","id":145,"auditable_id":7,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"hostgroup_id":[null,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 03:36:09 UTC","id":144,"auditable_id":7,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.177","associated_name":null,"created_at":"2016-08-16 03:36:06 UTC","id":143,"auditable_id":7,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.177","associated_name":null,"created_at":"2016-08-16 03:36:05 UTC","id":142,"auditable_id":7,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"hotbox1.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 03:32:19 UTC","id":140,"auditable_id":6,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"hotbox1.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":2,"environment_id":2,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":1,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":3,"host_id":6,"uuid":null,"content_view_id":1,"lifecycle_environment_id":1,"kickstart_repository_id":null}}},{"user_id":3,"user_type":null,"user_name":"admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 03:32:13 UTC","id":139,"auditable_id":5,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"hotbox1.rdu.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":2,"environment_id":1,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":1,"owner_id":2,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":1,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":1,"certname":"hotbox1.rdu.redhat.com","image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":1,"grub_pass":"","content_view_id":2,"lifecycle_environment_id":1,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.52.234","associated_name":null,"created_at":"2016-08-16 03:31:36 UTC","id":138,"auditable_id":95,"auditable_name":"update_environment_from_facts","auditable_type":"Setting","action":"update","audited_changes":{"value":["--- true\n...\n",null]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.52.234","associated_name":null,"created_at":"2016-08-16 03:30:38 UTC","id":137,"auditable_id":99,"auditable_name":"legacy_puppet_hostname","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 03:26:09 UTC","id":136,"auditable_id":5,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"content_source_id":[null,1],"content_view_id":[null,2],"lifecycle_environment_id":[null,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 03:26:04 UTC","id":135,"auditable_id":5,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"environment_id":[2,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.52.234","associated_name":null,"created_at":"2016-08-16 03:25:28 UTC","id":134,"auditable_id":95,"auditable_name":"update_environment_from_facts","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 03:23:29 UTC","id":133,"auditable_id":5,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"environment_id":[1,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 03:23:18 UTC","id":132,"auditable_id":5,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"hostgroup_id":[null,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 03:20:17 UTC","id":131,"auditable_id":6,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"environment_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 03:20:02 UTC","id":130,"auditable_id":6,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"hostgroup_id":[null,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 03:14:32 UTC","id":129,"auditable_id":6,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.177","associated_name":null,"created_at":"2016-08-16 03:14:29 UTC","id":128,"auditable_id":6,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.177","associated_name":null,"created_at":"2016-08-16 03:14:28 UTC","id":127,"auditable_id":6,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"hotbox1.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.52.234","associated_name":null,"created_at":"2016-08-16 03:09:41 UTC","id":125,"auditable_id":98,"auditable_name":"create_new_host_when_report_is_uploaded","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- false\n...\n"]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.52.234","associated_name":null,"created_at":"2016-08-16 03:09:38 UTC","id":124,"auditable_id":97,"auditable_name":"create_new_host_when_facts_are_uploaded","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- false\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 03:07:38 UTC","id":123,"auditable_id":5,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"owner_type":[null,"User"],"owner_id":[null,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 03:07:32 UTC","id":122,"auditable_id":5,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2],"environment_id":[null,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 03:07:30 UTC","id":121,"auditable_id":5,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"hotbox1.rdu.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":null,"owner_type":null,"enabled":true,"puppet_ca_proxy_id":1,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":1,"certname":"hotbox1.rdu.redhat.com","image_id":null,"organization_id":null,"location_id":null,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 03:06:41 UTC","id":120,"auditable_id":3,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"hotbox1.usersys.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":2,"environment_id":2,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":1,"hostgroup_id":1,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":1,"grub_pass":"","content_view_id":2,"lifecycle_environment_id":1,"global_status":2,"discovery_rule_id":null,"openscap_proxy_id":null,"content_facet_attributes":{"id":2,"host_id":3,"uuid":null,"content_view_id":2,"lifecycle_environment_id":1,"kickstart_repository_id":null}}},{"user_id":3,"user_type":null,"user_name":"admin","version":9,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 03:06:28 UTC","id":119,"auditable_id":4,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"destroy","audited_changes":{"name":"hotbox1.rdu.redhat.com","root_pass":null,"architecture_id":1,"operatingsystem_id":2,"environment_id":2,"ptable_id":null,"medium_id":null,"build":false,"comment":"","disk":"","installed_at":null,"model_id":1,"hostgroup_id":1,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":1,"managed":true,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":1,"certname":"hotbox1.rdu.redhat.com","image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":1,"grub_pass":"","content_view_id":2,"lifecycle_environment_id":1,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":3,"user_type":null,"user_name":"admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 02:58:34 UTC","id":118,"auditable_id":4,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"environment_id":[1,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 02:40:43 UTC","id":117,"auditable_id":4,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"disk":[null,""],"owner_id":[2,3],"comment":[null,""]}},{"user_id":3,"user_type":null,"user_name":"admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 02:40:34 UTC","id":116,"auditable_id":4,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"managed":[false,true]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 02:33:48 UTC","id":115,"auditable_id":3,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2],"content_source_id":[null,1],"content_view_id":[null,2],"lifecycle_environment_id":[null,1],"environment_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 02:04:12 UTC","id":114,"auditable_id":3,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"hostgroup_id":[null,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 02:01:25 UTC","id":113,"auditable_id":3,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 01:59:54 UTC","id":112,"auditable_id":4,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"content_source_id":[null,1],"content_view_id":[null,2],"lifecycle_environment_id":[null,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 01:59:37 UTC","id":111,"auditable_id":4,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"hostgroup_id":[null,1]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":1,"associated_type":"Hostgroup","remote_address":"10.10.56.164","associated_name":"PuppetGroup","created_at":"2016-08-16 01:59:13 UTC","id":110,"auditable_id":1,"auditable_name":"1","auditable_type":"HostgroupClass","action":"create","audited_changes":{"hostgroup_id":1,"puppetclass_id":1}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.10.56.164","associated_name":null,"created_at":"2016-08-16 01:59:13 UTC","id":109,"auditable_id":1,"auditable_name":"PuppetGroup","auditable_type":"Hostgroup","action":"create","audited_changes":{"name":"PuppetGroup","environment_id":2,"operatingsystem_id":null,"architecture_id":null,"medium_id":null,"ptable_id":null,"root_pass":"","puppet_ca_proxy_id":1,"use_image":null,"image_file":null,"ancestry":null,"vm_defaults":null,"subnet_id":null,"domain_id":null,"puppet_proxy_id":1,"realm_id":null,"compute_profile_id":null,"content_source_id":1,"grub_pass":"","content_view_id":2,"lifecycle_environment_id":1,"lookup_value_matcher":"hostgroup=PuppetGroup","hosts_count":0,"kickstart_repository_id":null,"openscap_proxy_id":null}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:17 UTC","id":108,"auditable_id":16,"auditable_name":"::upload_schedule","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"upload_schedule","puppetclass_id":null,"default_value":"","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:17 UTC","id":107,"auditable_id":15,"auditable_name":"::obsfucate_hostname","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"obsfucate_hostname","puppetclass_id":null,"default_value":"","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:17 UTC","id":106,"auditable_id":14,"auditable_name":"::obsfucate","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"obsfucate","puppetclass_id":null,"default_value":"","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:16 UTC","id":105,"auditable_id":13,"auditable_name":"::auto_update","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"auto_update","puppetclass_id":null,"default_value":"","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:16 UTC","id":104,"auditable_id":12,"auditable_name":"::gpg","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"gpg","puppetclass_id":null,"default_value":"","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:16 UTC","id":103,"auditable_id":11,"auditable_name":"::cert_verify","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"cert_verify","puppetclass_id":null,"default_value":"","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:16 UTC","id":102,"auditable_id":10,"auditable_name":"::proxy","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"proxy","puppetclass_id":null,"default_value":"","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:15 UTC","id":101,"auditable_id":9,"auditable_name":"::base_url","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"base_url","puppetclass_id":null,"default_value":"","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:15 UTC","id":100,"auditable_id":8,"auditable_name":"::password","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"password","puppetclass_id":null,"default_value":"","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:15 UTC","id":99,"auditable_id":7,"auditable_name":"::username","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"username","puppetclass_id":null,"default_value":"","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:15 UTC","id":98,"auditable_id":6,"auditable_name":"::authmethod","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"authmethod","puppetclass_id":null,"default_value":"","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:15 UTC","id":97,"auditable_id":5,"auditable_name":"::auto_config","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"auto_config","puppetclass_id":null,"default_value":"True","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:15 UTC","id":96,"auditable_id":4,"auditable_name":"::log_level","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"log_level","puppetclass_id":null,"default_value":"","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:15 UTC","id":95,"auditable_id":3,"auditable_name":"::content","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"content","puppetclass_id":null,"default_value":"","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:15 UTC","id":94,"auditable_id":2,"auditable_name":"::template","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"template","puppetclass_id":null,"default_value":"","path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"string","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:15 UTC","id":93,"auditable_id":1,"auditable_name":"::dynamic_motd","auditable_type":"LookupKey","action":"create","audited_changes":{"key":"dynamic_motd","puppetclass_id":null,"default_value":true,"path":null,"description":null,"validator_type":null,"validator_rule":null,"key_type":"boolean","override":false,"required":false,"merge_overrides":false,"avoid_duplicates":false,"use_puppet_default":null,"merge_default":false,"hidden_value":false}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:15 UTC","id":92,"auditable_id":2,"auditable_name":"access_insights_client","auditable_type":"Puppetclass","action":"create","audited_changes":{"name":"access_insights_client","hostgroups_count":0}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:48:15 UTC","id":91,"auditable_id":1,"auditable_name":"motd","auditable_type":"Puppetclass","action":"create","audited_changes":{"name":"motd","hostgroups_count":0}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 01:37:33 UTC","id":90,"auditable_id":4,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"owner_type":[null,"User"],"owner_id":[null,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 01:37:32 UTC","id":89,"auditable_id":4,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2],"environment_id":[null,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 01:37:32 UTC","id":88,"auditable_id":2,"auditable_name":"rdu.redhat.com","auditable_type":"Domain","action":"create","audited_changes":{"name":"rdu.redhat.com","fullname":null,"dns_id":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-16 01:37:30 UTC","id":87,"auditable_id":4,"auditable_name":"hotbox1.rdu.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"hotbox1.rdu.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":null,"owner_type":null,"enabled":true,"puppet_ca_proxy_id":1,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":1,"certname":"hotbox1.rdu.redhat.com","image_id":null,"organization_id":null,"location_id":null,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:30:51 UTC","id":86,"auditable_id":3,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,2]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:29:17 UTC","id":85,"auditable_id":3,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-16 01:28:42 UTC","id":84,"auditable_id":3,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.177","associated_name":null,"created_at":"2016-08-16 01:28:39 UTC","id":83,"auditable_id":3,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.177","associated_name":null,"created_at":"2016-08-16 01:28:37 UTC","id":82,"auditable_id":3,"auditable_name":"hotbox1.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"hotbox1.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-15 16:02:51 UTC","id":80,"auditable_id":9,"auditable_name":"Base_Org/Library/Red_Hat_Server/Red_Hat_Enterprise_Linux_7_Server_Kickstart_x86_64_7_2","auditable_type":"Medium","action":"create","audited_changes":{"name":"Base_Org/Library/Red_Hat_Server/Red_Hat_Enterprise_Linux_7_Server_Kickstart_x86_64_7_2","path":"http://batman.usersys.redhat.com/pulp/repos/Base_Org/Library/content/dist/rhel/server/7/7.2/x86_64/kickstart/","media_path":null,"config_path":null,"image_path":null,"os_family":"Redhat"}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.202","associated_name":null,"created_at":"2016-08-14 14:37:45 UTC","id":79,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"environment_id":[null,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.202","associated_name":null,"created_at":"2016-08-14 14:37:45 UTC","id":78,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"certname":[null,"joker.usersys.redhat.com"],"puppet_proxy_id":[null,2],"puppet_ca_proxy_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.218","associated_name":null,"created_at":"2016-08-14 14:17:16 UTC","id":77,"auditable_id":28,"auditable_name":"force_post_sync_actions","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- true\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.202","associated_name":null,"created_at":"2016-08-14 14:12:35 UTC","id":76,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"SmartProxy","action":"create","audited_changes":{"name":"joker.usersys.redhat.com","url":"https://joker.usersys.redhat.com:9090","expired_logs":"0","pubkey":null}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 23:06:51 UTC","id":75,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 23:06:43 UTC","id":74,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[1,0]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 23:01:19 UTC","id":73,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[2,1]}},{"user_id":1,"user_type":null,"user_name":"foreman_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 23:00:48 UTC","id":72,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"global_status":[0,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.202","associated_name":null,"created_at":"2016-08-13 23:00:42 UTC","id":71,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,2],"architecture_id":[null,1],"operatingsystem_id":[null,2]}},{"user_id":3,"user_type":null,"user_name":"admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.202","associated_name":null,"created_at":"2016-08-13 23:00:39 UTC","id":70,"auditable_id":2,"auditable_name":"joker.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"joker.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":3,"owner_type":"User","enabled":true,"puppet_ca_proxy_id":null,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":null,"certname":null,"image_id":null,"organization_id":1,"location_id":2,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-13 20:16:51 UTC","id":68,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"owner_type":[null,"User"],"owner_id":[null,2]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-13 20:16:49 UTC","id":67,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"update","audited_changes":{"model_id":[null,1],"architecture_id":[null,1],"operatingsystem_id":[null,2],"environment_id":[null,1]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-13 20:16:48 UTC","id":66,"auditable_id":2,"auditable_name":"RedHat 7.2","auditable_type":"Operatingsystem","action":"create","audited_changes":{"major":"7","name":"RedHat","minor":"2","nameindicator":null,"release_name":null,"description":null,"password_hash":"SHA256","title":"RedHat 7.2"}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-13 20:16:48 UTC","id":65,"auditable_id":1,"auditable_name":"usersys.redhat.com","auditable_type":"Domain","action":"create","audited_changes":{"name":"usersys.redhat.com","fullname":null,"dns_id":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-13 20:16:45 UTC","id":64,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"Host","action":"create","audited_changes":{"name":"batman.usersys.redhat.com","root_pass":null,"architecture_id":null,"operatingsystem_id":null,"environment_id":null,"ptable_id":null,"medium_id":null,"build":false,"comment":null,"disk":null,"installed_at":null,"model_id":null,"hostgroup_id":null,"owner_id":null,"owner_type":null,"enabled":true,"puppet_ca_proxy_id":1,"managed":false,"use_image":null,"image_file":null,"uuid":null,"compute_resource_id":null,"puppet_proxy_id":1,"certname":"batman.usersys.redhat.com","image_id":null,"organization_id":null,"location_id":null,"otp":null,"realm_id":null,"compute_profile_id":null,"provision_method":null,"content_source_id":null,"grub_pass":"","content_view_id":null,"lifecycle_environment_id":null,"global_status":0,"discovery_rule_id":null,"openscap_proxy_id":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-13 20:04:19 UTC","id":63,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"SmartProxy","action":"update","audited_changes":{"pubkey":[null,"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDiepO+d6GHZCNexIQJ9HirFIRyXLwZbDdtpBla48CMkPVc0jW67sBt7wZ2+ojEdixr5SHr3O5DoETa4WpP9T9dCku+LnEFW/3AShtKyMH3zWinD5NLYjFJJqAw9Yni+bCNdiSgiA0c4wGYxdoA9IMJc8ODnl/qdkRMBjUt5NZGBST94gQSl2TgExyvH10kMsW07tasDcajPClFROJ7k5PRV4aJaXbRvuUcPRX6uynnMmRvIX9xFAx0sfIx0p7qQXyQofJESFC9yakGk5iKTwFXhKs3cTA+xaecciYFI6dRawkEEK1Y24hwNApyhydud9MNzri4vHNZ9wDM07S+bosf foreman-proxy@batman.usersys.redhat.com"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":"10.13.153.151","associated_name":null,"created_at":"2016-08-13 20:04:19 UTC","id":62,"auditable_id":1,"auditable_name":"batman.usersys.redhat.com","auditable_type":"SmartProxy","action":"create","audited_changes":{"name":"batman.usersys.redhat.com","url":"https://batman.usersys.redhat.com:9090","expired_logs":"0","pubkey":null}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 20:03:48 UTC","id":61,"auditable_id":56,"auditable_name":"ssl_priv_key","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- \"/etc/foreman/client_key.pem\"\n"]}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 20:03:48 UTC","id":60,"auditable_id":54,"auditable_name":"ssl_certificate","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- \"/etc/foreman/client_cert.pem\"\n"]}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 20:03:48 UTC","id":59,"auditable_id":55,"auditable_name":"ssl_ca_file","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- \"/etc/foreman/proxy_ca.pem\"\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 20:01:27 UTC","id":58,"auditable_id":88,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 20:01:27 UTC","id":57,"auditable_id":89,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 20:01:27 UTC","id":56,"auditable_id":87,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 20:01:27 UTC","id":55,"auditable_id":90,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":8,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 20:01:26 UTC","id":54,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 20:01:24 UTC","id":53,"auditable_id":90,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":7,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 20:01:24 UTC","id":52,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 20:01:24 UTC","id":51,"auditable_id":89,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 20:01:24 UTC","id":50,"auditable_id":88,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 20:01:24 UTC","id":49,"auditable_id":87,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null,"job_category":"Miscellaneous","provider_type":null,"description_format":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:55:44 UTC","id":48,"auditable_id":84,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:55:44 UTC","id":47,"auditable_id":85,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:55:44 UTC","id":46,"auditable_id":83,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:55:44 UTC","id":45,"auditable_id":86,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":6,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:55:44 UTC","id":44,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:55:43 UTC","id":43,"auditable_id":86,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":5,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:55:43 UTC","id":42,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:55:42 UTC","id":41,"auditable_id":85,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:55:42 UTC","id":40,"auditable_id":84,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:55:42 UTC","id":39,"auditable_id":83,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:53:42 UTC","id":38,"auditable_id":79,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:53:42 UTC","id":37,"auditable_id":80,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:53:42 UTC","id":36,"auditable_id":78,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:53:41 UTC","id":35,"auditable_id":81,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":4,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:53:41 UTC","id":34,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:53:39 UTC","id":33,"auditable_id":81,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":3,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:53:39 UTC","id":32,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:53:39 UTC","id":31,"auditable_id":80,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:53:39 UTC","id":30,"auditable_id":79,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:53:39 UTC","id":29,"auditable_id":78,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:17 UTC","id":28,"auditable_id":45,"auditable_name":"db_pending_seed","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- false\n...\n"]}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:17 UTC","id":27,"auditable_id":44,"auditable_name":"db_pending_migration","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- false\n...\n"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:17 UTC","id":26,"auditable_id":25,"auditable_name":"Kickstart RHEL default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Kickstart RHEL default","template":"<%#\nkind: provision\nname: Kickstart RHEL default\noses:\n- RedHat 4\n- RedHat 5\n- RedHat 6\n- RedHat 7\n%>\n<%#\nThis template accepts the following parameters:\n- lang: string (default=\"en_US.UTF-8\")\n- selinux: string (default=\"enforcing\")\n- keyboard: string (default=\"us\")\n- time-zone: string (default=\"UTC\")\n- http-proxy: string (default=\"\")\n- http-proxy-port: string (default=\"\")\n- force-puppet: boolean (default=false)\n- enable-puppetlabs-repo: boolean (default=false)\n- salt_master: string (default=undef)\n- ntp-server: string (default=\"0.fedora.pool.ntp.org\")\n- bootloader-append: string (default=\"nofb quiet splash=quiet\")\n%>\n<%\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  proxy_uri = @host.params['http-proxy'] ? \"http://#{@host.params['http-proxy']}:#{@host.params['http-proxy-port']}\" : nil\n  proxy_string = proxy_uri ? \" --proxy=#{proxy_uri}\" : ''\n  puppet_enabled = pm_set || @host.param_true?('force-puppet')\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = os_major <= 5 ? '' : '%end'\n%>\ninstall\n<%= @mediapath %><%= proxy_string %>\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nselinux --<%= @host.params['selinux'] || 'enforcing' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n  <% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n  <% dhcp = !@static -%>\n<% end -%>\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if os_major >= 7 && @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'Active Directory' -%>\n# One-time password will be requested at install time. Otherwise, $HOST[OTP] is used as a placeholder value.\nrealm join --one-time-password=<%= @host.otp || \"$HOST[OTP]\" %> <%= @host.realm %>\n<% end -%>\n\n<% if os_major > 4 -%>\nservices --disabled gpm,sendmail,cups,pcmcia,isdn,rawdevices,hpoj,bluetooth,openibd,avahi-daemon,avahi-dnsconfd,hidd,hplip,pcscd\n\nrepo --name=\"EPEL\" --mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-<%= @host.operatingsystem.major %>&arch=<%= @host.architecture %><%= proxy_string %>\n<% if puppet_enabled && @host.param_true?('enable-puppetlabs-repo') -%>\nrepo --name=puppetlabs-products --baseurl=http://yum.puppetlabs.com/el/<%= @host.operatingsystem.major %>/products/<%= @host.architecture %><%= proxy_string %>\nrepo --name=puppetlabs-deps --baseurl=http://yum.puppetlabs.com/el/<%= @host.operatingsystem.major %>/dependencies/<%= @host.architecture %><%= proxy_string %>\n<% end -%>\n<% end -%>\n\nbootloader --location=mbr --append=\"<%= @host.params['bootloader-append'] || 'nofb quiet splash=quiet' %>\" <%= grub_pass %>\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages\nyum\ndhclient\nntp\nwget\n@Core\n<% if os_major >= 6 -%>\nredhat-lsb-core\n<% end -%>\nepel-release\n<% if puppet_enabled && @host.param_true?('enable-puppetlabs-repo') -%>\npuppetlabs-release\n<% end -%>\n<% if salt_enabled %>\nsalt-minion\n<% end -%>\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet 'redhat_register' %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet 'freeipa_register' %>\n<% end -%>\n\n<% if proxy_uri -%>\n# Yum proxy\necho 'proxy = <%= proxy_uri %>' >> /etc/yum.conf\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\n<% if salt_enabled %>\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\nsync\n\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":false,"default":true,"vendor":null,"os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:17 UTC","id":25,"auditable_id":24,"auditable_name":"Kickstart default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Kickstart default","template":"<%#\nkind: provision\nname: Kickstart default\noses:\n- CentOS 4\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- Fedora 16\n- Fedora 17\n- Fedora 18\n- Fedora 19\n- Fedora 20\n%>\n<%#\nThis template accepts the following parameters:\n- lang: string (default=\"en_US.UTF-8\")\n- selinux: string (default=\"enforcing\")\n- keyboard: string (default=\"us\")\n- time-zone: string (default=\"UTC\")\n- http-proxy: string (default=\"\")\n- http-proxy-port: string (default=\"\")\n- force-puppet: boolean (default=false)\n- enable-puppetlabs-repo: boolean (default=false)\n- salt_master: string (default=undef)\n- ntp-server: string (default=\"0.fedora.pool.ntp.org\")\n- bootloader-append: string (default=\"nofb quiet splash=quiet\")\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  realm_compatible = (@host.operatingsystem.name == 'Fedora' && os_major >= 20) || (rhel_compatible && os_major >= 7)\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  proxy_uri = @host.params['http-proxy'] ? \"http://#{@host.params['http-proxy']}:#{@host.params['http-proxy-port']}\" : nil\n  proxy_string = proxy_uri ? \" --proxy=#{proxy_uri}\" : ''\n  puppet_enabled = pm_set || @host.param_true?('force-puppet')\n  salt_enabled = @host.params['salt_master'] ? true : false\n  chef_enabled = @host.respond_to?(:chef_proxy) && @host.chef_proxy\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %><%= proxy_string %>\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nselinux --<%= @host.params['selinux'] || 'enforcing' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n<% if rhel_compatible && os_major > 4 -%>\nservices --disabled gpm,sendmail,cups,pcmcia,isdn,rawdevices,hpoj,bluetooth,openibd,avahi-daemon,avahi-dnsconfd,hidd,hplip,pcscd\n<% end -%>\n\n<% if realm_compatible && @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'Active Directory' -%>\n# One-time password will be requested at install time. Otherwise, $HOST[OTP] is used as a placeholder value.\nrealm join --one-time-password='<%= @host.otp || \"$HOST[OTP]\" %>' <%= @host.realm %>\n<% end -%>\n\n<% if @host.operatingsystem.name == 'Fedora' -%>\nrepo --name=fedora-everything --mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=fedora-<%= @host.operatingsystem.major %>&arch=<%= @host.architecture %><%= proxy_string %>\n<% if puppet_enabled && @host.param_true?('enable-puppetlabs-repo') -%>\nrepo --name=puppetlabs-products --baseurl=http://yum.puppetlabs.com/fedora/f<%= @host.operatingsystem.major %>/products/<%= @host.architecture %><%= proxy_string %>\nrepo --name=puppetlabs-deps --baseurl=http://yum.puppetlabs.com/fedora/f<%= @host.operatingsystem.major %>/dependencies/<%= @host.architecture %><%= proxy_string %>\n<% end -%>\n<% elsif rhel_compatible && os_major > 4 -%>\nrepo --name=\"EPEL\" --mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-<%= @host.operatingsystem.major %>&arch=<%= @host.architecture %><%= proxy_string %>\n<% if puppet_enabled && @host.param_true?('enable-puppetlabs-repo') -%>\nrepo --name=puppetlabs-products --baseurl=http://yum.puppetlabs.com/el/<%= @host.operatingsystem.major %>/products/<%= @host.architecture %><%= proxy_string %>\nrepo --name=puppetlabs-deps --baseurl=http://yum.puppetlabs.com/el/<%= @host.operatingsystem.major %>/dependencies/<%= @host.architecture %><%= proxy_string %>\n<% end -%>\n<% end -%>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"<%= @host.params['bootloader-append'] || 'nofb quiet splash=quiet' %> <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"<%= @host.params['bootloader-append'] || 'nofb quiet splash=quiet' %>\" <%= grub_pass %>\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages\nyum\ndhclient\nntp\nwget\n@Core\n<% if os_major >= 6 -%>\nredhat-lsb-core\n<% end -%>\n<% if rhel_compatible && os_major > 4 -%>\nepel-release\n<% end -%>\n<% if puppet_enabled %>\npuppet\n<% if @host.param_true?('enable-puppetlabs-repo') -%>\npuppetlabs-release\n<% end -%>\n<% end -%>\n<% if salt_enabled %>\nsalt-minion\n<% end -%>\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet 'freeipa_register' %>\n<% end -%>\n\n<% if proxy_uri -%>\n# Yum proxy\necho 'proxy = <%= proxy_uri %>' >> /etc/yum.conf\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<% if chef_enabled %>\n<%= snippet 'chef_client' %>\n<% end -%>\n\n<% if puppet_enabled %>\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\n<% if salt_enabled %>\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\nsync\n\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":false,"default":true,"vendor":null,"os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:17 UTC","id":24,"auditable_id":67,"auditable_name":"Katello Kickstart Default User Data","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:17 UTC","id":23,"auditable_id":68,"auditable_name":"Katello Kickstart Default Finish","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:16 UTC","id":22,"auditable_id":66,"auditable_name":"Katello Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:16 UTC","id":21,"auditable_id":70,"auditable_name":"Katello Atomic Kickstart Default","auditable_type":"ProvisioningTemplate","action":"destroy","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:16 UTC","id":20,"auditable_id":77,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Satellite Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Satellite Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Satellite","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:16 UTC","id":19,"auditable_id":76,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"idm_register","template":"<%#\nkind: snippet\nname: idm_register\n%>\n# Identity Management Registration Snippet\n#\n# Optional parameters:\n#\n#   idm_server              IdM server\n#\n#   idm_sudo                Enable sudoers\n#                           Default: true\n#\n#   idm_ssh                 Enable ssh integration\n#                           Default: true\n#\n#   idm_automount           Enable automounter\n#                           Default: false\n#\n#   idm_automount_location  Location for automounts\n#\n#   idm_mkhomedir           Enable automatically making home directories\n#                           Default: true\n#\n#   idm_opts                Additional options to pass directly to installer\n#\n<% if @host.operatingsystem.family == 'Redhat' -%>\n  <% if @host.operatingsystem.name == \"Fedora\" -%>\n    idm_client=freeipa-client\n  <% else -%>\n    idm_client=ipa-client\n  <% end -%>\n<% else -%>\n  idm_client=freeipa-client\n<% end -%>\n\n<%= @host.operatingsystem.family == \"Redhat\" ? 'yum install -y libsss_sudo' : 'apt-get install -y libsss-sudo' %> $idm_client\n\n##\n## IDM Client Installation\n##\n\n<% if @host.params[\"idm_server\"] -%>\nidm_server=\"--server <%= @host.params[\"idm_server\"] %>\"\n<% end -%>\n\n<% unless @host.param_false? \"idm_mkhomedir\" %>\nidm_mkhomedir=\"--mkhomedir\"\n<% end -%>\n\n<% if @host.param_false? \"idm_ssh\" %>\nidm_ssh=\"--no-ssh\"\n<% end -%>\n\n<% if @host.params[\"idm_opts\"] -%>\nidm_opts=\"<%= @host.params[\"idm_opts\"] %>\"\n<% end -%>\n\n/usr/sbin/ipa-client-install -w '<%= @host.otp %>' --realm=<%= @host.realm %> -f -U $idm_mkhomedir $idm_opts $idm_server $idm_ssh\n\n##\n## Automounter\n##\n\n<% if @host.params[\"idm_automount_location\"] -%>\nautomount_location=\"--location <%= @host.params[\"idm_automount_location\"] %>\"\n<% end -%>\n\n<% if @host.param_true? \"idm_automount\" -%>\nif [ -f /usr/sbin/ipa-client-automount ]\nthen\n  /usr/sbin/ipa-client-automount $idm_server $automount_location --unattended\nfi\n<% end -%>\n\n##\n## Sudoers\n##\n\n<% unless @host.param_false? \"idm_enable_sudo\" %>\n\nidm_realm=$(grep default_realm /etc/krb5.conf | cut -d\"=\" -f2 | tr -d ' ')\nidm_domain=$(grep default_domain /etc/krb5.conf | cut -d\"=\" -f2 | tr -d ' ')\nidm_dn=$(for word in $(echo $idm_domain | sed 's/\\./ /g'); do echo -n dc=$word,; done)\n\nsssd_version=$(sssd --version)\nsssd_major=$(echo $sssd_version | cut -f1 -d.)\nsssd_minor=$(echo $sssd_version | cut -f2 -d.)\nLDAP_CONFIG=$(mktemp)\n\nif [ $sssd_minor -ge 11 ] || [ $sssd_major -gt 1 ]\nthen\n    echo \"sudo_provider = ipa\" > $LDAP_CONFIG\nelse\n    <% if @host.params[\"idm_server\"] -%>\n    ldap_uri=\", ldap://<%= @host.params[\"idm_server\"] %>\"\n    krb5_server=<%= @host.params[\"idm_server\"] %>\n    <% else -%>\n    krb5_server=\"_srv_\"\n    <% end -%>\n\ncat <<EOF > $LDAP_CONFIG\nsudo_provider = ldap\nldap_uri = _srv_ $ldap_uri\nldap_sudo_search_base = ou=SUDOers,${idm_dn%?}\nldap_sasl_mech = GSSAPI\nldap_sasl_authid = host/$HOSTNAME\nldap_sasl_realm = $idm_realm\nkrb5_server = $krb5_server\nEOF\n\nfi\n\nsed -i -e \"/\\[domain\\/.*\\]/ r $LDAP_CONFIG\" /etc/sssd/sssd.conf\nsed -i -e \"s/services = .*/\\0, sudo/\" /etc/sssd/sssd.conf\n\n<% if @host.operatingsystem.family == 'Redhat' -%>\n  authconfig --nisdomain ${idm_domain} --update\n  chkconfig sssd on\n\n  if [[ $(rpm -qa systemd | wc -l) -gt 0 ]];\n  then\n    domain_service=/usr/lib/systemd/system/*-domainname.service\n\n    # Workaround for BZ1071969 on RHEL 7.0\n    grep -q \"DefaultDependencies=no\" $domain_service\n    if [[ $? -ne 0 ]]\n    then\n        sed -i -e \"s/\\[Unit\\]/\\[Unit\\]\\nDefaultDependencies=no/\" $domain_service\n    fi\n\n    systemctl start $(basename $domain_service)\n    systemctl enable $(basename $domain_service)\n  fi\n<% else -%>\n  sed -i -e '/^exit /d' /etc/rc.local\n  echo \"nisdomainname ${idm_domain}\" >> /etc/rc.local\n  echo \"exit 0\" >> /etc/rc.local\n  nisdomainname ${idm_domain}\n<% end -%>\n\ngrep -q sudoers /etc/nsswitch.conf\nif [[ $? -eq 0 ]];\nthen\n  sed -i -e \"s/^sudoers.*/sudoers:    files sss/\" /etc/nsswitch.conf\nelse\n  echo sudoers:    files sss >> /etc/nsswitch.conf\nfi\n<% end -%>\n","snippet":true,"template_kind_id":null,"locked":true,"default":true,"vendor":"Satellite","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":2,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:16 UTC","id":18,"auditable_id":69,"auditable_name":"subscription_manager_registration","auditable_type":"ProvisioningTemplate","action":"update","audited_changes":{"template":["<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.name.match(/.*atomic.*/i) %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% if @host.operatingsystem.name == \"RedHat\" %>\n    echo \"Enabling Satellite Tools Repo\"\n    echo \"DEPRECATED: This may be removed in a future version of Satellite, please add Satellite Tools to your activation key(s).\"\n    subscription-manager repos --enable=rhel-*-satellite-tools-*-rpms\n  <% end %>\n\n  <% unless @host.operatingsystem.name.match(/.*atomic.*/i) %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>\n"],"vendor":["Katello","Satellite"]}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:15 UTC","id":17,"auditable_id":75,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Satellite Kickstart Default Finish","template":"<%#\nkind: finish\nname: Satellite Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"Red Hat Identity Management\" -%>\n<%= snippet \"idm_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Satellite","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:15 UTC","id":16,"auditable_id":74,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Satellite Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Satellite Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'Red Hat Identity Management' -%>\n<%= indent 4 do\n      snippet 'idm_register'\n    end %>\n<% end -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n<%\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Satellite","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:15 UTC","id":15,"auditable_id":73,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Satellite Kickstart Default","template":"<%#\nkind: provision\nname: Satellite Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'Red Hat Identity Management' -%>\n<%= snippet \"idm_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Satellite","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:14 UTC","id":14,"auditable_id":1,"auditable_name":"Red Hat Enterprise Linux Atomic Host 7.2","auditable_type":"Operatingsystem","action":"create","audited_changes":{"major":"7","name":"RedHat_Enterprise_Linux_Atomic_Host","minor":"2","nameindicator":null,"release_name":null,"description":"Red Hat Enterprise Linux Atomic Host 7.2","password_hash":"SHA256","title":"RedHat_Enterprise_Linux_Atomic_Host 7.2"}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:12 UTC","id":13,"auditable_id":70,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Atomic Kickstart Default","template":"<%#\nkind: provision\nname: Katello Atomic Kickstart default\n%>\n\nlang <%= @host.params['lang'] || 'en_US.UTF-8' %>\nkeyboard <%= @host.params['keyboard'] || 'us' %>\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n# Partition table should create /boot and a volume atomicos\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\nbootloader --timeout=3\ntext\n\n<% if @host.os.name.match /.*fedora.*/i -%>\nostreesetup --nogpg --osname=fedora-atomic --remote=fedora-atomic --url=<%= @host.param_true?('atomic-upstream') ? \"https://dl.fedoraproject.org/pub/fedora/linux/atomic/#{@host.os.major}/\" : \"#{@host.operatingsystem.medium_uri(@host)}/content/repo/\" %> --ref=fedora-atomic/f<%= @host.os.major %>/<%= @host.architecture %>/docker-host\n<% elsif @host.os.name.match /.*centos.*/i -%>\nostreesetup --nogpg --osname=centos-atomic-host --remote=centos-atomic-host --url=<%= @host.param_true?('atomic-upstream') ? \"http://mirror.centos.org/centos/#{@host.os.major}/atomic/#{@host.architecture}/repo/\" : @host.operatingsystem.medium_uri(@host) %> --ref=centos-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% else -%>\nostreesetup --nogpg --osname=rhel-atomic-host --remote=rhel-atomic-host --url=file:///install/ostree --ref=rhel-atomic-host/<%= @host.os.major %>/<%= @host.architecture %>/standard\n<% end -%>\nservices --disabled cloud-init,cloud-config,cloud-final,cloud-init-local\nrootpw --iscrypted <%= root_pass %>\n\nreboot\n\n%post\n<%= snippet \"subscription_manager_registration\" %>\n<%= snippet('remote_execution_ssh_keys') %>\n(\n# Report success back to Foreman\ncurl -s -o /dev/null --insecure <%= foreman_url %>\n) 2>&1 | tee /mnt/sysimage/root/install.post.log\n\nexit 0\n\n%end\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:12 UTC","id":12,"auditable_id":69,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"subscription_manager_registration","template":"<% if @host.params['kt_activation_keys'] %>\n  # add subscription manager\n <% if @host.operatingsystem.atomic? %>\n  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash\n <% else %>\n  yum -t -y -e 0 install subscription-manager\n  rpm -ivh <%= subscription_manager_configuration_url(@host) %>\n <% end %>\n\n  echo \"Registering the System\"\n  subscription-manager register --org=\"<%= @host.rhsm_organization_label %>\" --name=\"<%= @host.name %>\" --activationkey=\"<%= @host.params['kt_activation_keys'] %>\"\n\n  <% unless @host.operatingsystem.atomic? %>\n    echo \"Installing Katello Agent\"\n    yum -t -y -e 0 install katello-agent\n    chkconfig goferd on\n  <% end %>\n<% end %>","snippet":true,"template_kind_id":null,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:12 UTC","id":11,"auditable_id":68,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default Finish","template":"<%#\nkind: finish\nname: Katello Kickstart default finish\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<% if @host.subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\nservice network restart\n<% end -%>\n\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n%>\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.respond_to?(:realm) && @host.otp && @host.realm && @host.realm.realm_type == \"FreeIPA\" -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\nyum -t -y -e 0 install puppet\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n/sbin/service puppet start\n<% end -%>\n\nexit 0\n","snippet":false,"template_kind_id":6,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:12 UTC","id":10,"auditable_id":67,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default User Data","template":"<%#\nkind: user_data\nname: Katello Kickstart default user data\noses:\n- CentOS 6\n- CentOS 7\n- Fedora 19\n- Fedora 20\n- Fedora 21\n- Fedora 22\n- Fedora 23\n-%>\n#cloud-config\nhostname: <%= @host.shortname %>\nfqdn: <%= @host %>\nmanage_etc_hosts: true\n\ngroups:\n - admin\n\nusers:\n - default\n - name: admin\n   primary-group: admin\n   groups: users\n   shell: /bin/bash\n   sudo: ['ALL=(ALL) ALL']\n   lock-passwd: false\n   passwd: <%= @host.root_pass %>\n\n<%# Allow user to specify additional SSH key as host paramter -%>\n<% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%>\nssh_authorized_keys:\n<% if @host.params['sshkey'].present? -%>\n  - <%= @host.params['sshkey'] %>\n<% end -%>\n<% if @host.params['remote_execution_ssh_keys'].present? -%>\n<% @host.params['remote_execution_ssh_keys'].each do |key| -%>\n  - <%= key %>\n<% end -%>\n<% end -%>\n<% end -%>\nwrite_files:\n- path: /tmp/foreman-userdata.sh\n  permissions: '0755'\n  content: |\n    #!/bin/bash\n<%= indent 4 do\n      snippet 'subscription_manager_registration'\n    end %>\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= indent 4 do\n      snippet 'freeipa_register'\n    end %>\n<% end -%>\n  <% unless @host.operatingsystem.atomic? -%>\n    # update all the base packages from the updates repository\n    yum -t -y -e 0 update\n  <% end -%>\n<%\n  # safemode renderer does not support unary negation\n  non_atomic = @host.operatingsystem.atomic? ? false : true\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = non_atomic && (pm_set || @host.params['force-puppet'])\n  salt_enabled = non_atomic && (@host.params['salt_master'] ? true : false)\n%>\n<% if salt_enabled %>\n    yum -t -y -e 0 install salt-minion\n    cat > /etc/salt/minion << EOF\n    <%= indent 4 do\n          snippet 'saltstack_minion'\n        end %>\n    EOF\n    # Setup salt-minion to run on system reboot\n    /sbin/chkconfig --level 345 salt-minion on\n    # Running salt-call to trigger key signing\n    salt-call --no-color --grains >/dev/null\n<% end -%>\n<% if puppet_enabled %>\n    yum install -y puppet\n    cat > /etc/puppet/puppet.conf << EOF\n    <%= indent 4 do\n          snippet 'puppet.conf'\n        end %>\n    EOF\n    # Setup puppet to run on system reboot\n    /sbin/chkconfig --level 345 puppet on\n\n    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n    /sbin/service puppet start\n<% end -%>\nphone_home:\n url: <%= foreman_url('built') %>\n post: []\n tries: 10\nruncmd:\n - [ cloud-init-per, once, foreman-userdata, /tmp/foreman-userdata.sh ]\noutput: {all: '| tee -a /root/install.userdata.log'}\n\n","snippet":false,"template_kind_id":8,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":2,"user_type":null,"user_name":"foreman_api_admin","version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:12 UTC","id":9,"auditable_id":66,"auditable_name":null,"auditable_type":"ProvisioningTemplate","action":"create","audited_changes":{"name":"Katello Kickstart Default","template":"<%#\nkind: provision\nname: Katello Kickstart default\noses:\n- CentOS 5\n- CentOS 6\n- CentOS 7\n- RedHat 5\n- RedHat 6\n- RedHat 7\n- Fedora 19\n- Fedora 20\n%>\n<%\n  rhel_compatible = @host.operatingsystem.family == 'Redhat' && @host.operatingsystem.name != 'Fedora'\n  os_major = @host.operatingsystem.major.to_i\n  # safemode renderer does not support unary negation\n  pm_set = @host.puppetmaster.empty? ? false : true\n  puppet_enabled = pm_set || @host.params['force-puppet']\n  salt_enabled = @host.params['salt_master'] ? true : false\n  section_end = (rhel_compatible && os_major <= 5) ? '' : '%end'\n%>\ninstall\n<%= @mediapath %>\nlang en_US.UTF-8\nselinux --enforcing\nkeyboard us\nskipx\n\n<% subnet = @host.subnet -%>\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<% dhcp = subnet.dhcp_boot_mode? && !@static -%>\n<% else -%>\n<% dhcp = !@static -%>\n<% end -%>\n\nnetwork --bootproto <%= dhcp ? 'dhcp' : \"static --ip=#{@host.ip} --netmask=#{subnet.mask} --gateway=#{subnet.gateway} --nameserver=#{[subnet.dns_primary, subnet.dns_secondary].select(&:present?).join(',')}\" %> --hostname <%= @host %><%= os_major >= 6 ? \" --device=#{@host.mac}\" : '' -%>\n\nrootpw --iscrypted <%= root_pass %>\nfirewall --<%= os_major >= 6 ? 'service=' : '' %>ssh\nauthconfig --useshadow --passalgo=sha256 --kickstart\ntimezone --utc <%= @host.params['time-zone'] || 'UTC' %>\n\n<% if @host.operatingsystem.name == 'Fedora' and os_major <= 16 -%>\n# Bootloader exception for Fedora 16:\nbootloader --append=\"nofb quiet splash=quiet <%=ks_console%>\" <%= grub_pass %>\npart biosboot --fstype=biosboot --size=1\n<% else -%>\nbootloader --location=mbr --append=\"nofb quiet splash=quiet\" <%= grub_pass %>\n<% end -%>\n\n<% if os_major == 5 -%>\nkey --skip\n<% end -%>\n\n<% if @dynamic -%>\n%include /tmp/diskpart.cfg\n<% else -%>\n<%= @host.diskLayout %>\n<% end -%>\n\ntext\nreboot\n\n%packages --ignoremissing\nyum\ndhclient\nntp\nwget\n@Core\n<%= section_end -%>\n\n<% if @dynamic -%>\n%pre\n<%= @host.diskLayout %>\n<%= section_end -%>\n<% end -%>\n\n%post --nochroot\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\ncp -va /etc/resolv.conf /mnt/sysimage/etc/resolv.conf\n/usr/bin/chvt 1\n) 2>&1 | tee /mnt/sysimage/root/install.postnochroot.log\n<%= section_end -%>\n\n\n%post\nlogger \"Starting anaconda <%= @host %> postinstall\"\nexec < /dev/tty3 > /dev/tty3\n#changing to VT 3 so that we can see whats going on....\n/usr/bin/chvt 3\n(\n<% if subnet.respond_to?(:dhcp_boot_mode?) -%>\n<%= snippet 'kickstart_networking_setup' %>\n<% end -%>\n\n#update local time\necho \"updating system time\"\n/usr/sbin/ntpdate -sub <%= @host.params['ntp-server'] || '0.fedora.pool.ntp.org' %>\n/usr/sbin/hwclock --systohc\n\n<%= snippet \"subscription_manager_registration\" %>\n\n<% if @host.info['parameters']['realm'] && @host.realm && @host.realm.realm_type == 'FreeIPA' -%>\n<%= snippet \"freeipa_register\" %>\n<% end -%>\n\n# update all the base packages from the updates repository\nyum -t -y -e 0 update\n\n<%= snippet('remote_execution_ssh_keys') %>\n\n<% if salt_enabled %>\nyum -t -y -e 0 install salt-minion\ncat > /etc/salt/minion << EOF\n<%= snippet 'saltstack_minion' %>\nEOF\n# Setup salt-minion to run on system reboot\n/sbin/chkconfig --level 345 salt-minion on\n# Running salt-call to trigger key signing\nsalt-call --no-color --grains >/dev/null\n<% end -%>\n\n<% if puppet_enabled %>\n# and add the puppet package\nyum -t -y -e 0 install puppet\n\necho \"Configuring puppet\"\ncat > /etc/puppet/puppet.conf << EOF\n<%= snippet 'puppet.conf' %>\nEOF\n\n# Setup puppet to run on system reboot\n/sbin/chkconfig --level 345 puppet on\n\n/usr/bin/puppet agent --config /etc/puppet/puppet.conf -o --tags no_such_tag <%= @host.puppetmaster.blank? ? '' : \"--server #{@host.puppetmaster}\" %> --no-daemonize\n<% end -%>\n\nsync\n\n<% if @provisioning_type == nil || @provisioning_type == 'host' -%>\n# Inform the build system that we are done.\necho \"Informing Foreman that we are built\"\nwget -q -O /dev/null --no-check-certificate <%= foreman_url %>\n<% end -%>\n) 2>&1 | tee /root/install.post.log\nexit 0\n\n<%= section_end -%>\n","snippet":false,"template_kind_id":5,"locked":true,"default":true,"vendor":"Katello","os_family":null}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:51:12 UTC","id":8,"auditable_id":3,"auditable_name":"Admin User","auditable_type":"User","action":"update","audited_changes":{"default_organization_id":[null,1]}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:50:45 UTC","id":7,"auditable_id":50,"auditable_name":"oauth_map_users","auditable_type":"Setting","action":"update","audited_changes":{"value":[null,"--- false\n...\n"]}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:49:37 UTC","id":6,"auditable_id":6,"auditable_name":"Access Insights Admin","auditable_type":"Role","action":"create","audited_changes":{"name":"Access Insights Admin","builtin":0,"permissions":null}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:49:37 UTC","id":5,"auditable_id":5,"auditable_name":"Access Insights Viewer","auditable_type":"Role","action":"create","audited_changes":{"name":"Access Insights Viewer","builtin":0,"permissions":null}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:49:37 UTC","id":4,"auditable_id":4,"auditable_name":"Red Hat Access Logs","auditable_type":"Role","action":"create","audited_changes":{"name":"Red Hat Access Logs","builtin":0,"permissions":null}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:49:28 UTC","id":3,"auditable_id":3,"auditable_name":"Tasks Reader","auditable_type":"Role","action":"create","audited_changes":{"name":"Tasks Reader","builtin":0,"permissions":null}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:49:28 UTC","id":2,"auditable_id":2,"auditable_name":"Tasks Manager","auditable_type":"Role","action":"create","audited_changes":{"name":"Tasks Manager","builtin":0,"permissions":null}},{"user_id":null,"user_type":null,"user_name":null,"version":1,"comment":null,"associated_id":null,"associated_type":null,"remote_address":null,"associated_name":null,"created_at":"2016-08-13 19:49:28 UTC","id":1,"auditable_id":1,"auditable_name":"Boot disk access","auditable_type":"Role","action":"create","audited_changes":{"name":"Boot disk access","builtin":0,"permissions":null}}]
}
